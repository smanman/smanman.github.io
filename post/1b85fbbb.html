<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vue后台电商管理项目 | 满天鑫</title><meta name="keywords" content="前端,Vue后台电商管理项目"><meta name="author" content="满天鑫"><meta name="copyright" content="满天鑫"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、项目简介1、后台管理系统的功能划分电商后台管理系统用于管理用户账号、商品分类、商品信息、订单、数据统计等业务功能。   2、后台管理系统的开发模式（前后端分离） 前后端分离之后，开发流程将如下图所示。  在开发期间前后端共同商定好数据接口的交互形式和数据格式。然后实现前后端的并行开发，其中前端工程师再开发完成之后可以独自进行mock测试，而后端也可以使用接口测试平台进行接口自测，然后前后端一起">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue后台电商管理项目">
<meta property="og:url" content="https://smanman.github.io/post/1b85fbbb.html">
<meta property="og:site_name" content="满天鑫">
<meta property="og:description" content="一、项目简介1、后台管理系统的功能划分电商后台管理系统用于管理用户账号、商品分类、商品信息、订单、数据统计等业务功能。   2、后台管理系统的开发模式（前后端分离） 前后端分离之后，开发流程将如下图所示。  在开发期间前后端共同商定好数据接口的交互形式和数据格式。然后实现前后端的并行开发，其中前端工程师再开发完成之后可以独自进行mock测试，而后端也可以使用接口测试平台进行接口自测，然后前后端一起">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082302.jpg">
<meta property="article:published_time" content="2021-11-19T14:39:00.000Z">
<meta property="article:modified_time" content="2022-11-27T09:16:42.907Z">
<meta property="article:author" content="满天鑫">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="Vue后台电商管理项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082302.jpg"><link rel="shortcut icon" href="https://lvxueyangboke.oss-cn-beijing.aliyuncs.com/images/20210805191028.png"><link rel="canonical" href="https://smanman.github.io/post/1b85fbbb"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Vue后台电商管理项目',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 17:16:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/ali_icon.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mogai.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="满天鑫" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202406071141762.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">38</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082302.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">满天鑫</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Vue后台电商管理项目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-19T14:39:00.000Z" title="发表于 2021-11-19 22:39:00">2021-11-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-27T09:16:42.907Z" title="更新于 2022-11-27 17:16:42">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/Vue%E5%90%8E%E5%8F%B0%E7%94%B5%E5%95%86%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE/">Vue后台电商管理项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">42.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>188分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Vue后台电商管理项目"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、项目简介"><a href="#一、项目简介" class="headerlink" title="一、项目简介"></a>一、项目简介</h1><h2 id="1、后台管理系统的功能划分"><a href="#1、后台管理系统的功能划分" class="headerlink" title="1、后台管理系统的功能划分"></a>1、后台管理系统的功能划分</h2><p>电商后台管理系统用于管理用户账号、商品分类、商品信息、订单、数据统计等业务功能。 </p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211120150842.png"></p>
<h2 id="2、后台管理系统的开发模式（前后端分离）"><a href="#2、后台管理系统的开发模式（前后端分离）" class="headerlink" title="2、后台管理系统的开发模式（前后端分离）"></a>2、后台管理系统的开发模式（前后端分离）</h2><p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211120150843.png"></p>
<p>前后端分离之后，开发流程将如下图所示。</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211120150844.jpg"></p>
<p>在开发期间前后端共同商定好数据接口的交互形式和数据格式。然后实现前后端的并行开发，其中前端工程师再开发完成之后可以独自进行mock测试，而后端也可以使用接口测试平台进行接口自测，然后前后端一起进行功能联调并校验格式，最终进行自动化测试</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211120150845.jpg"></p>
<h2 id="3、电商后台管理系统的技术选型"><a href="#3、电商后台管理系统的技术选型" class="headerlink" title="3、电商后台管理系统的技术选型"></a>3、电商后台管理系统的技术选型</h2><ul>
<li><p>前端项目技术栈 </p>
<p> <code> Vue</code>  </p>
<p><code> Vue-router</code> </p>
<p><code>Element-UI </code></p>
<p><code> Axios</code> </p>
<p><code>Echarts</code></p>
</li>
<li><p>后端项目技术栈 </p>
<p><code>Node.js</code></p>
<p><code> Express</code></p>
<p> <code>Jwt </code></p>
<p><code>Mysql</code></p>
<p><code>Sequelize</code> </p>
</li>
</ul>
<h1 id="二、登录-退出功能"><a href="#二、登录-退出功能" class="headerlink" title="二、登录/退出功能"></a>二、登录/退出功能</h1><h2 id="1、登录业务流程"><a href="#1、登录业务流程" class="headerlink" title="1、登录业务流程"></a>1、登录业务流程</h2><p>① 在登录页面输入用户名和密码 </p>
<p>② 调用后台接口进行验证 </p>
<p>③ 通过验证之后，根据后台的响应状态跳转到项目主页 </p>
<h2 id="2、登录业务的相关技术点"><a href="#2、登录业务的相关技术点" class="headerlink" title="2、登录业务的相关技术点"></a>2、登录业务的相关技术点</h2><p><code>http</code> 是无状态的,怎样记录用户的登录状态？</p>
<p> 通过 <code>cookie </code>在客户端记录状态 </p>
<p>通过 <code>session</code> 在服务器端记录状态 </p>
<p> 通过<code>token</code>方式维持状态 </p>
<p>在跨域的情况下，推荐使用<code>token</code>方式。</p>
<h2 id="3、token原理分析"><a href="#3、token原理分析" class="headerlink" title="3、token原理分析"></a>3、token原理分析</h2><p>现在我们面临的一个问题就是，只要任何一个用户知道了服务端接口的地址，都可以进行访问，而我们有时候希望的是登录的用户才能够访问服务端的接口，所以这里需要加上相应的认证机制。关于认证机制，我们这里使用<code>JWT</code>.</p>
<p><code> JSON Web Token（JWT）</code>是一个开放的标准（<code>RFC 7519</code>），它定义了一个紧凑且自包含的方式，用于在各方之间作为<code>JSON</code>对象安全地传输信息。由于此信息是经过数字签名的，因此可以被验证和信任。 </p>
<p> <strong>传统认证流程</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1、用户向服务器发送用户名和密码。</span><br><span class="line"></span><br><span class="line">2、服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</span><br><span class="line"></span><br><span class="line">3、服务器向用户返回一个 session_id，写入用户的 Cookie。</span><br><span class="line"></span><br><span class="line">4、用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</span><br><span class="line"></span><br><span class="line">5、服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</span><br></pre></td></tr></table></figure>

<p>这种模式的问题在于，扩展性（scaling）不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。所以说，在集群或者是跨域的应用环境下，推荐使用<code>token的模式</code>校验。</p>
<p>举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现？</p>
<p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。</p>
<p>另一种方案是服务器索性不保存 session 数据了，所有数据都保存在客户端，每次请求都发回服务器。<code>JWT</code> 就是这种方案的一个代表。</p>
<p><strong><code>JWT</code>认证流程</strong></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211120150846.png"></p>
<h2 id="4、路由创建"><a href="#4、路由创建" class="headerlink" title="4、路由创建"></a>4、路由创建</h2><p>在<code>src</code>目录下面，创建<code>router.js</code>文件,文件定义路由规则</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>输入“/”的时候，会重定向到登录组件。</p>
<p>下面需要在<code>App.vue</code>组件中，定义路由占位符。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">      &lt;!--路由占位符--&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>最后，需要在<code>main.js</code>文件中导入路由，并且在创建<code>vue</code>实例的时候，完成路由的注册。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="5、登录页面构建"><a href="#5、登录页面构建" class="headerlink" title="5、登录页面构建"></a>5、登录页面构建</h2><p><strong><code>Element UI</code>按需加载</strong></p>
<p>第一、安装<code>babel-plugin-component插件</code></p>
<p>第二：在<code>src</code>目录下面创建<code>plugins</code>目录，在该目录下面创建<code>element.js</code>文件，在该文件中导入所需要的组件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button, Form, FormItem, Input &#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Button);</span><br><span class="line">Vue.use(Form);</span><br><span class="line">Vue.use(FormItem);</span><br><span class="line">Vue.use(Input);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第三：在<code>main.js</code>文件中导入<code>element.js</code>文件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./plugins/element.js&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>第四：在项目根目录下的<code>babel.config.js</code>文件中添加如下<code>plugins</code>的配置信息。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  presets: [&quot;@vue/cli-plugin-babel/preset&quot;],</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      &quot;component&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        libraryName: &quot;element-ui&quot;,</span><br><span class="line">        styleLibraryName: &quot;theme-chalk&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在整个登录表单构建过程中，还需要注意以下几点：</p>
<p><strong>第一：数据绑定</strong></p>
<p>首先给<code>el-form</code>添加<code>model</code>属性，动态绑定表单元素所需要的数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">:model=<span class="string">&quot;loginForm&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>loginForm</code>数据定义如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 这是登录表单的数据绑定对象</span></span><br><span class="line">      <span class="attr">loginForm</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;  </span><br></pre></td></tr></table></figure>

<p>通过给文本框等表单元素添加<code>v-model</code>来绑定具体的数据。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prefix-icon</span>=<span class="string">&quot;iconfont icon-user&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-model</span>=<span class="string">&quot;loginForm.username&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">          </span><br><span class="line">    <span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prefix-icon</span>=<span class="string">&quot;iconfont icon-3702mima&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-model</span>=<span class="string">&quot;loginForm.password&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span>        </span><br></pre></td></tr></table></figure>



<p><strong>第二: 表单校验</strong></p>
<p>首先给<code>&lt;el-form&gt;</code>添加<code>rules</code>属性，该属性动态绑定的是表单校验的规则对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">:rules=<span class="string">&quot;loginFormRules&quot;</span></span><br></pre></td></tr></table></figure>

<p>下面定义校验规则对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这是表单的验证规则对象</span></span><br><span class="line">    <span class="attr">loginFormRules</span>: &#123;</span><br><span class="line">      <span class="comment">// 验证用户名是否合法</span></span><br><span class="line">      <span class="attr">username</span>: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入登录名称&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">min</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">max</span>: <span class="number">10</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;长度在 3 到 10 个字符&quot;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 验证密码是否合法</span></span><br><span class="line">      <span class="attr">password</span>: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入登录密码&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">min</span>: <span class="number">6</span>,</span><br><span class="line">          <span class="attr">max</span>: <span class="number">15</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;长度在 6 到 15 个字符&quot;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>给<code>el-form-item</code> 添加<code>prop</code>属性，该属性的值为对应的校验规则属性。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form-item prop=&quot;username&quot;&gt;</span><br><span class="line">         &lt;el-input</span><br><span class="line">           prefix-icon=&quot;iconfont icon-user&quot;</span><br><span class="line">           v-model=&quot;loginForm.username&quot;</span><br><span class="line">         &gt;&lt;/el-input&gt;</span><br><span class="line">       &lt;/el-form-item&gt;</span><br><span class="line">       &lt;!-- 密码 --&gt;</span><br><span class="line">       &lt;el-form-item prop=&quot;password&quot;&gt;</span><br><span class="line">         &lt;el-input</span><br><span class="line">           prefix-icon=&quot;iconfont icon-3702mima&quot;</span><br><span class="line">           v-model=&quot;loginForm.password&quot;</span><br><span class="line">           type=&quot;password&quot;</span><br><span class="line">         &gt;&lt;/el-input&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>



<p><strong>第三：表单重置</strong></p>
<p>首先给“重置”按钮绑定单击事件，在其所对应的回调处理函数中，通过<code>resetFields( )</code>方法完成表单内容的重置。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;resetLoginForm&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么怎样调用<code>resetFields( )</code>方法呢？</p>
<p>需要获取<code>el-form</code>这个表单的实例。</p>
<p>所以，给<code>el-form</code>表单添加<code>ref</code>属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ref=<span class="string">&quot;loginFormRef&quot;</span></span><br></pre></td></tr></table></figure>

<p>在<code>resetLoginForm</code>这个方法中，我们通过当前组件的实例，获取<code>$refs</code>属性，然后通过该属性获取表单的实例，从而完成对<code>resetFields</code>方法的调用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  <span class="comment">// 点击重置按钮，重置登录表单</span></span><br><span class="line">  <span class="function"><span class="title">resetLoginForm</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(this);</span></span><br><span class="line">    <span class="built_in">this</span>.$refs.loginFormRef.resetFields();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<p>完整登录组件的整体布局如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;login_container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;login_box&quot;&gt;</span><br><span class="line">      &lt;!-- 头像区域 --&gt;</span><br><span class="line">      &lt;div class=&quot;avatar_box&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;../assets/logo.png&quot; alt /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 登录表单区域 --&gt;</span><br><span class="line">      &lt;el-form</span><br><span class="line">        label-width=&quot;0px&quot;</span><br><span class="line">        class=&quot;login_form&quot;</span><br><span class="line">        :model=&quot;loginForm&quot;</span><br><span class="line">        :rules=&quot;loginFormRules&quot;</span><br><span class="line">        ref=&quot;loginFormRef&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 用户名 --&gt;</span><br><span class="line">        &lt;el-form-item prop=&quot;username&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            prefix-icon=&quot;iconfont icon-user&quot;</span><br><span class="line">            v-model=&quot;loginForm.username&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;!-- 密码 --&gt;</span><br><span class="line">        &lt;el-form-item prop=&quot;password&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            prefix-icon=&quot;iconfont icon-3702mima&quot;</span><br><span class="line">            v-model=&quot;loginForm.password&quot;</span><br><span class="line">            type=&quot;password&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;!-- 按钮区域 --&gt;</span><br><span class="line">        &lt;el-form-item class=&quot;btns&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot;&gt;登录&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;info&quot; @click=&quot;resetLoginForm&quot;&gt;重置&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 这是登录表单的数据绑定对象</span><br><span class="line">      loginForm: &#123;</span><br><span class="line">        username: &quot;admin&quot;,</span><br><span class="line">        password: &quot;123456&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 这是表单的验证规则对象</span><br><span class="line">      loginFormRules: &#123;</span><br><span class="line">        // 验证用户名是否合法</span><br><span class="line">        username: [</span><br><span class="line">          &#123; required: true, message: &quot;请输入登录名称&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            min: 3,</span><br><span class="line">            max: 10,</span><br><span class="line">            message: &quot;长度在 3 到 10 个字符&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        // 验证密码是否合法</span><br><span class="line">        password: [</span><br><span class="line">          &#123; required: true, message: &quot;请输入登录密码&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            min: 6,</span><br><span class="line">            max: 15,</span><br><span class="line">            message: &quot;长度在 6 到 15 个字符&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 点击重置按钮，重置登录表单</span><br><span class="line">    resetLoginForm() &#123;</span><br><span class="line">      // console.log(this);</span><br><span class="line">      this.$refs.loginFormRef.resetFields();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.login_container &#123;</span><br><span class="line">  background-color: #2b4b6b;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">.login_box &#123;</span><br><span class="line">  width: 450px;</span><br><span class="line">  height: 300px;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  border-radius: 3px;</span><br><span class="line">  position: absolute;</span><br><span class="line">  left: 50%;</span><br><span class="line">  top: 50%;</span><br><span class="line">  transform: translate(-50%, -50%);</span><br><span class="line">&#125;</span><br><span class="line">.avatar_box &#123;</span><br><span class="line">  height: 130px;</span><br><span class="line">  width: 130px;</span><br><span class="line">  border: 1px solid #eee;</span><br><span class="line">  border-radius: 50%;</span><br><span class="line">  padding: 10px;</span><br><span class="line">  box-shadow: 0 0 10px #ddd;</span><br><span class="line">  position: absolute;</span><br><span class="line">  left: 50%;</span><br><span class="line">  transform: translate(-50%, -50%);</span><br><span class="line">  background-color: #fff;</span><br><span class="line">&#125;</span><br><span class="line">img &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  border-radius: 50%;</span><br><span class="line">  background-color: #eee;</span><br><span class="line">&#125;</span><br><span class="line">.login_form &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  width: 100%;</span><br><span class="line">  padding: 0 20px;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btns &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: flex-end;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关于全局样式，定义在<code>assets/css/global.css</code>文件中，在<code>main.js</code>文件中导入全局样式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./assets/css/global.css&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>global.css</code>中的初步代码：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span>,</span><br><span class="line"><span class="selector-id">#app</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于让文本框或者是密码框显示<code>icon</code>图标，也非常简单，可以使用第三方的图标库。</p>
<p>下载好的图标库(<code>fonts</code>)拷贝到<code>assets</code>目录下面，在<code>main.js</code>中引入对应的样式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./assets/fonts/iconfont.css&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>通过<code>prefix-icon</code>属性为文本框或密码框前面添加对应的图标。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">           <span class="attr">prefix-icon</span>=<span class="string">&quot;iconfont icon-user&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">v-model</span>=<span class="string">&quot;loginForm.username&quot;</span></span></span><br><span class="line"><span class="tag">         &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体的第三方图标使用方式可以参考：<code>assets/fonts/demo_fontclass.html</code>文件。</p>
<h2 id="6、登录前的表单校验"><a href="#6、登录前的表单校验" class="headerlink" title="6、登录前的表单校验"></a>6、登录前的表单校验</h2><p>当用户单击“登录”按钮的时候，不是立即发送请求，而是先进行校验，校验用户在表单中输入的数据是否正确，正确了才会向服务端发送请求。</p>
<p>当用户单击“登录”按钮的时候，是通过<code>validate</code>方法来完成对整个表单进行校验。</p>
<p>给登录按钮添加单击事件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>login</code>方法实现</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.$refs.loginFormRef.validate(<span class="function">(<span class="params">valid</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(valid);</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>通过表单实例来调用<code>validate</code>方法，来完成表单校验，注意的一点就是该方法的参数是一个回调函数，回调函数的参数表示校验的结果，如果校验成功参数<code>valid</code>为<code>true</code>,否则为<code>false</code>.</p>
<h2 id="7、配置axios发起登录请求"><a href="#7、配置axios发起登录请求" class="headerlink" title="7、配置axios发起登录请求"></a>7、配置<code>axios</code>发起登录请求</h2><p>安装<code>axios</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure>

<p>在<code>main.js</code>文件中，导入<code>axios</code>,并且将其挂载到<code>prototype</code>原型上，同时配置所要访问的服务端的根路径</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="comment">// 配置请求的跟路径</span></span><br><span class="line">axios.defaults.baseURL = <span class="string">&quot;http://127.0.0.1:8888/api/private/v1/&quot;</span>;</span><br><span class="line">Vue.prototype.$http = axios;</span><br></pre></td></tr></table></figure>

<p>下面就可以在<code>Login.vue</code>组件中的<code>login</code>方法，通过<code>axios</code>发送请求。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$refs.loginFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">      <span class="comment">// console.log(valid);</span></span><br><span class="line">      <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;<span class="comment">//出错，就终止</span></span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(<span class="string">&quot;login&quot;</span>, <span class="built_in">this</span>.loginForm);</span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> <span class="built_in">console</span>.log(<span class="string">&quot;登录失败！&quot;</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>由于<code>axios</code>挂载到了<code>Vue</code>的原型的<code>$http</code>上，所以在每个组件中都可以通过<code>this.$http</code>来获取<code>axios</code>,然后调用其中的<code>post</code>或者是<code>get</code>等方法来发送请求。</p>
<p>请求的数据就是用户在表单中输入的，而这里表单已经与<code>loginForm</code>对象进行了绑定，所以可以通过<code>loginForm</code>对象来获取用户在登录表单中输入的数据，</p>
<p><code>post</code>请求返回的结果是<code>Promise</code>对象，这里使用<code>async</code>与<code>await</code>简化其处理的过程。</p>
<p>最后判断其状态码，从而决定用户是否登录成功。</p>
<h2 id="8、配置Message提示框"><a href="#8、配置Message提示框" class="headerlink" title="8、配置Message提示框"></a>8、配置<code>Message</code>提示框</h2><p>在<code>plugins/element.js</code>文件中导入<code>Message</code>组件，并且将其挂载到<code>Vue</code>实例的原型上。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button, Form, FormItem, Input, Message &#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Button);</span><br><span class="line">Vue.use(Form);</span><br><span class="line">Vue.use(FormItem);</span><br><span class="line">Vue.use(Input);</span><br><span class="line"></span><br><span class="line">Vue.prototype.$message = Message;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改<code>Login.vue</code>组件中的<code>login</code>方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$refs.loginFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">      <span class="comment">// console.log(valid);</span></span><br><span class="line">      <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(<span class="string">&quot;login&quot;</span>, <span class="built_in">this</span>.loginForm);</span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;登录失败！&quot;</span>);</span><br><span class="line">      <span class="built_in">this</span>.$message.success(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>在登录成功后调用的是<code>Message</code>组件中的<code>success</code>方法，登录失败调用的是<code>error</code>方法。</p>
<h2 id="9、客户端存储token信息"><a href="#9、客户端存储token信息" class="headerlink" title="9、客户端存储token信息"></a>9、客户端存储<code>token</code>信息</h2><p>前面在讲解<code>token</code>的原理的时候讲解过，在客户端要存储服务端返回的<code>token</code>信息。</p>
<p>因为项目中除了登录之外的其它<code>API</code>接口，必须在登录之后才能访问。这样，在访问其它的接口的时候，浏览器只要将存储的<code>token</code>信息发送到服务端，服务端校验成功，就允许客户端访问指定的接口。</p>
<p>那么，<code>token</code>信息是存储在<code>sessionStorage</code>中呢？还是<code>localStorage</code>中呢？</p>
<p><code>token</code>信息只在当前网站打开期间生效，所以将<code>token信息</code>存储到<code>sessionStorage</code>中。</p>
<p>下面我们来看一下，具体的实现。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">login</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="built_in">this</span>.$refs.loginFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">     <span class="comment">// console.log(valid);</span></span><br><span class="line">     <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;</span><br><span class="line">     <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(<span class="string">&quot;login&quot;</span>, <span class="built_in">this</span>.loginForm);</span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;登录失败！&quot;</span>);</span><br><span class="line">     <span class="built_in">this</span>.$message.success(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">     <span class="comment">//存储token信息</span></span><br><span class="line">     <span class="built_in">window</span>.sessionStorage.setItem(<span class="string">&quot;token&quot;</span>, res.data.token);</span><br><span class="line">     <span class="comment">//跳转到home页面</span></span><br><span class="line">     <span class="built_in">this</span>.$router.push(<span class="string">&quot;/home&quot;</span>);</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>当用户登录成功后，将<code>token</code>信息存储到<code>sessionStorage</code>中，同时，跳转到<code>home</code>页面。</p>
<p>在<code>components</code>目录下创建<code>Home.vue</code>.</p>
<p>基本的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;Home组件&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时在<code>route.js</code>文件中，定义基本的路由规则</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>, <span class="attr">component</span>: Home &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="10、通过路由导航守卫控制页面访问权限"><a href="#10、通过路由导航守卫控制页面访问权限" class="headerlink" title="10、通过路由导航守卫控制页面访问权限"></a>10、通过路由导航守卫控制页面访问权限</h2><p>通过前面的讲解，我们知道要想访问<code>Home</code>组件的内容，必须要登录。</p>
<p>但是，现在面临的一个问题就是，如果某个用户知道了访问<code>Home</code>组件的<code>URL</code>地址，那么他可以在地址栏中直接输入该地址，也可以访问<code>Home</code>组件（这里可以删除<code>token</code>信息来演示一下），这样整个登录就没有任何的效果。</p>
<p>怎样避免这个问题呢？</p>
<p>这就需要用到路由导航守卫来解决这个问题。也就是如果用户没有登录，但是直接通过<code>URL</code>访问特定页面，需要重新跳转到登录页面，进行登录。登录以后才能访问。</p>
<p>路由导航守卫基本用法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为路由对象，添加`beforeEach`导航守卫</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//如果用户访问的是登录页，直接放行</span></span><br><span class="line">    <span class="keyword">if</span>(to.path===<span class="string">&#x27;/login&#x27;</span>) <span class="keyword">return</span> next()</span><br><span class="line">    <span class="keyword">const</span> tokenStr=<span class="built_in">window</span>.sessionStorage.getItem(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="comment">// 没有token,强制跳转到登录页</span></span><br><span class="line">    <span class="keyword">if</span>(!tokenStr) <span class="keyword">return</span> next(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>路由导航守卫本质就是<code>beforeEach</code>函数，该函数需要一个回调函数作为参数，回调函数中第一个参数<code>to</code>,表示将要访问的地址，<code>from</code>:表示是从哪个地址跳转过来的。<code>next</code> 表示继续执行的函数。</p>
<p>下面看一下<code>router.js</code>文件的代码改造</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>, <span class="attr">component</span>: Home &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 挂载路由导航守卫</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// to 将要访问的路径</span></span><br><span class="line">  <span class="comment">// from 代表从哪个路径跳转而来</span></span><br><span class="line">  <span class="comment">// next 是一个函数，表示放行</span></span><br><span class="line">  <span class="comment">//     next()  放行    next(&#x27;/login&#x27;)  强制跳转到登录页</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (to.path === <span class="string">&quot;/login&quot;</span>) <span class="keyword">return</span> next();</span><br><span class="line">  <span class="comment">// 获取token</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = <span class="built_in">window</span>.sessionStorage.getItem(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!tokenStr) <span class="keyword">return</span> next(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="11、实现退出功能"><a href="#11、实现退出功能" class="headerlink" title="11、实现退出功能"></a>11、实现退出功能</h2><p>基于<code>token</code>的方式实现退出功能比较简单，只要销毁本地的<code>token</code>即可。这样，后续的请求就不会懈怠<code>token</code>，必须重新登录以后，生成一个新的<code>token</code>之后才可以访问其它的页面。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 清空token   </span></span><br><span class="line"><span class="built_in">window</span>.sessionStorage.clear()  </span><br><span class="line"><span class="comment">// 跳转到登录页   </span></span><br><span class="line"><span class="built_in">this</span>.$router.push(<span class="string">&#x27;/login&#x27;</span>) </span><br></pre></td></tr></table></figure>

<p>在<code>Home</code>组件中，添加一个“退出”按钮，实现退出功能。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-button type=&quot;info&quot; @click=&quot;logout&quot;&gt;退出&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    logout() &#123;</span><br><span class="line">      window.sessionStorage.clear();</span><br><span class="line">      this.$router.push(&quot;/login&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style  scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h1 id="三、主页布局和功能实现"><a href="#三、主页布局和功能实现" class="headerlink" title="三、主页布局和功能实现"></a>三、主页布局和功能实现</h1><h2 id="1、主页基本布局实现"><a href="#1、主页基本布局实现" class="headerlink" title="1、主页基本布局实现"></a>1、主页基本布局实现</h2><p>这里主要是使用了<code>element-ui</code>中的布局组件完成的。</p>
<p><code>Home.vue</code>组件的布局如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container class=&quot;home-container&quot;&gt;</span><br><span class="line">    &lt;!-- 头部区域 --&gt;</span><br><span class="line">    &lt;el-header&gt;</span><br><span class="line">      &lt;el-button type=&quot;info&quot; @click=&quot;logout&quot;&gt;退出&lt;/el-button&gt;Header</span><br><span class="line">    &lt;/el-header&gt;</span><br><span class="line">    &lt;!-- 页面主体区域 --&gt;</span><br><span class="line">    &lt;el-container&gt;</span><br><span class="line">      &lt;!-- 侧边栏 --&gt;</span><br><span class="line">      &lt;el-aside width=&quot;200px&quot;&gt;Aside&lt;/el-aside&gt;</span><br><span class="line">      &lt;!-- 右侧内容主体 --&gt;</span><br><span class="line">      &lt;el-main&gt;Main&lt;/el-main&gt;</span><br><span class="line">    &lt;/el-container&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    logout() &#123;</span><br><span class="line">      window.sessionStorage.clear();</span><br><span class="line">      this.$router.push(&quot;/login&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style  scoped&gt;</span><br><span class="line">.home-container &#123;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">.el-header &#123;</span><br><span class="line">  background-color: #373d41;</span><br><span class="line">&#125;</span><br><span class="line">.el-aside &#123;</span><br><span class="line">  background-color: #333744;</span><br><span class="line">&#125;</span><br><span class="line">.el-main &#123;</span><br><span class="line">  background-color: #eaedf1;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>注意：在<code>plugins/element.js</code>文件中要导入相应的布局组件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Button,</span><br><span class="line">  Form,</span><br><span class="line">  FormItem,</span><br><span class="line">  Input,</span><br><span class="line">  Message,</span><br><span class="line">  Container,</span><br><span class="line">  Header,</span><br><span class="line">  Aside,</span><br><span class="line">  Main,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Button);</span><br><span class="line">Vue.use(Form);</span><br><span class="line">Vue.use(FormItem);</span><br><span class="line">Vue.use(Input);</span><br><span class="line">Vue.use(Container);</span><br><span class="line">Vue.use(Header);</span><br><span class="line">Vue.use(Aside);</span><br><span class="line">Vue.use(Main);</span><br><span class="line">Vue.prototype.$message = Message;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2、头部区域布局设计"><a href="#2、头部区域布局设计" class="headerlink" title="2、头部区域布局设计"></a>2、头部区域布局设计</h2><p>首先对头部区域的结构做了一个简单的修改，添加了<code>logo</code>图标，以及相应的文字。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 头部区域 --&gt;</span><br><span class="line">   &lt;el-header&gt;</span><br><span class="line">     &lt;div class=&quot;header-div&quot;&gt;</span><br><span class="line">       &lt;img src=&quot;../assets/logo.png&quot; alt=&quot;logo&quot; /&gt;</span><br><span class="line">       &lt;span&gt;电商后台管理系统&lt;/span&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">     &lt;el-button type=&quot;info&quot; @click=&quot;logout&quot;&gt;退出&lt;/el-button&gt;</span><br><span class="line">   &lt;/el-header&gt;</span><br></pre></td></tr></table></figure>

<p>下面就是对头部区域的样式处理</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.el-header</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#373d41</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.header-div</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、实现导航菜单的基本结构"><a href="#3、实现导航菜单的基本结构" class="headerlink" title="3、实现导航菜单的基本结构"></a>3、实现导航菜单的基本结构</h2><p>这里需要了解<code>element-ui</code>中导航菜单的基本使用就可以。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 页面主体区域 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 侧边栏 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot;200px&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--菜单区域--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">el-menu</span></span></span><br><span class="line"><span class="tag">       <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">background-color</span>=<span class="string">&quot;#545c64&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">text-color</span>=<span class="string">&quot;#fff&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">active-text-color</span>=<span class="string">&quot;#ffd04b&quot;</span></span></span><br><span class="line"><span class="tag">     &gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 一级菜单 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 一级菜单的模板区域 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-location&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 文本 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">span</span>&gt;</span>导航一<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 二级菜单 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">index</span>=<span class="string">&quot;1-1&quot;</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-location&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- 文本 --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">span</span>&gt;</span>导航一<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">el-aside</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 右侧内容主体 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里我们是在<code>&lt;el-aside&gt;</code>左侧区域添加了一个菜单，而且这里要求菜单只保留到二级菜单。</p>
<p>在<code>element.js</code>文件中，添加对菜单组件的注册。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  Button,</span><br><span class="line">  Form,</span><br><span class="line">  FormItem,</span><br><span class="line">  Input,</span><br><span class="line">  Message,</span><br><span class="line">  Container,</span><br><span class="line">  Header,</span><br><span class="line">  Aside,</span><br><span class="line">  Main,</span><br><span class="line">  Menu,</span><br><span class="line">  Submenu,</span><br><span class="line">  MenuItem,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Button);</span><br><span class="line">Vue.use(Form);</span><br><span class="line">Vue.use(FormItem);</span><br><span class="line">Vue.use(Input);</span><br><span class="line">Vue.use(Container);</span><br><span class="line">Vue.use(Header);</span><br><span class="line">Vue.use(Aside);</span><br><span class="line">Vue.use(Main);</span><br><span class="line">Vue.use(Menu);</span><br><span class="line">Vue.use(Submenu);</span><br><span class="line">Vue.use(MenuItem);</span><br><span class="line">Vue.prototype.$message = Message;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4、通过axios-拦截器添加token验证"><a href="#4、通过axios-拦截器添加token验证" class="headerlink" title="4、通过axios 拦截器添加token验证"></a>4、通过<code>axios</code> 拦截器添加<code>token</code>验证</h2><p>现在我们面临的一个问题，就是如果想要访问受保护的<code>API</code>应该怎样处理呢？</p>
<p>对了，可以将我们存在<code>sessionStorage</code>中的<code>token</code>信息发送到服务端，服务端就可以进行校验，如果合法，运行访问其对应的接口，</p>
<p>关键是怎样将<code>token</code>信息发送到服务端呢？</p>
<p>必须在请求头中使用<code>Authorization</code>字段来保存<code>token</code>数据。这时通过该字段，可以将<code>token</code>数据发送到服务端。</p>
<p>而我们知道，在我们的系统中，除了登录接口不需要<code>token</code>数据以外，其它的接口都是需要的，这就需要在每个请求服务端的<code>API</code>接口中都要加上<code>Authorization</code>字段。</p>
<p>那问题是怎样在每个请求中都加上<code>Authorization</code>字段呢？</p>
<p>这里可以通过<code>axios</code>请求拦截器添加<code>token</code>信息。</p>
<p>基本的语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// axios请求拦截   </span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;    </span><br><span class="line">    <span class="comment">// 为请求头对象，添加 Token 验证的 Authorization 字段    </span></span><br><span class="line">    config.headers.Authorization = <span class="built_in">window</span>.sessionStorage.getItem(<span class="string">&#x27;token&#x27;</span>) </span><br><span class="line">    <span class="keyword">return</span> config </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>axios</code>中的<code>interceptors</code> 属性中有一个<code>request</code>,它就是<code>axios</code>的请求拦截器。</p>
<p>也就是说，每次使用<code>axios</code>向服务器发送请求，都会先执行<code>request</code>这个拦截器。这时会调用<code>use</code>函数（也就是请求在到达服务端之前，先执行<code>use</code>函数），在该函数的回调函数中，对请求进行处理，处理完成后继续向下执行，也就是将请求的内容做了一次处理后，在发送到服务端。</p>
<p>具体实现如下，在<code>main.js</code>文件中，在将<code>axios</code>挂载到<code>Vue</code>原型对象上之前，启用<code>axios</code>的拦截器。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="comment">// 配置请求的跟路径</span></span><br><span class="line">axios.defaults.baseURL = <span class="string">&quot;http://127.0.0.1:8888/api/private/v1/&quot;</span>;</span><br><span class="line"><span class="comment">//axios拦截器</span></span><br><span class="line">axios.interceptors.request.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(config)</span></span><br><span class="line">  config.headers.Authorization = <span class="built_in">window</span>.sessionStorage.getItem(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">  <span class="comment">//最后必须返回config</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.prototype.$http = axios;</span><br></pre></td></tr></table></figure>

<h2 id="5、获取左侧菜单数据"><a href="#5、获取左侧菜单数据" class="headerlink" title="5、获取左侧菜单数据"></a>5、获取左侧菜单数据</h2><p>在<code>Home.vue</code>中发送请求，获取菜单数据。实现代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">menulist</span>: [],<span class="comment">//菜单数据</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">//调用getMenuList方法获取菜单数据</span></span><br><span class="line">    <span class="built_in">this</span>.getMenuList();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="function"><span class="title">logout</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.sessionStorage.clear();</span><br><span class="line">      <span class="built_in">this</span>.$router.push(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取菜单数据</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getMenuList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;menus&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(res.meta.msg);</span><br><span class="line">      <span class="built_in">this</span>.menulist = res.data;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在组件创建完成后，发送请求获取菜单数据。</p>
<h2 id="6、渲染菜单结构"><a href="#6、渲染菜单结构" class="headerlink" title="6、渲染菜单结构"></a>6、渲染菜单结构</h2><p>在上面的案例中，我们已经获取到了菜单数据。下面要将菜单数据渲染到页面中。</p>
<p>注意：服务端返回的菜单数据的格式。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一级菜单 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">el-submenu</span> <span class="attr">:index</span>=<span class="string">&quot;item.id + &#x27;&#x27;&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;item in menulist&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 一级菜单的模板区域 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-location&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 文本 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.authName&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 二级菜单 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">:index</span>=<span class="string">&quot;subItem.id+&#x27;&#x27;&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;subItem in item.children&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;subItem.id&quot;</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-location&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 文本 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;subItem.authName&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">el-submenu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于服务端返回的菜单数据只要两级，所以这里通过两个<code>for</code>循环嵌套，就可以获取到所有的菜单数据。</p>
<p>首先，第一层循环遍历<code>menulist</code>,获取一级菜单的内容，注意:<code>index</code>属性的取值只能为字符串，不能能为数字，并且要唯一，</p>
<p>然后，第二层循环遍历<code>item.children</code>获取二级菜单内容。</p>
<p>思考：如果是多层菜单（不止二层）应该怎样处理？</p>
<h2 id="7、菜单图标处理"><a href="#7、菜单图标处理" class="headerlink" title="7、菜单图标处理"></a>7、菜单图标处理</h2><p>在<code>Home.vue</code>组件中更换菜单名称前面的图标。</p>
<p>这里一级菜单的图标，使用的是第三方的图标。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     <span class="attr">menulist</span>: [],</span><br><span class="line">     <span class="comment">// 菜单图标</span></span><br><span class="line">     <span class="attr">iconsObj</span>: &#123;</span><br><span class="line">       <span class="string">&quot;125&quot;</span>: <span class="string">&quot;iconfont icon-user&quot;</span>,</span><br><span class="line">       <span class="string">&quot;103&quot;</span>: <span class="string">&quot;iconfont icon-tijikongjian&quot;</span>,</span><br><span class="line">       <span class="string">&quot;101&quot;</span>: <span class="string">&quot;iconfont icon-shangpin&quot;</span>,</span><br><span class="line">       <span class="string">&quot;102&quot;</span>: <span class="string">&quot;iconfont icon-danju&quot;</span>,</span><br><span class="line">       <span class="string">&quot;145&quot;</span>: <span class="string">&quot;iconfont icon-baobiao&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p><code>iconsObj</code> 对象中存储的是一级菜单的编号与图标样式的对应关系。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">:class</span>=<span class="string">&quot;iconsObj[item.id]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里对一级菜单的样式进行动态的绑定，从<code>iconsObj</code>对象中根据菜单编号获取具体的样式。</p>
<p>二级菜单采用固定的图标</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-menu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>调整图标与菜单名称之间的填充距。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.iconfont</span> &#123;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们要实现的效果就是每次只打开一个菜单项。</p>
<p>这里需要给<code>&lt;el-menu&gt;</code>添加<code>unique-opened</code>属性就可以了。</p>
<p>同时，当我们单击，二级菜单的时候，发现菜单超出了指定区域，这里只需要将<code>&lt;el-menu&gt;</code>的边框去掉就可以了。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.el-menu &#123;</span><br><span class="line">   border-right: none;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="8、左侧菜单的折叠与展开效果"><a href="#8、左侧菜单的折叠与展开效果" class="headerlink" title="8、左侧菜单的折叠与展开效果"></a>8、左侧菜单的折叠与展开效果</h2><p>首先在侧边栏下面添加一个折叠的图标。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 侧边栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot; 200px&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;toggle-button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toggleCollapse&quot;</span>&gt;</span>|||<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面定义对应的样式</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.toggle-button</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#4a5064</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">letter-spacing</span>: <span class="number">0.2em</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制菜单的折叠与展开，需要给<code>el-menu</code>添加<code>collapse</code>属性，该属性为<code>true</code>,表示展开菜单，为<code>false</code>折叠菜单。</p>
<p>同时，可以给<code>el-menu</code>添加属性<code>collapse-transition</code>将菜单折叠的动画去掉，为<code>false</code>的时候就可以去掉。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-menu</span></span></span><br><span class="line"><span class="tag">         <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">background-color</span>=<span class="string">&quot;#545c64&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">text-color</span>=<span class="string">&quot;#fff&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">active-text-color</span>=<span class="string">&quot;#409EFF&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">unique-opened</span></span></span><br><span class="line"><span class="tag">         <span class="attr">:collapse</span>=<span class="string">&quot;isCollapse&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">:collapse-transition</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">       &gt;</span></span><br></pre></td></tr></table></figure>

<p><code>isCollapse</code>属性的定义如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">     <span class="attr">menulist</span>: [],</span><br><span class="line">     <span class="comment">// 菜单图标</span></span><br><span class="line">     <span class="attr">iconsObj</span>: &#123;</span><br><span class="line">       <span class="string">&quot;125&quot;</span>: <span class="string">&quot;iconfont icon-user&quot;</span>,</span><br><span class="line">       <span class="string">&quot;103&quot;</span>: <span class="string">&quot;iconfont icon-tijikongjian&quot;</span>,</span><br><span class="line">       <span class="string">&quot;101&quot;</span>: <span class="string">&quot;iconfont icon-shangpin&quot;</span>,</span><br><span class="line">       <span class="string">&quot;102&quot;</span>: <span class="string">&quot;iconfont icon-danju&quot;</span>,</span><br><span class="line">       <span class="string">&quot;145&quot;</span>: <span class="string">&quot;iconfont icon-baobiao&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="comment">// 是否折叠</span></span><br><span class="line">     <span class="attr">isCollapse</span>: <span class="literal">false</span>,</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>

<p><code>isCollapse</code>属性默认值为<code>false</code>,表示菜单是不折叠的。</p>
<p>当单击了按钮后，在<code>toggleCollapse</code>方法中修改<code>isCollapse</code>属性,控制菜单的隐藏域展示</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，切换菜单的折叠与展开</span></span><br><span class="line">   <span class="function"><span class="title">toggleCollapse</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.isCollapse = !<span class="built_in">this</span>.isCollapse;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>由于整个菜单所在的左侧区域的宽度在这里，都固定死了，为<code>200px</code>.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot; 200px&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样导致的结果就是，当菜单折叠起来以后，整个左侧区域的宽度没有改变，这样效果比较差。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">:width</span>=<span class="string">&quot;isCollapse ? &#x27;64px&#x27; : &#x27;200px&#x27;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以这里根据菜单是否折叠，动态修改左侧区域的宽度。</p>
<h2 id="9、实现首页路由的重定向"><a href="#9、实现首页路由的重定向" class="headerlink" title="9、实现首页路由的重定向"></a>9、实现首页路由的重定向</h2><p>当用户登录成功后，会展示<code>Home</code>组件的内容，但是这里我们还想展示一个欢迎组件中的内容。</p>
<p>这里可以使用子路由以及路由重定向来实现。</p>
<p>下面，先在<code>components</code>中定义一个欢迎的组件<code>Welcome.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;欢迎登录电商管理系统&lt;/h2&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>注意：如果组件中只是展示固定的内容，并且没有样式，可以只写一个<code>template</code>模板。</p>
<p>修改<code>router.js</code>文件中的路由规则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="comment">//导入Welcome组件</span></span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [&#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当用户访问<code>/home</code>的时候，先呈现出<code>Home</code>组件的内容，然后重定向到<code>/welcome</code>，这时会展示<code>Welcome</code>组件的内容。</p>
<p>那么<code>Welcome</code>组件的内容是在<code>Home</code>组件中进行展示，所以需要在<code>Home</code>组件中使用<code> &lt;router-view&gt;</code>添加一个占位符。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 右侧内容主体 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">el-main</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里在<code>Home</code>组件的右侧内容主体区域展示<code>Welcome</code>组件的内容。</p>
<h2 id="10、启用菜单链接功能"><a href="#10、启用菜单链接功能" class="headerlink" title="10、启用菜单链接功能"></a>10、启用菜单链接功能</h2><p>要想让<code>element-ui</code>的菜单具有链接功能，需要为菜单添加<code> router</code>属性，默认值为<code>true</code>,表示启用超链接功能。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-menu</span></span></span><br><span class="line"><span class="tag">        <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">background-color</span>=<span class="string">&quot;#545c64&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">text-color</span>=<span class="string">&quot;#fff&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">active-text-color</span>=<span class="string">&quot;#409EFF&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">unique-opened</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:collapse</span>=<span class="string">&quot;isCollapse&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:collapse-transition</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">router</span> &lt;!<span class="attr">--</span>启用链接<span class="attr">--</span>&gt;</span></span><br><span class="line">      &gt;</span><br></pre></td></tr></table></figure>

<p>当单击二级菜单的时候，要跳转到具体的页面。</p>
<p>那么地址应该怎样确定呢？</p>
<p>当单击二级菜单的时候，发现模拟的值为<code>&lt;el-menu-item&gt;</code>的<code>index</code>属性的取值。</p>
<p>所以这里需要将<code>index</code>的值，修改成菜单的地址，而这个地址数据是服务端返回的。</p>
<p>所以修改后的内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-menu-item</span></span></span><br><span class="line"><span class="tag">             <span class="attr">:index</span>=<span class="string">&quot;&#x27;/&#x27; + subItem.path&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">v-for</span>=<span class="string">&quot;subItem in item.children&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">:key</span>=<span class="string">&quot;subItem.id&quot;</span></span></span><br><span class="line"><span class="tag">           &gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 图标 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-menu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 文本 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;subItem.authName&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码中，修改了<code>index</code>属性的取值，注意路径前面要加上<code>/</code>.</p>
<h1 id="四、用户列表布局和功能实现"><a href="#四、用户列表布局和功能实现" class="headerlink" title="四、用户列表布局和功能实现"></a>四、用户列表布局和功能实现</h1><h2 id="1、用户列表基本展示"><a href="#1、用户列表基本展示" class="headerlink" title="1、用户列表基本展示"></a>1、用户列表基本展示</h2><p>当单击菜单“用户列表”的时候，将用户列表组件，在其右侧进行展示。</p>
<p>首先，在<code>components</code>目录下面创建<code>user</code>目录，该目录存放的就是用户列表组件<code>Users.vue</code>.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<code>router.js</code>文件中定义路由规则。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在<code>Home</code>添加子路由，这样如果用户输入的是<code>/users</code>，那么会展示<code>User</code>组件的内容，并且是在<code>Home</code>组件的”右侧内容主体”区域展示</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 右侧内容主体 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">el-main</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2、保存菜单的激活状态"><a href="#2、保存菜单的激活状态" class="headerlink" title="2、保存菜单的激活状态"></a>2、保存菜单的激活状态</h2><p>当单击了某个菜单项以后，应该让该菜单高亮显示，同时如果用户单击刷新按钮，也应该能够保持菜单的高亮显示。</p>
<p>这里需要给<code>&lt;el-menu&gt;</code>添加<code>default-active</code>属性来实现，如果该属性的值为<code>/users</code>（菜单的路径，也就是<code>index</code>属性的值），表明用户列表这个菜单被选中。</p>
<p>首先，让<code>default-active</code>属性绑定一个动态值<code>activePath</code>,默认值为空字符串。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-menu</span></span></span><br><span class="line"><span class="tag">         &lt;!<span class="attr">--</span>添加<span class="attr">default-active--</span>&gt;</span></span><br><span class="line">         :default-active=&quot;activePath&quot;</span><br><span class="line">         background-color=&quot;#545c64&quot;</span><br><span class="line">         text-color=&quot;#fff&quot;</span><br><span class="line">         active-text-color=&quot;#409EFF&quot;</span><br><span class="line">         unique-opened</span><br><span class="line">         :collapse=&quot;isCollapse&quot;</span><br><span class="line">         :collapse-transition=&quot;false&quot;</span><br><span class="line">         router</span><br><span class="line">       &gt;</span><br></pre></td></tr></table></figure>

<p><code>activePath</code>属性的定义如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">menulist</span>: [],</span><br><span class="line">    <span class="attr">iconsObj</span>: &#123;</span><br><span class="line">      <span class="string">&quot;125&quot;</span>: <span class="string">&quot;iconfont icon-user&quot;</span>,</span><br><span class="line">      <span class="string">&quot;103&quot;</span>: <span class="string">&quot;iconfont icon-tijikongjian&quot;</span>,</span><br><span class="line">      <span class="string">&quot;101&quot;</span>: <span class="string">&quot;iconfont icon-shangpin&quot;</span>,</span><br><span class="line">      <span class="string">&quot;102&quot;</span>: <span class="string">&quot;iconfont icon-danju&quot;</span>,</span><br><span class="line">      <span class="string">&quot;145&quot;</span>: <span class="string">&quot;iconfont icon-baobiao&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">isCollapse</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 被激活的链接地址</span></span><br><span class="line">    <span class="attr">activePath</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>下面，我们要考虑的就是，单击了哪个二级菜单，就需要将对应的地址赋值给<code>activePath</code>属性。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 二级菜单 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:index</span>=<span class="string">&quot;&#x27;/&#x27; + subItem.path&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-for</span>=<span class="string">&quot;subItem in item.children&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:key</span>=<span class="string">&quot;subItem.id&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">click</span>=<span class="string">&quot;saveNavState(&#x27;/&#x27; + subItem.path)&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码找中，我们给二级菜单添加了单击事件，当事件触发后执行<code>saveNavState</code>方法，将所单击的菜单的路径作为参数传递到该方法中，</p>
<p>在该方法中，将传递过来的菜单的地址赋值给<code>activePath</code>属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 保存链接的激活状态</span></span><br><span class="line">   <span class="function"><span class="title">saveNavState</span>(<span class="params">activePath</span>)</span> &#123;</span><br><span class="line">     <span class="built_in">window</span>.sessionStorage.setItem(<span class="string">&#x27;activePath&#x27;</span>, activePath)</span><br><span class="line">     <span class="built_in">this</span>.activePath = activePath</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>同时，这里还要考虑当单击刷新按钮的时候，也要保持当前所单击菜单的选中状态，也就是高亮状态，所以将所单击的菜单的地址存储到了<code>sessionStorage</code>中。</p>
<p>而当点击浏览器的刷新按钮的时候，会执行<code>created</code>这个钩子函数，所以这里需要在该钩子函数中，把<code>sessionStorage</code>中存储的地址取出来，交给<code>activePath</code>属性。</p>
<h2 id="3、用户列表基本布局实现"><a href="#3、用户列表基本布局实现" class="headerlink" title="3、用户列表基本布局实现"></a>3、用户列表基本布局实现</h2><p>在用户列表的基本布局中，创建了面包屑，同时创建了卡片区域，在卡片区域中通过<code>el-row</code>与<code>el-col</code>进行了栅格布局。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 面包屑导航区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-breadcrumb</span> <span class="attr">separator-class</span>=<span class="string">&quot;el-icon-arrow-right&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-breadcrumb-item</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">el-breadcrumb-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-breadcrumb-item</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">el-breadcrumb-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-breadcrumb-item</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">el-breadcrumb-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-breadcrumb</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 卡片视图区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 搜索与添加区域，gutter：栅格间隔 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--占8列--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入内容&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">slot</span>=<span class="string">&quot;append&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时需要在<code>element.js</code>文件中完成组件的注册。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.use(Breadcrumb);</span><br><span class="line">Vue.use(BreadcrumbItem);</span><br><span class="line">Vue.use(Card);</span><br><span class="line">Vue.use(Row);</span><br><span class="line">Vue.use(Col);</span><br></pre></td></tr></table></figure>

<p>如果需要修改全局的样式，定义在<code>assets/css/global.css</code>文件中。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 全局样式表 */</span></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span>,</span><br><span class="line"><span class="selector-id">#app</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-breadcrumb</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.el-card</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">1px</span> <span class="number">1px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.15</span>) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4、获取用户列表数据"><a href="#4、获取用户列表数据" class="headerlink" title="4、获取用户列表数据"></a>4、获取用户列表数据</h2><p>在<code>Users.vue</code>组件中的<code>created</code>钩子函数中，构建请求，获取用户数据，这次请求的方式为<code>get</code>请求，并且需要参数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 获取用户列表的参数对象</span></span><br><span class="line">      <span class="attr">queryInfo</span>: &#123;</span><br><span class="line">        <span class="attr">query</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="comment">// 当前的页数</span></span><br><span class="line">        <span class="attr">pagenum</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// 当前每页显示多少条数据</span></span><br><span class="line">        <span class="attr">pagesize</span>: <span class="number">2</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">userlist</span>: [],</span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.getUserList();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getUserList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;users&quot;</span>, &#123;</span><br><span class="line">          <span class="comment">//通过params组织参数。</span></span><br><span class="line">        <span class="attr">params</span>: <span class="built_in">this</span>.queryInfo,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取用户列表失败！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="comment">//获取用户数据</span></span><br><span class="line">      <span class="built_in">this</span>.userlist = res.data.users;</span><br><span class="line">        <span class="comment">//获取总的记录数。</span></span><br><span class="line">      <span class="built_in">this</span>.total = res.data.total;</span><br><span class="line">      <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5、使用表格展示用户数据"><a href="#5、使用表格展示用户数据" class="headerlink" title="5、使用表格展示用户数据"></a>5、使用表格展示用户数据</h2><p>表格基本使用比较简单，具体的细节可以参考文档。</p>
<p>我们是在<code>el-card</code>中，直接添加了表格内容。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 卡片视图区域 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-card</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 搜索与添加区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入内容&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">slot</span>=<span class="string">&quot;append&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用户列表区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;userlist&quot;</span> <span class="attr">border</span> <span class="attr">stripe</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;index&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;姓名&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;邮箱&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;电话&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;mobile&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;角色&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;role_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;状态&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>给表格指定了数据源，边框，以及各行换色的功能。</p>
<p>同时给表格添加了表头，以及通过<code>prop</code>指定每列所展示的数据。</p>
<p>在<code>element.js</code>文件中完成对表格组件的注册。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.use(Table);</span><br><span class="line">Vue.use(TableColumn);</span><br></pre></td></tr></table></figure>

<p>可以在<code>global.css</code>中对表格的样式进行重写。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.el-table</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6、自定义状态列的显示效果"><a href="#6、自定义状态列的显示效果" class="headerlink" title="6、自定义状态列的显示效果"></a>6、自定义状态列的显示效果</h2><p>在表格的状态这一列上添加一个<code>switch</code>开关，如果获取到的状态是<code>true</code>,则让<code>switch</code>开关处于打开状态，否则处于关闭状态。</p>
<p>在表格的状态这一列中，添加一个作用域的插槽（可以通过<code>scope</code>来获取到当前行的数据），在插槽中使用了<code>el-switch</code>组件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;状态&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">el-switch</span> <span class="attr">v-model</span>=<span class="string">&quot;scope.row.mg_state&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-switch</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<code>element.js</code>文件中也需要完成<code>Switch</code>组件的注册</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vue.use(Switch);</span><br></pre></td></tr></table></figure>

<p>插槽的问题。</p>
<h2 id="7、自定义操作列"><a href="#7、自定义操作列" class="headerlink" title="7、自定义操作列"></a>7、自定义操作列</h2><p>关于用户列表中的操作列，也是通过作用域插槽来完成的。</p>
<p>因为，我们在单击删除按钮，或者是编辑按钮的时候是可以通过<code>scope</code>来获取对应用户的编号的。</p>
<p>在这里，我们先把基本结构创建出来，后期在完善作用域插槽。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">width</span>=<span class="string">&quot;180px&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 修改按钮 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-edit&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 删除按钮 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-delete&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 分配角色按钮 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-tooltip</span> <span class="attr">effect</span>=<span class="string">&quot;dark&quot;</span> <span class="attr">content</span>=<span class="string">&quot;分配角色&quot;</span> <span class="attr">placement</span>=<span class="string">&quot;top&quot;</span> <span class="attr">:enterable</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-setting&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">el-tooltip</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时在<code>element.js</code>文件中导入<code>Tooltip</code>组件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vue.use(Tooltip);</span><br></pre></td></tr></table></figure>

<h2 id="8、实现分页效果"><a href="#8、实现分页效果" class="headerlink" title="8、实现分页效果"></a>8、实现分页效果</h2><p>在<code>Users.vue</code>组件中使用分页组件完成分页。</p>
<p>在<code>el-table</code>下面添加分页组件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页区域 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">     @<span class="attr">size-change</span>=<span class="string">&quot;handleSizeChange&quot;</span></span></span><br><span class="line"><span class="tag">     @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">:current-page</span>=<span class="string">&quot;queryInfo.pagenum&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">:page-sizes</span>=<span class="string">&quot;[1, 2, 5, 10]&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">:page-size</span>=<span class="string">&quot;queryInfo.pagesize&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">:total</span>=<span class="string">&quot;total&quot;</span></span></span><br><span class="line"><span class="tag">   &gt;</span><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对应处理函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 监听 pagesize 改变的事件，当每页显示的记录数发生改变了，重新获取数据。</span></span><br><span class="line">  <span class="function"><span class="title">handleSizeChange</span>(<span class="params">newSize</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(newSize)</span></span><br><span class="line">    <span class="built_in">this</span>.queryInfo.pagesize = newSize;</span><br><span class="line">    <span class="built_in">this</span>.getUserList();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 监听 页码值 改变的事件,当页码值发生改变了，重新获取数据</span></span><br><span class="line">  <span class="function"><span class="title">handleCurrentChange</span>(<span class="params">newPage</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(newPage);</span><br><span class="line">    <span class="built_in">this</span>.queryInfo.pagenum = newPage;</span><br><span class="line">    <span class="built_in">this</span>.getUserList();</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>注册<code>Pagination</code>组件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vue.use(Pagination);</span><br></pre></td></tr></table></figure>

<p>也可以在<code>global.css</code>中修改对应的样式。</p>
<h2 id="9、修改用户状态"><a href="#9、修改用户状态" class="headerlink" title="9、修改用户状态"></a>9、修改用户状态</h2><p>当单击<code>Switch</code>组件的时候，需要完成用户状态的更新。</p>
<p>当<code>Switch</code>组件改变的时候，会触发<code>change</code>事件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-switch</span> <span class="attr">v-model</span>=<span class="string">&quot;scope.row.mg_state&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;userStateChanged(scope.row)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-switch</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这里我们将<code>scope.row.mg_state</code>与<code>switch</code>进行了双向数据绑定，如果<code>mg_state</code>属性的值为<code>false</code>,表示<code>switch</code>关闭状态，否则就是打开状态。</p>
<p>反之，如果我们手动的修改了<code>switch</code>组件的状态，那么<code>mg_state</code> 的值也会发生变化。</p>
<p>假如我们现在将一个<code>switch</code>组件的状态有关闭状态修改成打开的状态，那么<code>mg_state</code>的值也会有<code>false</code>变成<code>true</code>,那么接下来要做的就是发送一个异步的请求，将这个数据发送到服务端，从而完成当前用户状态的更新。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 监听 switch 开关状态的改变</span></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">userStateChanged</span>(<span class="params">userinfo</span>)</span> &#123;</span><br><span class="line">   <span class="comment">//console.log(userinfo);</span></span><br><span class="line">   <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.put(</span><br><span class="line">     <span class="string">`users/<span class="subst">$&#123;userinfo.id&#125;</span>/state/<span class="subst">$&#123;userinfo.mg_state&#125;</span>`</span></span><br><span class="line">   );</span><br><span class="line">   <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">     userinfo.mg_state = !userinfo.mg_state;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;更新用户状态失败！&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">this</span>.$message.success(<span class="string">&quot;更新用户状态成功！&quot;</span>);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>注意：这里发送请求的方式为<code>put</code>.</p>
<p>同时还需要注意：如果更新数据库失败了，我们要将<code>switch</code>组件的状态进行还原。也就是说，我们手动的修改 了<code>switch</code>组件的状态（假如默认状态是关闭状态），在页面上已经呈现了打开状态，但是，如果数据库更新失败了，需要将<code>switch</code>组件的状态有打开状态还原到关闭状态。</p>
<h2 id="10、用户搜索功能实现"><a href="#10、用户搜索功能实现" class="headerlink" title="10、用户搜索功能实现"></a>10、用户搜索功能实现</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入内容&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;queryInfo.query&quot;</span> <span class="attr">clearable</span> @<span class="attr">clear</span>=<span class="string">&quot;getUserList&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">slot</span>=<span class="string">&quot;append&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-search&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;getUserList&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将搜索框与<code>queryInfo.query</code>属性进行双向数据绑定，同时给搜索框右侧添加一个删除的图标，单击删除的图标会将用户在搜索框中输入的内容清空，同时触发<code>@clear</code>事件，调用<code>getUserList</code>方法，这时就会查询出所有的用户数据。</p>
<p>当用户在搜索框中输入完搜索的条件后，单击搜索按钮触发单击事件，调用<code>getUserList</code>方法，这时由于搜索框与<code>query</code>属性进行了双向数据绑定，所以<code>query</code>属性中存储了用户输入的搜索条件，这样在调用<code>getUserList</code>方法的时候，会将搜索条件发送服务端，从而完成数据的搜索。</p>
<h1 id="五、用户添加、编辑、删除功能实现"><a href="#五、用户添加、编辑、删除功能实现" class="headerlink" title="五、用户添加、编辑、删除功能实现"></a>五、用户添加、编辑、删除功能实现</h1><h2 id="1、展示用户添加对话框"><a href="#1、展示用户添加对话框" class="headerlink" title="1、展示用户添加对话框"></a>1、展示用户添加对话框</h2><p>对话框的展示需要用到<code>Dialog</code>组件。</p>
<p>在<code>el-card</code>组件下面添加对话框</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加用户的对话框 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;添加用户&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;addDialogVisible&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50%&quot;</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 底部区域 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;addDialogVisible = false&quot;</span>&gt;</span>取 消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addDialogVisible = false&quot;</span>&gt;</span>确 定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过属性<code>addDialogVisible</code>控制对话框的显示与隐藏。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      <span class="comment">// 获取用户列表的参数对象</span></span><br><span class="line">      queryInfo: &#123;</span><br><span class="line">        query: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="comment">// 当前的页数</span></span><br><span class="line">        pagenum: <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// 当前每页显示多少条数据</span></span><br><span class="line">        pagesize: <span class="number">2</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      userlist: [],</span><br><span class="line">      total: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">// 控制添加用户对话框的显示与隐藏</span></span><br><span class="line">      addDialogVisible: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>当单击对话框中的“取消”按钮和“确定”按钮的时候，都会修改<code>addDialogVisible</code>属性的值为<code>false</code>,关闭对话框。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addDialogVisible = true&quot;</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当单击“添加用户”按钮的时候，修改<code>addDialogVisible</code>属性的值为<code>true</code>,展示出对应的对话框。</p>
<p><code>Vue.use(Dialog)</code></p>
<h2 id="2、展示添加用户表单"><a href="#2、展示添加用户表单" class="headerlink" title="2、展示添加用户表单"></a>2、展示添加用户表单</h2><p>在对话框中添加用户表单</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加用户的对话框 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;添加用户&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;addDialogVisible&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50%&quot;</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 内容主体区域 --&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--用户表单--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;addForm&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;addFormRules&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;addFormRef&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;70px&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;密码&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;邮箱&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;email&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;手机&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;mobile&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.mobile&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- 底部区域 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;addDialogVisible = false&quot;</span>&gt;</span>取 消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addDialogVisible = false&quot;</span>&gt;</span>确 定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义表单数据属性与校验规则</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 获取用户列表的参数对象</span></span><br><span class="line">    <span class="attr">queryInfo</span>: &#123;</span><br><span class="line">      <span class="attr">query</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="comment">// 当前的页数</span></span><br><span class="line">      <span class="attr">pagenum</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 当前每页显示多少条数据</span></span><br><span class="line">      <span class="attr">pagesize</span>: <span class="number">2</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">userlist</span>: [],</span><br><span class="line">    <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// 控制添加用户对话框的显示与隐藏</span></span><br><span class="line">    <span class="attr">addDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 添加用户的表单数据</span></span><br><span class="line">    <span class="attr">addForm</span>: &#123;</span><br><span class="line">      <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">password</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">mobile</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加表单的验证规则对象</span></span><br><span class="line">    <span class="attr">addFormRules</span>: &#123;</span><br><span class="line">      <span class="attr">username</span>: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入用户名&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">min</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">max</span>: <span class="number">10</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;用户名的长度在3~10个字符之间&quot;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">password</span>: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入密码&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">min</span>: <span class="number">6</span>,</span><br><span class="line">          <span class="attr">max</span>: <span class="number">15</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;用户名的长度在6~15个字符之间&quot;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">email</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入邮箱&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;],</span><br><span class="line">      <span class="attr">mobile</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入手机号&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h2 id="3、自定义校验规则"><a href="#3、自定义校验规则" class="headerlink" title="3、自定义校验规则"></a>3、自定义校验规则</h2><p>现在需要对邮箱与手机号码进行规则校验。具体的使用方式，可以参考官方文档：<code>https://element.eleme.cn/#/zh-CN/component/form</code></p>
<p>中，对表单的自定义校验规则的实现。</p>
<p>在<code>data</code>中定义校验的函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 验证邮箱的规则</span></span><br><span class="line">    <span class="keyword">var</span> checkEmail = <span class="function">(<span class="params">rule, value, cb</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 验证邮箱的正则表达式</span></span><br><span class="line">      <span class="keyword">const</span> regEmail = <span class="regexp">/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (regEmail.test(value)) &#123;</span><br><span class="line">        <span class="comment">// 合法的邮箱</span></span><br><span class="line">        <span class="keyword">return</span> cb();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      cb(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;请输入合法的邮箱&quot;</span>));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证手机号的规则</span></span><br><span class="line">    <span class="keyword">var</span> checkMobile = <span class="function">(<span class="params">rule, value, cb</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 验证手机号的正则表达式</span></span><br><span class="line">      <span class="keyword">const</span> regMobile = <span class="regexp">/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]&#123;8&#125;$/</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (regMobile.test(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> cb();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      cb(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;请输入合法的手机号&quot;</span>));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 获取用户列表的参数对象</span></span><br><span class="line">      <span class="attr">queryInfo</span>: &#123;</span><br><span class="line">        <span class="attr">query</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="comment">// 当前的页数</span></span><br><span class="line">        <span class="attr">pagenum</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// 当前每页显示多少条数据</span></span><br><span class="line">        <span class="attr">pagesize</span>: <span class="number">2</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">userlist</span>: [],</span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">// 控制添加用户对话框的显示与隐藏</span></span><br><span class="line">      <span class="attr">addDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// 添加用户的表单数据</span></span><br><span class="line">      <span class="attr">addForm</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">email</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">mobile</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>

<p>使用规则校验的函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">email: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入邮箱&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">validator</span>: checkEmail, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">mobile</span>: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入手机号&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">validator</span>: checkMobile, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">      ],</span><br></pre></td></tr></table></figure>

<p>这里是通过<code>validator</code>来使用校验的函数。</p>
<h2 id="4、实现表单重置操作"><a href="#4、实现表单重置操作" class="headerlink" title="4、实现表单重置操作"></a>4、实现表单重置操作</h2><p>如果在表单中输入了内容，然后单击了“取消”按钮，这时再次单击“添加”按钮后，弹出的表单中还保留了上次输入的内容。</p>
<p>而像这种情况，表单应该是呈现出最开始的默认状态。</p>
<p>具体的实现如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;添加用户&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;addDialogVisible&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50%&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;addDialogClosed&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>给<code>dialog</code>对话框添加了<code>@close</code>事件，当关闭窗口的时候会触发该事件。</p>
<p>在<code>addDialogClosed</code>方法中，将表单的内容进行重置。在<code>methods</code>中，定义如下的方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 监听添加用户对话框的关闭事件</span></span><br><span class="line">  <span class="function"><span class="title">addDialogClosed</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$refs.addFormRef.resetFields();</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="5、完成用户添加"><a href="#5、完成用户添加" class="headerlink" title="5、完成用户添加"></a>5、完成用户添加</h2><p>首先，修改添加对话框中的“确定”按钮，为其添加单击事件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 底部区域 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;addDialogVisible = false&quot;</span>&gt;</span>取 消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addUser&quot;</span>&gt;</span>确 定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>addUser</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，添加新用户</span></span><br><span class="line">  <span class="function"><span class="title">addUser</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.$refs.addFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">        <span class="comment">//表单没有校验通过，终止请求的发送。</span></span><br><span class="line">      <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">// 可以发起添加用户的网络请求</span></span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(<span class="string">&quot;users&quot;</span>, <span class="built_in">this</span>.addForm);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">201</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.$message.error(<span class="string">&quot;添加用户失败！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.$message.success(<span class="string">&quot;添加用户成功！&quot;</span>);</span><br><span class="line">      <span class="comment">// 隐藏添加用户的对话框</span></span><br><span class="line">      <span class="built_in">this</span>.addDialogVisible = <span class="literal">false</span>;</span><br><span class="line">      <span class="comment">// 重新获取用户列表数据</span></span><br><span class="line">      <span class="built_in">this</span>.getUserList();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="6、展示修改用户的对话框"><a href="#6、展示修改用户的对话框" class="headerlink" title="6、展示修改用户的对话框"></a>6、展示修改用户的对话框</h2><p>在添加用户对话框的下面，再次创建一个对话框表示修改用户信息的对话框。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改用户的对话框 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;修改用户&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;editDialogVisible&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50%&quot;</span>&gt;</span></span><br><span class="line">      修改用户信息</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;editDialogVisible = false&quot;</span>&gt;</span>取 消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editDialogVisible = false&quot;</span>&gt;</span>确 定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>editDialogVisible</code>属性控制对话框的显示与隐藏。</p>
<p>在<code>data</code>中定义该属性，默认取值为<code>false</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制修改用户对话框的显示与隐藏</span></span><br><span class="line">     <span class="attr">editDialogVisible</span>: <span class="literal">false</span>,</span><br></pre></td></tr></table></figure>

<p>为表格中的操作列中的编辑按键添加单击事件，该事件触发后弹出修改用户的窗口。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改按钮 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;el-icon-edit&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;showEditDialog&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>showEditDialog</code>方法的实现如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 展示编辑用户的对话框</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">showEditDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.editDialogVisible = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>这样就实现了单击修改按钮，弹出窗口的效果。</p>
<p>下面要实现的功能就是在修改的窗口中添加表单，然后将要修改的用户数据填充到表单中。</p>
<h2 id="7、根据用户编号查询用户信息"><a href="#7、根据用户编号查询用户信息" class="headerlink" title="7、根据用户编号查询用户信息"></a>7、根据用户编号查询用户信息</h2><p>当单击“修改””按钮的时候，首先先获取用户的编号，然后根据该编号查询出对应的用户数据。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 修改按钮 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">           <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">icon</span>=<span class="string">&quot;el-icon-edit&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">           @<span class="attr">click</span>=<span class="string">&quot;showEditDialog(scope.row.id)&quot;</span></span></span><br><span class="line"><span class="tag">         &gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过作用域插槽，将要编辑的用户编号传递到<code>showEditDialog</code>方法中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 展示编辑用户的对话框</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">showEditDialog</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;users/&quot;</span> + id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;查询用户信息失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.editForm = res.data;</span><br><span class="line">    <span class="built_in">this</span>.editDialogVisible = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>根据传递过来的哟用户编号，发送异步请求，获取具体的用户数据，然后赋值给<code>editForm</code>属性。</p>
<p>在<code>data</code>中定义<code>editForm</code>属性来保存要编辑的用户数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询到的要编辑的用户信息对象</span></span><br><span class="line">      <span class="attr">editForm</span>: &#123;&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="8、展示修改用户的表单"><a href="#8、展示修改用户的表单" class="headerlink" title="8、展示修改用户的表单"></a>8、展示修改用户的表单</h2><p>在修改用户的对话框中创建修改的表单，展示要修改的数据。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修改用户的对话框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;修改用户&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;editDialogVisible&quot;</span> <span class="attr">width</span>=<span class="string">&quot;50%&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;editForm&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;editFormRules&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;editFormRef&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;70px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;editForm.username&quot;</span> <span class="attr">disabled</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;邮箱&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;email&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;editForm.email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;手机&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;mobile&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;editForm.mobile&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;editDialogVisible = false&quot;</span>&gt;</span>取 消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editDialogVisible = false&quot;</span>&gt;</span>确 定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在表单中，<code>model</code>属性已经绑定了<code>editForm</code>对象，而该对象中存储了要修改的用户数据，然后将<code>editForm</code>中的属性与文本框进行双向绑定，这样文本框中就会展示出要修改的用户数据。</p>
<p>同时给<code>el-form</code>表单添加了<code>rules</code>属性，指定了校验规则，校验规则有<code>editFormRules</code>对象完成定义，让每一个<code>el-form-item</code>表单项通过<code>prop</code>属性与校验规则对象<code>editFormRules</code>中的属性进行绑定，从而完成校验。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询到的要编辑的用户信息对象</span></span><br><span class="line">   <span class="attr">editForm</span>: &#123;&#125;,</span><br><span class="line">   <span class="comment">// 修改表单的验证规则对象</span></span><br><span class="line">   <span class="attr">editFormRules</span>: &#123;</span><br><span class="line">     <span class="attr">email</span>: [</span><br><span class="line">       &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入用户邮箱&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">validator</span>: checkEmail, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">     ],</span><br><span class="line">     <span class="attr">mobile</span>: [</span><br><span class="line">       &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入用户手机&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">       &#123; <span class="attr">validator</span>: checkMobile, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">     ],</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="9、完成用户信息编辑操作"><a href="#9、完成用户信息编辑操作" class="headerlink" title="9、完成用户信息编辑操作"></a>9、完成用户信息编辑操作</h2><p>首先给用户编辑窗口中的确定按钮，添加单击事件，对应的处理函数为<code>editUserInfo</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;editUserInfo&quot;</span>&gt;</span>确 定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>editUserInfo</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 修改用户信息并提交</span></span><br><span class="line">   <span class="function"><span class="title">editUserInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.$refs.editFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">       <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;</span><br><span class="line">       <span class="comment">// 发起修改用户信息的数据请求</span></span><br><span class="line">       <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.put(</span><br><span class="line">         <span class="string">&quot;users/&quot;</span> + <span class="built_in">this</span>.editForm.id,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">email</span>: <span class="built_in">this</span>.editForm.email,</span><br><span class="line">           <span class="attr">mobile</span>: <span class="built_in">this</span>.editForm.mobile,</span><br><span class="line">         &#125;</span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;更新用户信息失败！&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 关闭对话框</span></span><br><span class="line">       <span class="built_in">this</span>.editDialogVisible = <span class="literal">false</span>;</span><br><span class="line">       <span class="comment">// 刷新数据列表</span></span><br><span class="line">       <span class="built_in">this</span>.getUserList();</span><br><span class="line">       <span class="comment">// 提示修改成功</span></span><br><span class="line">       <span class="built_in">this</span>.$message.success(<span class="string">&quot;更新用户信息成功！&quot;</span>);</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="10、删除用户数据"><a href="#10、删除用户数据" class="headerlink" title="10、删除用户数据"></a>10、删除用户数据</h2><p>在删除具体的用户数据之前，应该先给用户一个提示信息。</p>
<p>首先先找到表格中的操作列，然后在找到删除按钮，给该按钮添加单击事件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 删除按钮 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">icon</span>=<span class="string">&quot;el-icon-delete&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">click</span>=<span class="string">&quot;removeUserById(scope.row.id)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在调用<code>removeUserById</code>方法的时候，将用户编号作为参数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据Id删除对应的用户信息</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">removeUserById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">     <span class="comment">// 弹框询问用户是否删除数据</span></span><br><span class="line">     <span class="comment">//由于Confirm挂载到了`Vue`的原型上，所以这里可以直接使用this</span></span><br><span class="line">     <span class="keyword">const</span> confirmResult = <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(</span><br><span class="line">       <span class="string">&quot;此操作将永久删除该用户, 是否继续?&quot;</span>,</span><br><span class="line">       <span class="string">&quot;提示&quot;</span>,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">         <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">         <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,<span class="comment">//窗口中的图标</span></span><br><span class="line">       &#125;</span><br><span class="line">     ).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> err); <span class="comment">//处理取消的情况。</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">// 如果用户确认删除，则返回值为字符串 confirm</span></span><br><span class="line">     <span class="comment">// 如果用户取消了删除，则返回值为字符串 cancel</span></span><br><span class="line">     <span class="comment">// console.log(confirmResult)</span></span><br><span class="line">     <span class="keyword">if</span> (confirmResult !== <span class="string">&quot;confirm&quot;</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.info(<span class="string">&quot;已取消删除&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">this</span>.$message.success(<span class="string">&quot;删除用户成功！&quot;</span> + id);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>在<code>element.js</code>文件中导入<code>MessageBox</code>,并且将<code>confirm</code>挂载到<code>Vue</code>的原型上。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#123;MessageBox&#125; from &quot;element-ui&quot;</span><br><span class="line">Vue.prototype.$confirm = MessageBox.confirm;</span><br></pre></td></tr></table></figure>

<p>下面要实现的就是发送异步请求删除用户数据。</p>
<p>修改后的<code>removeUserById</code>的方法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">   <span class="comment">// 根据Id删除对应的用户信息</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">removeUserById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 弹框询问用户是否删除数据</span></span><br><span class="line">      <span class="comment">//由于Confirm挂载到了`Vue`的原型上，所以这里可以直接使用this</span></span><br><span class="line">      <span class="keyword">const</span> confirmResult = <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(</span><br><span class="line">        <span class="string">&quot;此操作将永久删除该用户, 是否继续?&quot;</span>,</span><br><span class="line">        <span class="string">&quot;提示&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">          <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      ).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> err); <span class="comment">//处理取消的情况。</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果用户确认删除，则返回值为字符串 confirm</span></span><br><span class="line">      <span class="comment">// 如果用户取消了删除，则返回值为字符串 cancel</span></span><br><span class="line">      <span class="comment">// console.log(confirmResult)</span></span><br><span class="line">      <span class="keyword">if</span> (confirmResult !== <span class="string">&quot;confirm&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$message.info(<span class="string">&quot;已取消删除&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//指定删除接口,发送delete请求</span></span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.delete(<span class="string">&quot;users/&quot;</span> + id);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;删除用户失败！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.$message.success(<span class="string">&quot;删除用户成功！&quot;</span>);</span><br><span class="line">      <span class="built_in">this</span>.getUserList();</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="六、权限列表"><a href="#六、权限列表" class="headerlink" title="六、权限列表"></a>六、权限列表</h1><h2 id="1、创建权限列表组件"><a href="#1、创建权限列表组件" class="headerlink" title="1、创建权限列表组件"></a>1、创建权限列表组件</h2><p>首先先创建一个基本的权限组件，并且指定对应的路由规则。</p>
<p>在<code>components</code>目录下面创建<code>power</code>目录，在该目录下面创建<code>Rights.vue</code>文件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;权限管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;权限列表&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 卡片视图 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;el-table :data=&quot;rightsList&quot; border stripe&gt;</span><br><span class="line">        &lt;el-table-column type=&quot;index&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;权限名称&quot; prop=&quot;authName&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;路径&quot; prop=&quot;path&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;权限等级&quot; prop=&quot;level&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">            &lt;el-tag v-if=&quot;scope.row.level === &#x27;0&#x27;&quot;&gt;一级&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag type=&quot;success&quot; v-else-if=&quot;scope.row.level === &#x27;1&#x27;&quot;&gt;二级&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag type=&quot;warning&quot; v-else&gt;三级&lt;/el-tag&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 权限列表</span><br><span class="line">      rightsList: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    // 获取所有的权限</span><br><span class="line">    this.getRightsList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取权限列表</span><br><span class="line">    async getRightsList() &#123;</span><br><span class="line">      const &#123; data: res &#125; = await this.$http.get(&quot;rights/list&quot;);</span><br><span class="line">      if (res.meta.status !== 200) &#123;</span><br><span class="line">        return this.$message.error(&quot;获取权限列表失败！&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.rightsList = res.data;</span><br><span class="line">      console.log(this.rightsList);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>路由设置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Rights <span class="keyword">from</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,<span class="comment">//权限组件</span></span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>Vue.use(Tag);</code></p>
<h2 id="2、用户角色权限关系介绍"><a href="#2、用户角色权限关系介绍" class="headerlink" title="2、用户角色权限关系介绍"></a>2、用户角色权限关系介绍</h2><h1 id="七、角色列表"><a href="#七、角色列表" class="headerlink" title="七、角色列表"></a>七、角色列表</h1><h2 id="1、展示角色数据"><a href="#1、展示角色数据" class="headerlink" title="1、展示角色数据"></a>1、展示角色数据</h2><p>在<code>components/power</code>目录下面创建<code>Roles.vue</code></p>
<p>整个的组件结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;权限管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;角色列表&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line">    &lt;!-- 卡片视图 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;!-- 添加角色按钮区域 --&gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot;&gt;添加角色&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">      &lt;!-- 角色列表区域 --&gt;</span><br><span class="line">      &lt;el-table :data=&quot;rolelist&quot; border stripe&gt;</span><br><span class="line">        &lt;!-- 展开列 --&gt;</span><br><span class="line">        &lt;el-table-column type=&quot;expand&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;!-- 索引列 --&gt;</span><br><span class="line">        &lt;el-table-column type=&quot;index&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;角色名称&quot; prop=&quot;roleName&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;角色描述&quot; prop=&quot;roleDesc&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;操作&quot; width=&quot;300px&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">            &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot; icon=&quot;el-icon-edit&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button size=&quot;mini&quot; type=&quot;danger&quot; icon=&quot;el-icon-delete&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">              size=&quot;mini&quot;</span><br><span class="line">              type=&quot;warning&quot;</span><br><span class="line">              icon=&quot;el-icon-setting&quot;</span><br><span class="line">              @click=&quot;showSetRightDialog(scope.row)&quot;</span><br><span class="line">            &gt;分配权限&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 所有角色列表数据</span><br><span class="line">      rolelist: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getRolesList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取所有角色的列表</span><br><span class="line">    async getRolesList() &#123;</span><br><span class="line">      const &#123; data: res &#125; = await this.$http.get(&quot;roles&quot;);</span><br><span class="line"></span><br><span class="line">      if (res.meta.status !== 200) &#123;</span><br><span class="line">        return this.$message.error(&quot;获取角色列表失败！&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.rolelist = res.data;</span><br><span class="line"></span><br><span class="line">      //   console.log(this.rolelist);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的表格中，我们添加了一个展开列。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 展开列 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;expand&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>路由设置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Rights <span class="keyword">from</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Roles <span class="keyword">from</span> <span class="string">&quot;./components/power/Roles.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/roles&quot;</span>, <span class="attr">component</span>: Roles &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>添加了<code>Roles.vue</code>这个组件对应的路由内容。</p>
<h2 id="2、渲染一级权限"><a href="#2、渲染一级权限" class="headerlink" title="2、渲染一级权限"></a>2、渲染一级权限</h2><p>这里重点要注意的就是，整个数据的结构。</p>
<p>当点击“展开列”时候，会展示出当前角色具有的权限。</p>
<p>而系统中，权限分为了三级，分别为1级权限，二级权限和三级权限。</p>
<p>整个权限的布采用的是栅格布局，一级权限占用5列，二级与三级权限占用19列。</p>
<p>在”展开列”中，通过作用域插槽来完成权限的展示。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 展开列 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;expand&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-row</span></span></span><br><span class="line"><span class="tag">             <span class="attr">:class</span>=<span class="string">&quot;[&#x27;bdbottom&#x27;, i1 === 0 ? &#x27;bdtop&#x27; : &#x27;&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">v-for</span>=<span class="string">&quot;(item1, i1) in scope.row.children&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">:key</span>=<span class="string">&quot;item1.id&quot;</span></span></span><br><span class="line"><span class="tag">           &gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 渲染一级权限 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!-- 权限名 --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">el-tag</span>&gt;</span>&#123;&#123;item1.authName&#125;&#125;<span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!-- 右侧箭头图标 --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-caret-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">             <span class="comment">&lt;!-- 渲染二级和三级权限 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;19&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码中我们通过<code>scope.row.children</code>获取的是当前角色具有的权限数据，下面通过<code>for</code>循环进行遍历。</p>
<p>基本的样式如下</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-class">.el-tag</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">7px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bdtop</span> &#123;</span><br><span class="line">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bdbottom</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3、渲染二级权限"><a href="#3、渲染二级权限" class="headerlink" title="3、渲染二级权限"></a>3、渲染二级权限</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 展开列 --&gt;</span><br><span class="line">     &lt;el-table-column type=&quot;expand&quot;&gt;</span><br><span class="line">       &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">         &lt;el-row</span><br><span class="line">           :class=&quot;[&#x27;bdbottom&#x27;, i1 === 0 ? &#x27;bdtop&#x27; : &#x27;&#x27;]&quot;</span><br><span class="line">           v-for=&quot;(item1, i1) in scope.row.children&quot;</span><br><span class="line">           :key=&quot;item1.id&quot;</span><br><span class="line">         &gt;</span><br><span class="line">           &lt;!-- 渲染一级权限 --&gt;</span><br><span class="line">           &lt;el-col :span=&quot;5&quot;&gt;</span><br><span class="line">             &lt;el-tag&gt;&#123;&#123;item1.authName&#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">             &lt;i class=&quot;el-icon-caret-right&quot;&gt;&lt;/i&gt;</span><br><span class="line">           &lt;/el-col&gt;</span><br><span class="line"></span><br><span class="line">           &lt;!-- 渲染二级和三级权限 --&gt;</span><br><span class="line">           &lt;el-col :span=&quot;19&quot;&gt;</span><br><span class="line">             &lt;!-- 通过for循环嵌套，渲染二级权限 --&gt;</span><br><span class="line">             &lt;el-row</span><br><span class="line">               :class=&quot;[i2 === 0 ? &#x27;&#x27; : &#x27;bdtop&#x27;]&quot;</span><br><span class="line">               v-for=&quot;(item2, i2) in item1.children&quot;</span><br><span class="line">               :key=&quot;item2.id&quot;</span><br><span class="line">             &gt;</span><br><span class="line">               &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                 &lt;el-tag type=&quot;success&quot;&gt;&#123;&#123;item2.authName&#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">                 &lt;i class=&quot;el-icon-caret-right&quot;&gt;&lt;/i&gt;</span><br><span class="line">               &lt;/el-col&gt;</span><br><span class="line">               &lt;el-col :span=&quot;18&quot;&gt;&lt;/el-col&gt;</span><br><span class="line">             &lt;/el-row&gt;</span><br><span class="line">           &lt;/el-col&gt;</span><br><span class="line">         &lt;/el-row&gt;</span><br><span class="line">       &lt;/template&gt;</span><br><span class="line">     &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<p>这里通过对一级权限下的<code>chilren</code>属性进行遍历，从而完成二级权限的渲染。</p>
<h2 id="4、渲染三级权限"><a href="#4、渲染三级权限" class="headerlink" title="4、渲染三级权限"></a>4、渲染三级权限</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 展开列 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;expand&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-row</span></span></span><br><span class="line"><span class="tag">             <span class="attr">:class</span>=<span class="string">&quot;[&#x27;bdbottom&#x27;, i1 === 0 ? &#x27;bdtop&#x27; : &#x27;&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">v-for</span>=<span class="string">&quot;(item1, i1) in scope.row.children&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">:key</span>=<span class="string">&quot;item1.id&quot;</span></span></span><br><span class="line"><span class="tag">           &gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- 渲染一级权限 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">el-tag</span>&gt;</span>&#123;&#123;item1.authName&#125;&#125;<span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-caret-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">             <span class="comment">&lt;!-- 渲染二级和三级权限 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;19&quot;</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!-- 通过for循环嵌套，渲染二级权限 --&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">el-row</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">:class</span>=<span class="string">&quot;[i2 === 0 ? &#x27;&#x27; : &#x27;bdtop&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">v-for</span>=<span class="string">&quot;(item2, i2) in item1.children&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">:key</span>=<span class="string">&quot;item2.id&quot;</span></span></span><br><span class="line"><span class="tag">               &gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">el-tag</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span>&gt;</span>&#123;&#123;item2.authName&#125;&#125;<span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-caret-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">                 <span class="comment">&lt;!--渲染三级权限 --&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;18&quot;</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">el-tag</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">v-for</span>=<span class="string">&quot;(item3) in item2.children&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">:key</span>=<span class="string">&quot;item3.id&quot;</span></span></span><br><span class="line"><span class="tag">                   &gt;</span>&#123;&#123;item3.authName&#125;&#125;<span class="tag">&lt;/<span class="name">el-tag</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里通过对二级权限下的<code>chilren</code>属性进行遍历，从而完成三级权限的渲染。</p>
<h2 id="5、删除指定角色下的权限"><a href="#5、删除指定角色下的权限" class="headerlink" title="5、删除指定角色下的权限"></a>5、删除指定角色下的权限</h2><p>首先给每个权限名称右上角添加一个叉号按钮，当单击该叉号按钮后，删除对应的权限。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 展开列 --&gt;</span><br><span class="line">     &lt;el-table-column type=&quot;expand&quot;&gt;</span><br><span class="line">       &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">         &lt;el-row</span><br><span class="line">           :class=&quot;[&#x27;bdbottom&#x27;, i1 === 0 ? &#x27;bdtop&#x27; : &#x27;&#x27;]&quot;</span><br><span class="line">           v-for=&quot;(item1, i1) in scope.row.children&quot;</span><br><span class="line">           :key=&quot;item1.id&quot;</span><br><span class="line">         &gt;</span><br><span class="line">           &lt;!-- 渲染一级权限 --&gt;</span><br><span class="line">           &lt;el-col :span=&quot;5&quot;&gt;</span><br><span class="line">             &lt;el-tag closable @close=&quot;removeRightById(scope.row, item1.id)&quot;&gt;&#123;&#123;item1.authName&#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">             &lt;i class=&quot;el-icon-caret-right&quot;&gt;&lt;/i&gt;</span><br><span class="line">           &lt;/el-col&gt;</span><br><span class="line"></span><br><span class="line">           &lt;!-- 渲染二级和三级权限 --&gt;</span><br><span class="line">           &lt;el-col :span=&quot;19&quot;&gt;</span><br><span class="line">             &lt;!-- 通过for循环嵌套，渲染二级权限 --&gt;</span><br><span class="line">             &lt;el-row</span><br><span class="line">               :class=&quot;[i2 === 0 ? &#x27;&#x27; : &#x27;bdtop&#x27;]&quot;</span><br><span class="line">               v-for=&quot;(item2, i2) in item1.children&quot;</span><br><span class="line">               :key=&quot;item2.id&quot;</span><br><span class="line">             &gt;</span><br><span class="line">               &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">                 &lt;el-tag</span><br><span class="line">                   type=&quot;success&quot;</span><br><span class="line">                   closable</span><br><span class="line">                   @close=&quot;removeRightById(scope.row, item2.id)&quot;</span><br><span class="line">                 &gt;&#123;&#123;item2.authName&#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">                 &lt;i class=&quot;el-icon-caret-right&quot;&gt;&lt;/i&gt;</span><br><span class="line">               &lt;/el-col&gt;</span><br><span class="line">               &lt;!--渲染三级权限 --&gt;</span><br><span class="line">               &lt;el-col :span=&quot;18&quot;&gt;</span><br><span class="line">                 &lt;el-tag</span><br><span class="line">                   type=&quot;warning&quot;</span><br><span class="line">                   v-for=&quot;(item3) in item2.children&quot;</span><br><span class="line">                   :key=&quot;item3.id&quot;</span><br><span class="line">                   closable</span><br><span class="line">                   @close=&quot;removeRightById(scope.row, item3.id)&quot;</span><br><span class="line">                 &gt;&#123;&#123;item3.authName&#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">               &lt;/el-col&gt;</span><br><span class="line">             &lt;/el-row&gt;</span><br><span class="line">           &lt;/el-col&gt;</span><br><span class="line">         &lt;/el-row&gt;</span><br><span class="line">       &lt;/template&gt;</span><br><span class="line">     &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，给<code>el-tag</code>组件添加了<code>closable</code>属性，同时指定了<code>@close</code>事件。</p>
<p>事件触发后，执行<code>removeRightById</code>处理函数，将角色的信息以及权限编号传递到该方法中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据Id删除对应的权限</span></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">removeRightById</span>(<span class="params">role, rightId</span>)</span> &#123;</span><br><span class="line">   <span class="comment">// 弹框提示用户是否要删除</span></span><br><span class="line">   <span class="keyword">const</span> confirmResult = <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(</span><br><span class="line">     <span class="string">&quot;此操作将永久删除该文件, 是否继续?&quot;</span>,</span><br><span class="line">     <span class="string">&quot;提示&quot;</span>,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">       <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">       <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">     &#125;</span><br><span class="line">   ).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> err);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (confirmResult !== <span class="string">&quot;confirm&quot;</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.$message.info(<span class="string">&quot;取消了删除！&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.delete(</span><br><span class="line">     <span class="string">`roles/<span class="subst">$&#123;role.id&#125;</span>/rights/<span class="subst">$&#123;rightId&#125;</span>`</span></span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;删除权限失败！&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// this.getRolesList()</span></span><br><span class="line">   role.children = res.data; <span class="comment">//将返回的最新数据重新赋值给children属性。</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="八、分配权限、角色"><a href="#八、分配权限、角色" class="headerlink" title="八、分配权限、角色"></a>八、分配权限、角色</h1><h2 id="1、分配权限—展示权限信息"><a href="#1、分配权限—展示权限信息" class="headerlink" title="1、分配权限—展示权限信息"></a>1、分配权限—展示权限信息</h2><p>当用户点击<code>分配权限</code>按钮的时候，会弹出一个对话框，在这个对话框中以树形方式展示出所有的权限。</p>
<p>在<code>el-card</code>组件下面添加窗口组件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 分配权限的对话框 --&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;分配权限&quot; :visible.sync=&quot;setRightDialogVisible&quot; width=&quot;50%&quot;&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;setRightDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;setRightDialogVisible = false&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>定义<code>setRightDialogVisible</code>属性，该属性的默认值为<code>false</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制分配权限对话框的显示与隐藏</span></span><br><span class="line">      <span class="attr">setRightDialogVisible</span>: <span class="literal">false</span>,</span><br></pre></td></tr></table></figure>

<p>当单击操作列中的“分配权限”按钮弹出窗口，同时获取所有的权限信息。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">    size=&quot;mini&quot;</span><br><span class="line">    type=&quot;warning&quot;</span><br><span class="line">    icon=&quot;el-icon-setting&quot;</span><br><span class="line">    @click=&quot;showSetRightDialog(scope.row)&quot;</span><br><span class="line">  &gt;分配权限&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>在调用<code>showSetRightDialog</code>方法的时候，传递了对应的角色信息。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 展示分配权限的对话框</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">showSetRightDialog</span>(<span class="params">role</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 获取所有权限的数据</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;rights/tree&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取权限数据失败！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把获取到的权限数据保存到 data 中</span></span><br><span class="line">  <span class="built_in">this</span>.rightslist = res.data;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.rightslist);</span><br><span class="line">  <span class="built_in">console</span>.log(role);</span><br><span class="line">  <span class="comment">// 展示出对话框</span></span><br><span class="line">  <span class="built_in">this</span>.setRightDialogVisible = <span class="literal">true</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>把获取到的权限数据赋值给了<code>rightslist</code>属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 所有权限的数据</span></span><br><span class="line">    <span class="attr">rightslist</span>: [],</span><br></pre></td></tr></table></figure>

<h2 id="2、使用树形方式展示权限数据"><a href="#2、使用树形方式展示权限数据" class="headerlink" title="2、使用树形方式展示权限数据"></a>2、使用树形方式展示权限数据</h2><p>下面要做的就是，在弹出的窗口中使用树形控件展示权限数据。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 分配权限的对话框 --&gt;</span><br><span class="line">    &lt;el-dialog title=&quot;分配权限&quot; :visible.sync=&quot;setRightDialogVisible&quot; width=&quot;50%&quot;&gt;</span><br><span class="line">      &lt;!-- 树形控件 --&gt;</span><br><span class="line">      &lt;el-tree :data=&quot;rightslist&quot; :props=&quot;treeProps&quot;&gt;&lt;/el-tree&gt;</span><br><span class="line"></span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;setRightDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;setRightDialogVisible = false&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，为对话框添加了<code>el-tree</code>控件，<code>data</code>属性指定了数据源，<code>props</code>属性指定了树形控件中所要展示的内容以及父子关系。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 所有角色列表数据</span></span><br><span class="line">    <span class="attr">rolelist</span>: [],</span><br><span class="line">    <span class="comment">// 控制分配权限对话框的显示与隐藏</span></span><br><span class="line">    <span class="attr">setRightDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 所有权限的数据</span></span><br><span class="line">    <span class="attr">rightslist</span>: [],</span><br><span class="line">    <span class="comment">// 树形控件的属性绑定对象</span></span><br><span class="line">    <span class="attr">treeProps</span>: &#123;</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&quot;authName&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;children&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>在<code>element.js</code>中注册<code>Tree</code>组件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vue.use(Tree)</span><br></pre></td></tr></table></figure>

<p>接下来，给树形控件添加了如下属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tree :data=&quot;rightslist&quot; :props=&quot;treeProps&quot; show-checkbox node-key=&quot;id&quot; default-expand-all&gt;&lt;/el-tree&gt;</span><br></pre></td></tr></table></figure>

<p><code>show-checkbox</code>:每一个权限名称前面添加复选框。</p>
<p><code>default-expand-all</code>: 将整棵树全部展开。</p>
<p><code>node-key</code>:选中获取的是权限的编号。</p>
<h2 id="3、将某个角色已有权限选中"><a href="#3、将某个角色已有权限选中" class="headerlink" title="3、将某个角色已有权限选中"></a>3、将某个角色已有权限选中</h2><p>如果想要让<code>el-tree</code>中权限名称前面的复选框选中，需要用到<code>default-checked-keys</code>属性, 该属性的值是一个数组，数组中存放的就是要选中的权限的编号。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">       :data=&quot;rightslist&quot;</span><br><span class="line">       :props=&quot;treeProps&quot;</span><br><span class="line">       show-checkbox</span><br><span class="line">       node-key=&quot;id&quot;</span><br><span class="line">       default-expand-all</span><br><span class="line">       :default-checked-keys=&quot;defKeys&quot;</span><br><span class="line">     &gt;&lt;/el-tree&gt;</span><br></pre></td></tr></table></figure>

<p>定义<code>defKeys</code>数组</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 所有角色列表数据</span></span><br><span class="line">      <span class="attr">rolelist</span>: [],</span><br><span class="line">      <span class="comment">// 控制分配权限对话框的显示与隐藏</span></span><br><span class="line">      <span class="attr">setRightDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// 所有权限的数据</span></span><br><span class="line">      <span class="attr">rightslist</span>: [],</span><br><span class="line">      <span class="comment">// 树形控件的属性绑定对象</span></span><br><span class="line">      <span class="attr">treeProps</span>: &#123;</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;authName&quot;</span>,</span><br><span class="line">        <span class="attr">children</span>: <span class="string">&quot;children&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 默认选中的节点Id值数组</span></span><br><span class="line">      <span class="attr">defKeys</span>: [],</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>怎样将某个角色已经有的权限选中呢(这里是将三级权限选中)，也就是说怎样将某个角色已有的三级权限编号存储到<code>defKeys</code>数组中？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过递归的形式，获取角色下所有三级权限的id，并保存到 defKeys 数组中</span></span><br><span class="line">  <span class="function"><span class="title">getLeafKeys</span>(<span class="params">node, arr</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 如果当前 node 节点不包含 children 属性，则是三级节点</span></span><br><span class="line">    <span class="keyword">if</span> (!node.children) &#123;</span><br><span class="line">      <span class="keyword">return</span> arr.push(node.id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    node.children.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="built_in">this</span>.getLeafKeys(item, arr));</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>这里就是通过递归的方式，看一下某个节点是否还有<code>children</code>属性，如果没有表示就是三级权限，这样就将对应的权限编号存储到一个数组中，如果有</p>
<p><code>children</code>属性，继续遍历，并且再次调用<code>getLeafKeys</code>函数，判断通过循环取出来的节点是否有<code>children</code>属性，不断重复这个过程。</p>
<p>下面要思考的就是，什么时候调用<code>getLeafKeys</code>方法呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 展示分配权限的对话框</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">showSetRightDialog</span>(<span class="params">role</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 获取所有权限的数据</span></span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;rights/tree&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取权限数据失败！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 把获取到的权限数据保存到 data 中</span></span><br><span class="line">      <span class="built_in">this</span>.rightslist = res.data;</span><br><span class="line">      <span class="comment">// console.log(this.rightslist);</span></span><br><span class="line">      <span class="comment">// console.log(role);</span></span><br><span class="line">      <span class="comment">// 递归获取三级节点的Id（开始的节点为当前角色）</span></span><br><span class="line">      <span class="built_in">this</span>.getLeafKeys(role, <span class="built_in">this</span>.defKeys);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 展示出对话框</span></span><br><span class="line">      <span class="built_in">this</span>.setRightDialogVisible = <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>我们是在<code>showSetRightDialog</code>方法中调用的<code>getLeafKeys</code>方法，也就是说，当用户单击<code>分配权限</code>按钮，弹出对话框前，就应该获取当前角色已有的权限编号，</p>
<p>并且存储到了<code>defkeys</code>数组中，这样当对话框展示出来以后，就会在对话框中以树形结构展示所有权限，并且将角色已经有的权限前面的复选框选中。</p>
<p>最后，这里有一个小的<code>Bug</code>需要解决，就是我们这里是不断的向<code>defKeys</code>数组中添加内容，这样就会出现如下的问题：当给第一个角色分配完权限后，关闭窗口，</p>
<p>又给第二个角色分配权限，这样所有的权限编号都累加到了<code>defkeys</code>数组中，所以这里在窗口关闭后，应该将<code>defKeys</code>数组中的内容清空。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 监听分配权限对话框的关闭事件</span></span><br><span class="line">  <span class="function"><span class="title">setRightDialogClosed</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.defKeys = []</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>关闭窗口的时候，调用上面的方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- 分配权限的对话框 --&gt;</span><br><span class="line"> <span class="xml"><span class="tag">&lt;<span class="name">el-dialog</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">   <span class="attr">title</span>=<span class="string">&quot;分配权限&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">   <span class="attr">:visible.sync</span>=<span class="string">&quot;setRightDialogVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">   <span class="attr">width</span>=<span class="string">&quot;50%&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">   @<span class="attr">close</span>=<span class="string">&quot;setRightDialogClosed&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml"> &gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="4、完成权限的分配"><a href="#4、完成权限的分配" class="headerlink" title="4、完成权限的分配"></a>4、完成权限的分配</h2><p>当单击窗口中的“确定”按钮的时候，完成权限的分配。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;setRightDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;allotRights&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>点击“确定”按钮后，执行<code>allotRights</code>方法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击为角色分配权限</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">allotRights</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = [</span><br><span class="line">      ...this.$refs.treeRef.getCheckedKeys(),</span><br><span class="line">      ...this.$refs.treeRef.getHalfCheckedKeys(),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> idStr = keys.join(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(</span><br><span class="line">      <span class="string">`roles/<span class="subst">$&#123;<span class="built_in">this</span>.roleId&#125;</span>/rights`</span>,</span><br><span class="line">      &#123; <span class="attr">rids</span>: idStr &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;分配权限失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">&quot;分配权限成功！&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.getRolesList();</span><br><span class="line">    <span class="built_in">this</span>.setRightDialogVisible = <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>发送到服务端的权限编号，要求有选中的和半选中（如果子级权限没有全部选中，则父级权限对应的复选框是处于半选中状态）的权限编号，这里可以通过<code>el-tree</code>组件的<code>getCheckedKeys</code>方法获取全选的权限编号，通过<code>getHalfCheckedKeys</code>方法获取半选的权限编号。</p>
<p>所以这里还需要给<code>el-tree</code>添加<code>ref</code>引用。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">        :data=&quot;rightslist&quot;</span><br><span class="line">        :props=&quot;treeProps&quot;</span><br><span class="line">        show-checkbox</span><br><span class="line">        node-key=&quot;id&quot;</span><br><span class="line">        default-expand-all</span><br><span class="line">        :default-checked-keys=&quot;defKeys&quot;</span><br><span class="line">        ref=&quot;treeRef&quot;//添加ref引用</span><br><span class="line">      &gt;&lt;/el-tree&gt;</span><br></pre></td></tr></table></figure>

<p>获取到权限的全选的权限编号与半选的权限编号后，需要拼接成字符串，并且用逗号分隔。</p>
<p>当然，在发送到服务端中的内容除了权限编号的内容，还要有对应的角色编号。</p>
<p>当用户单击“分配权限”按钮，打开窗口的时候，我们就获取到了角色信息，在这里可以将获取到的角色的编号存储到<code>data</code>状态属性中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 展示分配权限的对话框</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">showSetRightDialog</span>(<span class="params">role</span>)</span> &#123;</span><br><span class="line">       <span class="comment">//获取要分配权限的角色编号。</span></span><br><span class="line">     <span class="built_in">this</span>.roleId = role.id;</span><br><span class="line">     <span class="comment">// 获取所有权限的数据</span></span><br><span class="line">     <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;rights/tree&quot;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取权限数据失败！&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 把获取到的权限数据保存到 data 中</span></span><br><span class="line">     <span class="built_in">this</span>.rightslist = res.data;</span><br><span class="line">     <span class="comment">// console.log(this.rightslist);</span></span><br><span class="line">     <span class="comment">// console.log(&quot;role=&quot;, role);</span></span><br><span class="line">     <span class="comment">// 递归获取三级节点的Id</span></span><br><span class="line">     <span class="built_in">this</span>.getLeafKeys(role, <span class="built_in">this</span>.defKeys);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 展示出对话框</span></span><br><span class="line">     <span class="built_in">this</span>.setRightDialogVisible = <span class="literal">true</span>;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>在<code>data</code>中定义<code>roleId</code> 属性</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 所有角色列表数据</span></span><br><span class="line">      <span class="attr">rolelist</span>: [],</span><br><span class="line">      <span class="comment">// 控制分配权限对话框的显示与隐藏</span></span><br><span class="line">      <span class="attr">setRightDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// 所有权限的数据</span></span><br><span class="line">      <span class="attr">rightslist</span>: [],</span><br><span class="line">      <span class="comment">// 树形控件的属性绑定对象</span></span><br><span class="line">      <span class="attr">treeProps</span>: &#123;</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&quot;authName&quot;</span>,</span><br><span class="line">        <span class="attr">children</span>: <span class="string">&quot;children&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 默认选中的节点Id值数组</span></span><br><span class="line">      <span class="attr">defKeys</span>: [],</span><br><span class="line">      <span class="comment">// 当前即将分配权限的角色id</span></span><br><span class="line">      <span class="attr">roleId</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>以上完成了对角色分配权限的功能。</p>
<h2 id="5、为用户分配角色"><a href="#5、为用户分配角色" class="headerlink" title="5、为用户分配角色"></a>5、为用户分配角色</h2><p><strong>展示为用户分配角色的对话框</strong></p>
<p>在这里我们需要返回<code>components/user/Users.vue</code>组件,。</p>
<p>首先给用户表格中，操作列中的分配角色按钮添加单击事件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 分配角色按钮 --&gt;</span><br><span class="line">          &lt;el-tooltip effect=&quot;dark&quot; content=&quot;分配角色&quot; placement=&quot;top&quot; :enterable=&quot;false&quot;&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">              type=&quot;warning&quot;</span><br><span class="line">              icon=&quot;el-icon-setting&quot;</span><br><span class="line">              size=&quot;mini&quot;</span><br><span class="line">              @click=&quot;setRole(scope.row)&quot;</span><br><span class="line">            &gt;&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-tooltip&gt;</span><br></pre></td></tr></table></figure>

<p>这时会将用户的信息传递到<code>setRole</code> 方法中。</p>
<p>在该方法中，我们会查询出所有的角色，然后弹出一个窗口，在这个窗口中，会显示要分配角色的用户信息，同时将查询出的角色最终会绑定到下拉框中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 展示分配角色的对话框</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">setRole</span>(<span class="params">userInfo</span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.userInfo = userInfo;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 在展示对话框之前，获取所有角色的列表</span></span><br><span class="line">     <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;roles&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取角色列表失败！&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">this</span>.rolesList = res.data;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">this</span>.setRoleDialogVisible = <span class="literal">true</span>;</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>在调用<code>setRole</code>方法的时候，会将对应的要分配角色的用户信息传递过来，在这里我们给了<code>userInfo</code>这个属性，最终会将这个属性中存储的内容传递到窗口中进行展示。</p>
<p>接下来，会查询所有的角色信息，并且交给<code>roleList</code>这个属性存储。最后展示对应的对话框。</p>
<p>对话框内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 分配角色的对话框 --&gt;</span><br><span class="line">   &lt;el-dialog title=&quot;分配角色&quot; :visible.sync=&quot;setRoleDialogVisible&quot; width=&quot;50%&quot;&gt;</span><br><span class="line">     &lt;div&gt;</span><br><span class="line">       &lt;p&gt;当前的用户：&#123;&#123;userInfo.username&#125;&#125;&lt;/p&gt;</span><br><span class="line">       &lt;p&gt;当前的角色：&#123;&#123;userInfo.role_name&#125;&#125;&lt;/p&gt;</span><br><span class="line">       &lt;p&gt;&lt;/p&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">     &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">       &lt;el-button @click=&quot;setRoleDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot; @click=&quot;saveRoleInfo&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">     &lt;/span&gt;</span><br><span class="line">   &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>对应的属性定义如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制分配角色对话框的显示与隐藏</span></span><br><span class="line">     <span class="attr">setRoleDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">     <span class="comment">// 需要被分配角色的用户信息</span></span><br><span class="line">     <span class="attr">userInfo</span>: &#123;&#125;,</span><br><span class="line">     <span class="comment">// 所有角色的数据列表</span></span><br><span class="line">     <span class="attr">rolesList</span>: [],</span><br></pre></td></tr></table></figure>

<p><strong>将查询出来的角色数据绑定到下拉框中</strong></p>
<p>在分别角色的对话框中，我们添加了一个下拉框，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 分配角色的对话框 --&gt;</span><br><span class="line">  &lt;el-dialog title=&quot;分配角色&quot; :visible.sync=&quot;setRoleDialogVisible&quot; width=&quot;50%&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;当前的用户：&#123;&#123;userInfo.username&#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;当前的角色：&#123;&#123;userInfo.role_name&#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        分配新角色：</span><br><span class="line">        &lt;el-select v-model=&quot;selectedRoleId&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">          &lt;el-option</span><br><span class="line">            v-for=&quot;item in rolesList&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :label=&quot;item.roleName&quot;</span><br><span class="line">            :value=&quot;item.id&quot;</span><br><span class="line">          &gt;&lt;/el-option&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;el-button @click=&quot;setRoleDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;saveRoleInfo&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，我们通过循环的方式，将<code>rolesList</code>中存储的角色数据全部取出来绑定到了<code>select</code>中。 <code>label</code>属性表示的是下拉框中展示的内容，<code>value</code>:表示选择后的值，同时选择后的值也就是所选择的角色编号会存储到<code>selectedRoleId</code>中。</p>
<p>需要在<code>data</code>中定义<code>selectedRoleId</code>属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 已选中的角色Id值</span></span><br><span class="line">     <span class="attr">selectedRoleId</span>: <span class="string">&quot;&quot;</span>,</span><br></pre></td></tr></table></figure>



<p>同时将<code>Select</code>与<code>Option</code>组件进行注册</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vue.use(Select)</span><br><span class="line">Vue.use(Option)</span><br></pre></td></tr></table></figure>

<p>下面要实现的就是单击<code>分配角色对话框</code>中的“确定”按钮后，完成角色的分配。</p>
<p><strong>完成用户角色的分配</strong></p>
<p><code>saveRoleInfo</code>方法的实现如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，分配角色</span></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">saveRoleInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="built_in">this</span>.selectedRoleId) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;请选择要分配的角色！&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.put(</span><br><span class="line">     <span class="string">`users/<span class="subst">$&#123;<span class="built_in">this</span>.userInfo.id&#125;</span>/role`</span>,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">rid</span>: <span class="built_in">this</span>.selectedRoleId,</span><br><span class="line">     &#125;</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;更新角色失败！&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">this</span>.$message.success(<span class="string">&quot;更新角色成功！&quot;</span>);</span><br><span class="line">   <span class="built_in">this</span>.getUserList();</span><br><span class="line">   <span class="built_in">this</span>.setRoleDialogVisible = <span class="literal">false</span>;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="九、商品分类"><a href="#九、商品分类" class="headerlink" title="九、商品分类"></a>九、商品分类</h1><h2 id="1、商品分类功能介绍"><a href="#1、商品分类功能介绍" class="headerlink" title="1、商品分类功能介绍"></a>1、商品分类功能介绍</h2><p>商品分类用于在购物时，快速找到所要购买的商品，可以通过电商平台主页直观的看到。</p>
<h2 id="2、商品分类组件基本创建"><a href="#2、商品分类组件基本创建" class="headerlink" title="2、商品分类组件基本创建"></a>2、商品分类组件基本创建</h2><p>在<code>components</code>目录下面创建<code>goods</code>目录，在该目录下面创建<code>Cate.vue</code>作为商品分类组件。</p>
<p>基本结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品分类&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 卡片视图区域 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot;&gt;添加分类&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 表格区域 --&gt;</span><br><span class="line">      &lt;!-- 分页区域 --&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>设置对应的路由内容</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Rights <span class="keyword">from</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Roles <span class="keyword">from</span> <span class="string">&quot;./components/power/Roles.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cate <span class="keyword">from</span> <span class="string">&quot;./components/goods/Cate.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/roles&quot;</span>, <span class="attr">component</span>: Roles &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/categories&quot;</span>, <span class="attr">component</span>: Cate &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="3、获取商品分类数据"><a href="#3、获取商品分类数据" class="headerlink" title="3、获取商品分类数据"></a>3、获取商品分类数据</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品分类&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 卡片视图区域 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot;&gt;添加分类&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 表格区域 --&gt;</span><br><span class="line">      &lt;!-- 分页区域 --&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 查询条件</span><br><span class="line">      querInfo: &#123;</span><br><span class="line">        type: 3,//表示展示的是三级分类</span><br><span class="line">        pagenum: 1,</span><br><span class="line">        pagesize: 5,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 商品分类的数据列表，默认为空</span><br><span class="line">      catelist: [],</span><br><span class="line">      // 总数据条数</span><br><span class="line">      total: 0,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getCateList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取商品分类数据</span><br><span class="line">    async getCateList() &#123;</span><br><span class="line">      const &#123; data: res &#125; = await this.$http.get(&quot;categories&quot;, &#123;</span><br><span class="line">        params: this.querInfo,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      if (res.meta.status !== 200) &#123;</span><br><span class="line">        return this.$message.error(&quot;获取商品分类失败！&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      console.log(res.data);</span><br><span class="line">      // 把数据列表，赋值给 catelist</span><br><span class="line">      this.catelist = res.data.result;</span><br><span class="line">      // 为总数据条数赋值</span><br><span class="line">      this.total = res.data.total;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="4、使用vue-table-width-tree-grid展示数据"><a href="#4、使用vue-table-width-tree-grid展示数据" class="headerlink" title="4、使用vue-table-width-tree-grid展示数据"></a>4、使用<code>vue-table-width-tree-grid</code>展示数据</h2><p><code>vue-table-with-tree-grid</code> 是一个树形的表格插件</p>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i vue-table-with-tree-grid</span><br></pre></td></tr></table></figure>

<p>安装好以后，在<code>main.js</code>文件中注册该组件</p>
<p>导入<code>vue-table-with-tree-grid</code>组件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import TreeTable from &quot;vue-table-with-tree-grid&quot;;</span><br></pre></td></tr></table></figure>

<p>注册组件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//注册TreeTable组件</span><br><span class="line">Vue.component(&quot;tree-table&quot;, TreeTable);</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./plugins/element.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./assets/css/global.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./assets/fonts/iconfont.css&quot;</span>;</span><br><span class="line"><span class="comment">//导入vue-table-with-tree-grid</span></span><br><span class="line"><span class="keyword">import</span> TreeTable <span class="keyword">from</span> <span class="string">&quot;vue-table-with-tree-grid&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="comment">// 配置请求的跟路径</span></span><br><span class="line">axios.defaults.baseURL = <span class="string">&quot;http://127.0.0.1:8888/api/private/v1/&quot;</span>;</span><br><span class="line">axios.interceptors.request.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(config)</span></span><br><span class="line">  config.headers.Authorization = <span class="built_in">window</span>.sessionStorage.getItem(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">  <span class="comment">//最后必须返回config</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line">Vue.prototype.$http = axios;</span><br><span class="line"></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//注册TreeTable组件</span></span><br><span class="line">Vue.component(<span class="string">&quot;tree-table&quot;</span>, TreeTable);</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>Cate.vue</code>中使用表格</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 表格区域 --&gt;</span><br><span class="line"></span><br><span class="line">     &lt;tree-table</span><br><span class="line">       :data=&quot;catelist&quot;</span><br><span class="line">       :columns=&quot;columns&quot;</span><br><span class="line">       :selection-type=&quot;false&quot;</span><br><span class="line">       :expand-type=&quot;false&quot;</span><br><span class="line">       show-index</span><br><span class="line">       index-text=&quot;#&quot;</span><br><span class="line">       border</span><br><span class="line">       :show-row-hover=&quot;false&quot;</span><br><span class="line">     &gt;</span><br><span class="line">     &lt;/tree-table&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置表格中的列(<code>columns</code>)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 查询条件</span></span><br><span class="line">      <span class="attr">querInfo</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">pagenum</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pagesize</span>: <span class="number">5</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 商品分类的数据列表，默认为空</span></span><br><span class="line">      <span class="attr">catelist</span>: [],</span><br><span class="line">      <span class="comment">// 总数据条数</span></span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">// 为table指定列的定义</span></span><br><span class="line">      <span class="attr">columns</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">label</span>: <span class="string">&quot;分类名称&quot;</span>,</span><br><span class="line">          <span class="attr">prop</span>: <span class="string">&quot;cat_name&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="5、使用自定义模板列渲染表格数据"><a href="#5、使用自定义模板列渲染表格数据" class="headerlink" title="5、使用自定义模板列渲染表格数据"></a>5、使用自定义模板列渲染表格数据</h2><p>下面我们需要在<code>商品分类</code>这个表格中展示”是否有效”这一列的数据。而这一列数据需要展示出相应的图标内容，</p>
<p>所以需要用到自定义模板列来渲染对应的数据。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 表格区域 --&gt;</span><br><span class="line"></span><br><span class="line">   &lt;tree-table</span><br><span class="line">     :data=&quot;catelist&quot;</span><br><span class="line">     :columns=&quot;columns&quot;</span><br><span class="line">     :selection-type=&quot;false&quot;</span><br><span class="line">     :expand-type=&quot;false&quot;</span><br><span class="line">     show-index</span><br><span class="line">     index-text=&quot;#&quot;</span><br><span class="line">     border</span><br><span class="line">     :show-row-hover=&quot;false&quot;</span><br><span class="line">   &gt;</span><br><span class="line">     &lt;!-- 是否有效 --&gt;</span><br><span class="line">     &lt;template slot=&quot;isok&quot; slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">       &lt;i</span><br><span class="line">         class=&quot;el-icon-success&quot;</span><br><span class="line">         v-if=&quot;scope.row.cat_deleted === false&quot;</span><br><span class="line">         style=&quot;color: lightgreen;&quot;</span><br><span class="line">       &gt;&lt;/i&gt;</span><br><span class="line">       &lt;i class=&quot;el-icon-error&quot; v-else style=&quot;color: red;&quot;&gt;&lt;/i&gt;</span><br><span class="line">     &lt;/template&gt;</span><br><span class="line">   &lt;/tree-table&gt;</span><br></pre></td></tr></table></figure>

<p>在表格中，我们增加了一个模板列同时通过作用域插槽获取对应的数据。</p>
<p>关于插槽<code>isok</code>的定义如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为table指定列的定义</span></span><br><span class="line">     <span class="attr">columns</span>: [</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">label</span>: <span class="string">&quot;分类名称&quot;</span>,</span><br><span class="line">         <span class="attr">prop</span>: <span class="string">&quot;cat_name&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">label</span>: <span class="string">&quot;是否有效&quot;</span>,</span><br><span class="line">         <span class="comment">// 表示，将当前列定义为模板列</span></span><br><span class="line">         <span class="attr">type</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">         <span class="comment">// 表示当前这一列使用模板名称</span></span><br><span class="line">         <span class="attr">template</span>: <span class="string">&quot;isok&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line">     ],</span><br></pre></td></tr></table></figure>

<p>通过<code>label</code>定义当前列的标题，<code>type:&#39;template&#39;</code>:表示当前列为模板列，同时<code>template</code>表示这一列使用模板的名称。</p>
<p>下面我们要做的就是使用同样的方式，将“排序”列与“操作”列的内容给构建出来。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 表格区域 --&gt;</span><br><span class="line"></span><br><span class="line">      &lt;tree-table</span><br><span class="line">        :data=&quot;catelist&quot;</span><br><span class="line">        :columns=&quot;columns&quot;</span><br><span class="line">        :selection-type=&quot;false&quot;</span><br><span class="line">        :expand-type=&quot;false&quot;</span><br><span class="line">        show-index</span><br><span class="line">        index-text=&quot;#&quot;</span><br><span class="line">        border</span><br><span class="line">        :show-row-hover=&quot;false&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 是否有效 --&gt;</span><br><span class="line">        &lt;template slot=&quot;isok&quot; slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;i</span><br><span class="line">            class=&quot;el-icon-success&quot;</span><br><span class="line">            v-if=&quot;scope.row.cat_deleted === false&quot;</span><br><span class="line">            style=&quot;color: lightgreen;&quot;</span><br><span class="line">          &gt;&lt;/i&gt;</span><br><span class="line">          &lt;i class=&quot;el-icon-error&quot; v-else style=&quot;color: red;&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 排序 --&gt;</span><br><span class="line">        &lt;template slot=&quot;order&quot; slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-tag size=&quot;mini&quot; v-if=&quot;scope.row.cat_level === 0&quot;&gt;一级&lt;/el-tag&gt;</span><br><span class="line">          &lt;el-tag</span><br><span class="line">            type=&quot;success&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            v-else-if=&quot;scope.row.cat_level === 1&quot;</span><br><span class="line">            &gt;二级&lt;/el-tag</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-tag type=&quot;warning&quot; size=&quot;mini&quot; v-else&gt;三级&lt;/el-tag&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">        &lt;!-- 操作 --&gt;</span><br><span class="line">        &lt;template slot=&quot;opt&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; size=&quot;mini&quot;</span><br><span class="line">            &gt;编辑&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button type=&quot;danger&quot; icon=&quot;el-icon-delete&quot; size=&quot;mini&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/tree-table&gt;</span><br></pre></td></tr></table></figure>

<p>对应的数据如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为table指定列的定义</span></span><br><span class="line">   <span class="attr">columns</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">label</span>: <span class="string">&quot;分类名称&quot;</span>,</span><br><span class="line">       <span class="attr">prop</span>: <span class="string">&quot;cat_name&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">label</span>: <span class="string">&quot;是否有效&quot;</span>,</span><br><span class="line">       <span class="comment">// 表示，将当前列定义为模板列</span></span><br><span class="line">       <span class="attr">type</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">       <span class="comment">// 表示当前这一列使用模板名称</span></span><br><span class="line">       <span class="attr">template</span>: <span class="string">&quot;isok&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">label</span>: <span class="string">&quot;排序&quot;</span>,</span><br><span class="line">       <span class="comment">// 表示，将当前列定义为模板列</span></span><br><span class="line">       <span class="attr">type</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">       <span class="comment">// 表示当前这一列使用模板名称</span></span><br><span class="line">       <span class="attr">template</span>: <span class="string">&quot;order&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">label</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">       <span class="comment">// 表示，将当前列定义为模板列</span></span><br><span class="line">       <span class="attr">type</span>: <span class="string">&quot;template&quot;</span>,</span><br><span class="line">       <span class="comment">// 表示当前这一列使用模板名称</span></span><br><span class="line">       <span class="attr">template</span>: <span class="string">&quot;opt&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">   ],</span><br></pre></td></tr></table></figure>

<h2 id="6、分页功能实现"><a href="#6、分页功能实现" class="headerlink" title="6、分页功能实现"></a>6、分页功能实现</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 分页区域 --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">      @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">      :current-page=&quot;querInfo.pagenum&quot;</span><br><span class="line">      :page-sizes=&quot;[3, 5, 10, 15]&quot;</span><br><span class="line">      :page-size=&quot;querInfo.pagesize&quot;</span><br><span class="line">      layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br></pre></td></tr></table></figure>

<p>对应方法的实现</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 监听 pagesize 改变</span></span><br><span class="line">    <span class="function"><span class="title">handleSizeChange</span>(<span class="params">newSize</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.querInfo.pagesize = newSize;</span><br><span class="line">      <span class="built_in">this</span>.getCateList();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 监听 pagenum 改变</span></span><br><span class="line">    <span class="function"><span class="title">handleCurrentChange</span>(<span class="params">newPage</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.querInfo.pagenum = newPage;</span><br><span class="line">      <span class="built_in">this</span>.getCateList();</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="7、构建添加分类的对话框与表单"><a href="#7、构建添加分类的对话框与表单" class="headerlink" title="7、构建添加分类的对话框与表单"></a>7、构建添加分类的对话框与表单</h2><p>当单击“添加分类”按钮，会弹出一个窗口，在这个窗口中展示对应的表单。</p>
<p>下面先创建添加分类的对话框,并且在对话框中添加表单</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 添加分类的对话框 --&gt;</span><br><span class="line">   &lt;el-dialog</span><br><span class="line">     title=&quot;添加分类&quot;</span><br><span class="line">     :visible.sync=&quot;addCateDialogVisible&quot;</span><br><span class="line">     width=&quot;50%&quot;</span><br><span class="line">   &gt;</span><br><span class="line">     &lt;!-- 添加分类的表单 --&gt;</span><br><span class="line">     &lt;el-form</span><br><span class="line">       :model=&quot;addCateForm&quot;</span><br><span class="line">       :rules=&quot;addCateFormRules&quot;</span><br><span class="line">       ref=&quot;addCateFormRef&quot;</span><br><span class="line">       label-width=&quot;100px&quot;</span><br><span class="line">     &gt;</span><br><span class="line">       &lt;el-form-item label=&quot;分类名称：&quot; prop=&quot;cat_name&quot;&gt;</span><br><span class="line">         &lt;el-input v-model=&quot;addCateForm.cat_name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">       &lt;/el-form-item&gt;</span><br><span class="line">       &lt;el-form-item label=&quot;父级分类：&quot;&gt; &lt;/el-form-item&gt;</span><br><span class="line">     &lt;/el-form&gt;</span><br><span class="line">     &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">       &lt;el-button @click=&quot;addCateDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">     &lt;/span&gt;</span><br><span class="line">   &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>下面定义对应的数据，以及校验规则</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制添加分类对话框的显示与隐藏</span></span><br><span class="line">     <span class="attr">addCateDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">     <span class="comment">// 添加分类的表单数据对象(这里需要参数API文档)</span></span><br><span class="line">     <span class="attr">addCateForm</span>: &#123;</span><br><span class="line">       <span class="comment">// 将要添加的分类的名称</span></span><br><span class="line">       <span class="attr">cat_name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">       <span class="comment">// 父级分类的Id</span></span><br><span class="line">       <span class="attr">cat_pid</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="comment">// 分类的等级，默认要添加的是1级分类</span></span><br><span class="line">       <span class="attr">cat_level</span>: <span class="number">0</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="comment">// 添加分类表单的验证规则对象</span></span><br><span class="line">     <span class="attr">addCateFormRules</span>: &#123;</span><br><span class="line">       <span class="attr">cat_name</span>: [</span><br><span class="line">         &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入分类名称&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">       ],</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>

<p>当单击“添加分类”按钮后，弹出窗口</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;showAddCateDialog&quot;</span></span></span><br><span class="line"><span class="tag">         &gt;</span>添加分类&lt;/el-button</span><br><span class="line">       &gt;</span><br></pre></td></tr></table></figure>

<p><code>showAddCateDialog</code>方法的实现如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，展示添加分类的对话框</span></span><br><span class="line">   <span class="function"><span class="title">showAddCateDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="comment">// 再展示出对话框</span></span><br><span class="line">     <span class="built_in">this</span>.addCateDialogVisible = <span class="literal">true</span>;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="8、获取父级分类数据"><a href="#8、获取父级分类数据" class="headerlink" title="8、获取父级分类数据"></a>8、获取父级分类数据</h2><p>在弹出的添加分类窗口中，还需要为其添加一个下拉框，在下拉框中展示父级的类别数据，这样我们在添加某个类别的时候，可以确定其父类。</p>
<p>现在先获取系统中所有的父类的数据(这里只获取前两级，系统共分为3级)</p>
<p>首先定义获取父级类别数据的方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取父级分类的数据列表</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">getParentCateList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(<span class="string">&quot;categories&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123; <span class="attr">type</span>: <span class="number">2</span> &#125;,<span class="comment">//这里只获取两级</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取父级分类数据失败！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(res.data);</span><br><span class="line">  <span class="comment">//把获取到的父类数据赋值给parentCateList属性</span></span><br><span class="line">  <span class="built_in">this</span>.parentCateList = res.data;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><code>getParentCateList</code>方法的调用是在窗口打开的时候被调用的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，展示添加分类的对话框</span></span><br><span class="line">   <span class="function"><span class="title">showAddCateDialog</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="comment">// 先获取父级分类的数据列表</span></span><br><span class="line">     <span class="built_in">this</span>.getParentCateList();</span><br><span class="line">     <span class="comment">// 再展示出对话框</span></span><br><span class="line">     <span class="built_in">this</span>.addCateDialogVisible = <span class="literal">true</span>;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>同时在<code>data</code>中定义<code>parentCateList</code>属性，存储获取到的类别数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 父级分类的列表</span></span><br><span class="line">   <span class="attr">parentCateList</span>: [],</span><br></pre></td></tr></table></figure>

<p>下面我们要做的就是将<code>parentCateList</code>中存储的类别数据绑定到下拉框中。</p>
<h2 id="9、渲染级联选择器"><a href="#9、渲染级联选择器" class="headerlink" title="9、渲染级联选择器"></a>9、渲染级联选择器</h2><p>下面我们需要在弹出的窗口的表单中添加一个级联的组件<code>el-cascader</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 添加分类的对话框 --&gt;</span><br><span class="line">   &lt;el-dialog</span><br><span class="line">     title=&quot;添加分类&quot;</span><br><span class="line">     :visible.sync=&quot;addCateDialogVisible&quot;</span><br><span class="line">     width=&quot;50%&quot;</span><br><span class="line">   &gt;</span><br><span class="line">     &lt;!-- 添加分类的表单 --&gt;</span><br><span class="line">     &lt;el-form</span><br><span class="line">       :model=&quot;addCateForm&quot;</span><br><span class="line">       :rules=&quot;addCateFormRules&quot;</span><br><span class="line">       ref=&quot;addCateFormRef&quot;</span><br><span class="line">       label-width=&quot;100px&quot;</span><br><span class="line">     &gt;</span><br><span class="line">       &lt;el-form-item label=&quot;分类名称：&quot; prop=&quot;cat_name&quot;&gt;</span><br><span class="line">         &lt;el-input v-model=&quot;addCateForm.cat_name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">       &lt;/el-form-item&gt;</span><br><span class="line">       &lt;el-form-item label=&quot;父级分类：&quot;&gt;</span><br><span class="line">         &lt;!-- options 用来指定数据源 --&gt;</span><br><span class="line">         &lt;!-- props 用来指定配置对象， --&gt;</span><br><span class="line">         &lt;!-- v-model=&quot;selectedKeys&quot;:在级联框中选择的类别的编号都存储到selectedKeys数组中--&gt;</span><br><span class="line">         &lt;!-- 当选择不同的内容，会触发change事件,这时`selectedKeys`数组中存储的就是选择项的id --&gt;</span><br><span class="line">         &lt;el-cascader</span><br><span class="line">           expand-trigger=&quot;hover&quot;</span><br><span class="line">           :options=&quot;parentCateList&quot;</span><br><span class="line">           :props=&quot;cascaderProps&quot;</span><br><span class="line">           v-model=&quot;selectedKeys&quot;</span><br><span class="line">           @change=&quot;parentCateChanged&quot;</span><br><span class="line">           clearable</span><br><span class="line">         </span><br><span class="line">         &gt;</span><br><span class="line">         &lt;/el-cascader&gt;</span><br><span class="line">       &lt;/el-form-item&gt;</span><br><span class="line">     &lt;/el-form&gt;</span><br><span class="line">     &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">       &lt;el-button @click=&quot;addCateDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">     &lt;/span&gt;</span><br><span class="line">   &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p><code>props</code>中的<code>cascaderProps</code>定义如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 指定级联选择器的配置对象</span></span><br><span class="line">    <span class="attr">cascaderProps</span>: &#123;</span><br><span class="line">      <span class="comment">// value:表示选择一项后获取到的值</span></span><br><span class="line">      <span class="attr">value</span>: <span class="string">&quot;cat_id&quot;</span>,</span><br><span class="line">      <span class="comment">//表示在级联窗口中显示的内容</span></span><br><span class="line">      <span class="attr">label</span>: <span class="string">&quot;cat_name&quot;</span>,</span><br><span class="line">      <span class="comment">//children表示的是父子关系，这里也是通过服务端返回的`children`来指定内容的父子关系</span></span><br><span class="line">      <span class="attr">children</span>: <span class="string">&quot;children&quot;</span>,</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p><code>selectedKeys</code>定义</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 选中的父级分类的Id数组</span></span><br><span class="line"><span class="attr">selectedKeys</span>: [],</span><br></pre></td></tr></table></figure>

<p><code>parentCateChanged</code>方法的实现</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 选择项发生变化触发这个函数</span></span><br><span class="line">   <span class="function"><span class="title">parentCateChanged</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="built_in">this</span>.selectedKeys);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>最后需要注册：<code>Vue.use(Cascader);</code></p>
<h2 id="10、根据父分类的变化处理表单中的数据"><a href="#10、根据父分类的变化处理表单中的数据" class="headerlink" title="10、根据父分类的变化处理表单中的数据"></a>10、根据父分类的变化处理表单中的数据</h2><p>我们知道，当我们单击“添加分类”窗口中的“确定”按钮的时候，需要将<code>类别</code>表单中的数据发送到服务端。</p>
<p>而表单是与<code>addCateForm</code>对象绑定在一起的。该对象在<code>data</code>中的定义如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加分类的表单数据对象(这里需要参数API文档)</span></span><br><span class="line">     <span class="attr">addCateForm</span>: &#123;</span><br><span class="line">       <span class="comment">// 将要添加的分类的名称</span></span><br><span class="line">       <span class="attr">cat_name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">       <span class="comment">// 父级分类的Id</span></span><br><span class="line">       <span class="attr">cat_pid</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="comment">// 分类的等级，默认要添加的是1级分类</span></span><br><span class="line">       <span class="attr">cat_level</span>: <span class="number">0</span>,</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>

<p>首先<code>cat_name</code>属性的值已经确定了，就是用户在“分类名称”文本框中输入的内容。</p>
<p>现在<code>cat_pid</code>与<code>cat_level</code>属性的值没有确定。</p>
<p>但是要想确定这两个属性的值，就需要考虑到<code>el-cascader</code>组件，也就是用户在该组件中选择的父类别。</p>
<p>我们知道当选择<code>el-cascader</code>中的不同类别时会触发<code>change</code>事件，在对应的事件处理函数<code>parentCateChanged</code>中,确定<code>cat_pid</code>与<code>cat_level</code>这两个属性的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 选择项发生变化触发这个函数</span></span><br><span class="line">  <span class="function"><span class="title">parentCateChanged</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.selectedKeys);</span><br><span class="line">    <span class="comment">// 如果 selectedKeys 数组中的 length 大于0，证明选中的父级分类</span></span><br><span class="line">    <span class="comment">// 反之，就说明没有选中任何父级分类</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.selectedKeys.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 父级分类的Id</span></span><br><span class="line">      <span class="built_in">this</span>.addCateForm.cat_pid = <span class="built_in">this</span>.selectedKeys[</span><br><span class="line">        <span class="built_in">this</span>.selectedKeys.length - <span class="number">1</span></span><br><span class="line">      ];</span><br><span class="line">      <span class="comment">// 为当前分类的等级赋值</span></span><br><span class="line">      <span class="built_in">this</span>.addCateForm.cat_level = <span class="built_in">this</span>.selectedKeys.length;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 父级分类的Id</span></span><br><span class="line">      <span class="built_in">this</span>.addCateForm.cat_pid = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// 为当前分类的等级赋值</span></span><br><span class="line">      <span class="built_in">this</span>.addCateForm.cat_level = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>首先判断<code>selectedKeys</code>数组中是否有值，我们知道当用户选择下拉框中的类别数据时，对应的所选择的类别的编号会存储到<code>selectedKeys</code>数组中，如果该数组没有值，表明用户没有选择任何类别。那也就是说现在用户所添加的类别是根类别，所以<code>cat_pid</code>与<code>cat_level</code>的值都为0.</p>
<p>如果<code>selectedKeys</code>数组中有值，我们可以取出数组中的最后一个<code>id</code>值作为当前所添加类别的父类别编号。</p>
<p>例如：如果<code>selectedKeys</code>数组中的值为:[12,13]  表明用户选择了编号为<code>12</code>这个根下的编号为<code>13</code>的类别，这时新添加的类别就是编号为<code>13</code>的子类别。</p>
<p>通过以上的处理，我们已经能够确定出<code>cat_pid</code>这个属性的值。</p>
<p>下面思考一下怎样确定<code>cat_level</code>这个属性的值？</p>
<p>该属性表示的是当前类别的等级。如果是一级则该属性的值为0，二级为1，三级为2.所以这里可以根据数组的长度来确定出<code>cat_level</code>的值。还是以上面的例子来说明，如果<code>selectedKeys</code>数组中的值为[12,13],那么获取到的数组长度的值为2，表明现在所添加的类别的等级值为2，也就是三级。</p>
<p>最后可以测试一下：</p>
<p>给窗口的确定按钮，添加单击事件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;el-button @click=&quot;addCateDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;addCate&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">    &lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p><code>addCate</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，添加新的分类</span></span><br><span class="line">  <span class="function"><span class="title">addCate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.addCateForm);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>可以打印<code>addCateForm</code>中的值。</p>
<h2 id="11、完成类别添加"><a href="#11、完成类别添加" class="headerlink" title="11、完成类别添加"></a>11、完成类别添加</h2><p>最终的<code>addCate</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，添加新的分类</span></span><br><span class="line"> <span class="function"><span class="title">addCate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="comment">//   console.log(this.addCateForm);</span></span><br><span class="line">   <span class="built_in">this</span>.$refs.addCateFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">     <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;</span><br><span class="line">     <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(</span><br><span class="line">       <span class="string">&quot;categories&quot;</span>,</span><br><span class="line">       <span class="built_in">this</span>.addCateForm</span><br><span class="line">     );</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">201</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;添加分类失败！&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">this</span>.$message.success(<span class="string">&quot;添加分类成功！&quot;</span>);</span><br><span class="line">     <span class="built_in">this</span>.getCateList();</span><br><span class="line">     <span class="built_in">this</span>.addCateDialogVisible = <span class="literal">false</span>;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>将<code>addCateForm</code>中存储的数据通过<code>post</code>方式发送到服务端。</p>
<h1 id="十、分类参数"><a href="#十、分类参数" class="headerlink" title="十、分类参数"></a>十、分类参数</h1><h2 id="1、分类参数功能介绍"><a href="#1、分类参数功能介绍" class="headerlink" title="1、分类参数功能介绍"></a>1、分类参数功能介绍</h2><p>商品参数用于显示商品的固定的特征信息，可以通过电商平台商品详情页面直观看到。</p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211120150847.png"></p>
<p><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211120150848.png"></p>
<h2 id="2、构建分类参数组件"><a href="#2、构建分类参数组件" class="headerlink" title="2、构建分类参数组件"></a>2、构建分类参数组件</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;参数列表&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 卡片视图区域 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;!-- 警告区域 --&gt;</span><br><span class="line">      &lt;el-alert</span><br><span class="line">        show-icon</span><br><span class="line">        title=&quot;注意：只允许为第三级分类设置相关参数！&quot;</span><br><span class="line">        type=&quot;warning&quot;</span><br><span class="line">        :closable=&quot;false&quot;</span><br><span class="line">      &gt;&lt;/el-alert&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 选择商品分类区域 --&gt;</span><br><span class="line">      &lt;el-row class=&quot;cat_opt&quot;&gt;</span><br><span class="line">        &lt;el-col&gt;</span><br><span class="line">          &lt;span&gt;选择商品分类：&lt;/span&gt;</span><br><span class="line">          &lt;!-- 选择商品分类的级联选择框 --&gt;</span><br><span class="line">          &lt;el-cascader</span><br><span class="line">            expand-trigger=&quot;hover&quot;</span><br><span class="line">            :options=&quot;catelist&quot;</span><br><span class="line">            :props=&quot;cateProps&quot;</span><br><span class="line">            v-model=&quot;selectedCateKeys&quot;</span><br><span class="line">            @change=&quot;handleChange&quot;</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;/el-cascader&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 商品分类列表</span><br><span class="line">      catelist: [],</span><br><span class="line">      // 级联选择框的配置对象</span><br><span class="line">      cateProps: &#123;</span><br><span class="line">        value: &quot;cat_id&quot;,</span><br><span class="line">        label: &quot;cat_name&quot;,</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 级联选择框双向绑定到的数组</span><br><span class="line">      selectedCateKeys: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getCateList();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取所有的商品分类列表</span><br><span class="line">    async getCateList() &#123;</span><br><span class="line">      const &#123; data: res &#125; = await this.$http.get(&quot;categories&quot;);</span><br><span class="line">      if (res.meta.status !== 200) &#123;</span><br><span class="line">        return this.$message.error(&quot;获取商品分类失败！&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.catelist = res.data;</span><br><span class="line"></span><br><span class="line">      console.log(this.catelist);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 级联选择框选中项变化，会触发这个函数</span><br><span class="line">    handleChange() &#123;</span><br><span class="line">      //   console.log(this.selectedCateKeys);</span><br><span class="line">      this.getParamsData();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 获取参数的列表数据</span><br><span class="line">    async getParamsData() &#123;</span><br><span class="line">      // 证明选中的不是三级分类</span><br><span class="line">      //这里只允许选择第三个类别。</span><br><span class="line">      if (this.selectedCateKeys.length !== 3) &#123;</span><br><span class="line">        this.selectedCateKeys = [];</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.cat_opt &#123;</span><br><span class="line">  margin: 15px 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上面的代码中，构建了级联选择框，并且获取了类别数据，填充到级联选择框中。</p>
<p>同时，这里对级联选择框中的类别选择有要求，只能选择第三个类别。</p>
<p>下面创建路由</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Rights <span class="keyword">from</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Roles <span class="keyword">from</span> <span class="string">&quot;./components/power/Roles.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cate <span class="keyword">from</span> <span class="string">&quot;./components/goods/Cate.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Params <span class="keyword">from</span> <span class="string">&quot;./components/goods/Params.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/roles&quot;</span>, <span class="attr">component</span>: Roles &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/categories&quot;</span>, <span class="attr">component</span>: Cate &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/params&quot;</span>, <span class="attr">component</span>: Params &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>同时，由于在整个页面中，使用了<code>Alter</code>组件，所以需要在<code>element.js</code>文件中注册一下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vue.use(Alert);</span><br></pre></td></tr></table></figure>

<h2 id="3、渲染Tab页签。"><a href="#3、渲染Tab页签。" class="headerlink" title="3、渲染Tab页签。"></a>3、渲染<code>Tab</code>页签。</h2><p>关于分类参数的展示，是通过<code>Tab</code>页签来实现的。</p>
<p>在选择商品分类区域的下面添加<code>el-tabs</code>组件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- tab 页签区域 --&gt;</span><br><span class="line">     &lt;el-tabs v-model=&quot;activeName&quot; @tab-click=&quot;handleTabClick&quot;&gt;</span><br><span class="line">       &lt;!-- 添加动态参数的面板 --&gt;</span><br><span class="line">       &lt;el-tab-pane label=&quot;动态参数&quot; name=&quot;many&quot;&gt;&lt;/el-tab-pane&gt;</span><br><span class="line">       &lt;el-tab-pane label=&quot;静态属性&quot; name=&quot;only&quot;&gt;&lt;/el-tab-pane&gt;</span><br><span class="line">     &lt;/el-tabs&gt;</span><br></pre></td></tr></table></figure>

<p><code>v-model</code>所绑定的属性指的被激活的页签的名称。</p>
<p>在<code>data</code>中定义<code>activeName</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 被激活的页签的名称</span></span><br><span class="line">    <span class="attr">activeName</span>: <span class="string">&quot;many&quot;</span>,</span><br></pre></td></tr></table></figure>

<p>单击页签会执行<code>handleTabClick</code>处理函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tab 页签点击事件的处理函数</span></span><br><span class="line">  <span class="function"><span class="title">handleTabClick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.activeName);</span><br><span class="line">    <span class="comment">//   this.getParamsData();</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>同时要完成页签组件的注册。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.use(Tabs);</span><br><span class="line">Vue.use(TabPane);</span><br></pre></td></tr></table></figure>

<h2 id="4、渲染添加参数与属性按钮"><a href="#4、渲染添加参数与属性按钮" class="headerlink" title="4、渲染添加参数与属性按钮"></a>4、渲染添加参数与属性按钮</h2><p>现在已经将基本的<code>tab</code>页签渲染出来了，下面要做的就是在”动态参数”与“静态属性”这两个页签下面添加相应的按钮，分别为“添加参数”按钮与“添加属性”按钮。</p>
<p>并且当用户选择了“商品分类”下拉框中的第三个类别的时候，这些按钮才会启用。</p>
<p>所以这里通过计算属性来判断数组<code>selectedCateKeys</code>中的长度是否为<code>3</code>,如果为<code>3</code>,表明用户选择了三级类别。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- tab 页签区域 --&gt;</span><br><span class="line">    &lt;el-tabs v-model=&quot;activeName&quot; @tab-click=&quot;handleTabClick&quot;&gt;</span><br><span class="line">      &lt;!-- 添加动态参数的面板 --&gt;</span><br><span class="line">      &lt;el-tab-pane label=&quot;动态参数&quot; name=&quot;many&quot;&gt;</span><br><span class="line">        &lt;!-- 添加参数的按钮 --&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; :disabled=&quot;isBtnDisabled&quot;&gt;添加参数&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-tab-pane&gt;</span><br><span class="line">      &lt;el-tab-pane label=&quot;静态属性&quot; name=&quot;only&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; :disabled=&quot;isBtnDisabled&quot;&gt;添加属性&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-tab-pane&gt;</span><br><span class="line">    &lt;/el-tabs&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，我们在页签中添加了相应的按钮。并且让<code>disabled</code>动态绑定了计算属性<code>isBtnDisabled</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// 如果按钮需要被禁用，则返回true，否则返回false</span></span><br><span class="line">  <span class="function"><span class="title">isBtnDisabled</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.selectedCateKeys.length !== <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>如果数组的长度不为<code>3</code>,返回<code>true</code>.表明要禁用按钮。</p>
<h2 id="5、切换Tab页签获取数据"><a href="#5、切换Tab页签获取数据" class="headerlink" title="5、切换Tab页签获取数据"></a>5、切换<code>Tab</code>页签获取数据</h2><p>下面要实现的就是，当单击<code>动态参数</code>与<code>静态属性</code>这两个页签的时候，要查询到对应的数据，然后绑定到相应的表格中。</p>
<p>要想获得对应的数据，这里需要确定两个参数，一个是用户所选择的下拉框中第三类别的编号，再有一个就是所选择的<code>Tab</code>页签。</p>
<p>怎样获取用户所选择的“商品分类”下拉中用户选择的第三个类别的编号呢？</p>
<p>这里，也是通过计算属性来完成的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  <span class="comment">// 如果按钮需要被禁用，则返回true，否则返回false</span></span><br><span class="line">  <span class="function"><span class="title">isBtnDisabled</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.selectedCateKeys.length !== <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 当前选中的三级分类的Id</span></span><br><span class="line">  <span class="function"><span class="title">cateId</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.selectedCateKeys.length === <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.selectedCateKeys[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>关于确定用户到底选择了哪个<code>Tab</code>页签，其实前面我们已经处理过了，</p>
<p>我们给<code>el-tabs</code>标签添加了<code>v-model=&quot;activeName&quot; </code>,并且<code> activeName: &quot;many&quot;,</code>表示的就是用户激活的页签的名称。</p>
<p>同时每一个<code>el-tab-pane </code>都添加了<code>name</code> 属性</p>
<p>现在，两个参数都已经确定好了，下面要考虑的就是什么时候将这两个参数发送到服务端呢？</p>
<p>第一种情况是：用户选择了“商品分类”下拉框中的某个第三级类别时，就应该发送请求，为什么呢？</p>
<p>因为，我们这是默认会有一个页签是选中的。这是可以将默认选中页签的名称与类别编号发送到服务端。</p>
<p>第二种情况是：用户选择了某个三级类别后，后期有选择了另外一个页签，这是也应该发送请求。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 级联选择框选中项变化，会触发这个函数</span></span><br><span class="line">   <span class="function"><span class="title">handleChange</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="comment">//   console.log(this.selectedCateKeys);</span></span><br><span class="line">     <span class="built_in">this</span>.getParamsData();</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="comment">// tab 页签点击事件的处理函数</span></span><br><span class="line">   <span class="function"><span class="title">handleTabClick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="built_in">this</span>.activeName);</span><br><span class="line">     <span class="built_in">this</span>.getParamsData();</span><br><span class="line">   &#125;,</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 获取参数的列表数据</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">getParamsData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="comment">// 证明选中的不是三级分类</span></span><br><span class="line">     <span class="comment">//这里只允许选择第三个类别。</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.selectedCateKeys.length !== <span class="number">3</span>) &#123;</span><br><span class="line">       <span class="built_in">this</span>.selectedCateKeys = [];</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// 证明选中的是三级分类</span></span><br><span class="line">     <span class="built_in">console</span>.log(<span class="built_in">this</span>.selectedCateKeys);</span><br><span class="line">     <span class="comment">// 根据所选分类的Id，和当前所处的面板，获取对应的参数</span></span><br><span class="line">     <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(</span><br><span class="line">       <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes`</span>,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">params</span>: &#123; <span class="attr">sel</span>: <span class="built_in">this</span>.activeName &#125;,</span><br><span class="line">       &#125;</span><br><span class="line">     );</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取参数列表失败！&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">console</span>.log(res.data);</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.activeName === <span class="string">&quot;many&quot;</span>) &#123;</span><br><span class="line">       <span class="built_in">this</span>.manyTableData = res.data;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.onlyTableData = res.data;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>如果用户选择的是”动态参数”,将查询到的数据存储到<code>manyTableData</code>这个状态属性上，否则存储到<code>onlyTableData</code>这个属性上，因为这里我们要将数据绑定到两个表格中。</p>
<h2 id="6、渲染表格"><a href="#6、渲染表格" class="headerlink" title="6、渲染表格"></a>6、渲染表格</h2><p>现在，已经将数据全部取出来了，下面将这些数据渲染到相应的表格中。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- tab 页签区域 --&gt;</span><br><span class="line">    &lt;el-tabs v-model=&quot;activeName&quot; @tab-click=&quot;handleTabClick&quot;&gt;</span><br><span class="line">      &lt;!-- 添加动态参数的面板 --&gt;</span><br><span class="line">      &lt;el-tab-pane label=&quot;动态参数&quot; name=&quot;many&quot;&gt;</span><br><span class="line">        &lt;!-- 添加参数的按钮 --&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; :disabled=&quot;isBtnDisabled&quot;&gt;添加参数&lt;/el-button&gt;</span><br><span class="line">        &lt;!-- 动态参数表格 --&gt;</span><br><span class="line">        &lt;el-table :data=&quot;manyTableData&quot; border stripe&gt;</span><br><span class="line">          &lt;!-- 展开行 --&gt;</span><br><span class="line">          &lt;el-table-column type=&quot;expand&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;!-- 索引列 --&gt;</span><br><span class="line">          &lt;el-table-column type=&quot;index&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column label=&quot;参数名称&quot; prop=&quot;attr_name&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">            &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">              &lt;el-button</span><br><span class="line">                size=&quot;mini&quot;</span><br><span class="line">                type=&quot;primary&quot;</span><br><span class="line">                icon=&quot;el-icon-edit&quot;</span><br><span class="line">                @click=&quot;showEditDialog(scope.row.attr_id)&quot;</span><br><span class="line">              &gt;编辑&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button</span><br><span class="line">                size=&quot;mini&quot;</span><br><span class="line">                type=&quot;danger&quot;</span><br><span class="line">                icon=&quot;el-icon-delete&quot;</span><br><span class="line">                @click=&quot;removeParams(scope.row.attr_id)&quot;</span><br><span class="line">              &gt;删除&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">      &lt;/el-tab-pane&gt;</span><br><span class="line">      &lt;el-tab-pane label=&quot;静态属性&quot; name=&quot;only&quot;&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; :disabled=&quot;isBtnDisabled&quot;&gt;添加属性&lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 静态属性表格 --&gt;</span><br><span class="line">        &lt;el-table :data=&quot;onlyTableData&quot; border stripe&gt;</span><br><span class="line">          &lt;!-- 展开行 --&gt;</span><br><span class="line">          &lt;el-table-column type=&quot;expand&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;!-- 索引列 --&gt;</span><br><span class="line">          &lt;el-table-column type=&quot;index&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column label=&quot;属性名称&quot; prop=&quot;attr_name&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">            &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">              &lt;el-button</span><br><span class="line">                size=&quot;mini&quot;</span><br><span class="line">                type=&quot;primary&quot;</span><br><span class="line">                icon=&quot;el-icon-edit&quot;</span><br><span class="line">                @click=&quot;showEditDialog(scope.row.attr_id)&quot;</span><br><span class="line">              &gt;编辑&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button</span><br><span class="line">                size=&quot;mini&quot;</span><br><span class="line">                type=&quot;danger&quot;</span><br><span class="line">                icon=&quot;el-icon-delete&quot;</span><br><span class="line">                @click=&quot;removeParams(scope.row.attr_id)&quot;</span><br><span class="line">              &gt;删除&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">      &lt;/el-tab-pane&gt;</span><br><span class="line">    &lt;/el-tabs&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的<code>el-tabs</code>页签中，分别添加了两个表格，分别渲染”动态参数”“与”静态属性“相应的数据。</p>
<h2 id="7、渲染添加参数的对话框"><a href="#7、渲染添加参数的对话框" class="headerlink" title="7、渲染添加参数的对话框"></a>7、渲染添加参数的对话框</h2><p>这里的参数分为“动态参数“与”静态属性“两种情况，这里我们都是通过一个窗口完成添加的。</p>
<p>在<code>el-card</code>组件下面</p>
<p>首先添加一个窗口组件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 添加参数的对话框 --&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;&#x27;添加&#x27; + titleText&quot;</span><br><span class="line">      :visible.sync=&quot;addDialogVisible&quot;</span><br><span class="line">      width=&quot;50%&quot;</span><br><span class="line">      @close=&quot;addDialogClosed&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 添加参数的对话框 --&gt;</span><br><span class="line">      &lt;el-form :model=&quot;addForm&quot; :rules=&quot;addFormRules&quot; ref=&quot;addFormRef&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">        &lt;el-form-item :label=&quot;titleText&quot; prop=&quot;attr_name&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;addForm.attr_name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;addDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>这里，我们给窗口的标题采用了动态绑定的方式，也是使用了计算属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    <span class="comment">// 如果按钮需要被禁用，则返回true，否则返回false</span></span><br><span class="line">    <span class="function"><span class="title">isBtnDisabled</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.selectedCateKeys.length !== <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 当前选中的三级分类的Id</span></span><br><span class="line">    <span class="function"><span class="title">cateId</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.selectedCateKeys.length === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.selectedCateKeys[<span class="number">2</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 动态计算标题的文本</span></span><br><span class="line">    <span class="function"><span class="title">titleText</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.activeName === <span class="string">&quot;many&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;动态参数&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;静态属性&quot;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>还有就是监听窗口关闭事件触发后，对应的处理函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 监听添加对话框的关闭事件</span></span><br><span class="line">   <span class="function"><span class="title">addDialogClosed</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.$refs.addFormRef.resetFields();</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>对应的<code>data</code>属性的定义如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制添加对话框的显示与隐藏</span></span><br><span class="line">     <span class="attr">addDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">     <span class="comment">// 添加参数的表单数据对象</span></span><br><span class="line">     <span class="attr">addForm</span>: &#123;</span><br><span class="line">       <span class="attr">attr_name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="comment">// 添加表单的验证规则对象</span></span><br><span class="line">     <span class="attr">addFormRules</span>: &#123;</span><br><span class="line">       <span class="attr">attr_name</span>: [</span><br><span class="line">         &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入参数名称&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">       ],</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>

<p>单击“添加属性”与“添加参数”按钮将对话框展示出来。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 添加参数的按钮 --&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          type=&quot;primary&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          :disabled=&quot;isBtnDisabled&quot;</span><br><span class="line">          @click=&quot;addDialogVisible=true&quot;</span><br><span class="line">        &gt;添加参数&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">           type=&quot;primary&quot;</span><br><span class="line">           size=&quot;mini&quot;</span><br><span class="line">           :disabled=&quot;isBtnDisabled&quot;</span><br><span class="line">           @click=&quot;addDialogVisible=true&quot;</span><br><span class="line">         &gt;添加属性&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<h2 id="8、完成参数的添加"><a href="#8、完成参数的添加" class="headerlink" title="8、完成参数的添加"></a>8、完成参数的添加</h2><p>当单击弹出的窗口中的”添加”按钮的时候，完成对应的添加。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; @click=&quot;addParams&quot;&gt;确 定&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>对应的<code>addParams</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，添加参数</span></span><br><span class="line"> <span class="function"><span class="title">addParams</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="built_in">this</span>.$refs.addFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">     <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;</span><br><span class="line">     <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(</span><br><span class="line">       <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes`</span>,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">attr_name</span>: <span class="built_in">this</span>.addForm.attr_name,<span class="comment">//获取表单中的数据</span></span><br><span class="line">         <span class="attr">attr_sel</span>: <span class="built_in">this</span>.activeName,<span class="comment">//获取对应的页签名称</span></span><br><span class="line">       &#125;</span><br><span class="line">     );</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">201</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;添加参数失败！&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">this</span>.$message.success(<span class="string">&quot;添加参数成功！&quot;</span>);</span><br><span class="line">     <span class="built_in">this</span>.addDialogVisible = <span class="literal">false</span>;</span><br><span class="line">     <span class="built_in">this</span>.getParamsData();</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="9、修改参数"><a href="#9、修改参数" class="headerlink" title="9、修改参数"></a>9、修改参数</h2><p>在具体修改参数之前，首先会弹出一个对话框，在该对话框中展示要修改的参数。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 修改参数的对话框 --&gt;</span><br><span class="line">   &lt;el-dialog</span><br><span class="line">     :title=&quot;&#x27;修改&#x27; + titleText&quot;</span><br><span class="line">     :visible.sync=&quot;editDialogVisible&quot;</span><br><span class="line">     width=&quot;50%&quot;</span><br><span class="line">     @close=&quot;editDialogClosed&quot;</span><br><span class="line">   &gt;</span><br><span class="line">     &lt;!-- 添加参数的对话框 --&gt;</span><br><span class="line">     &lt;el-form :model=&quot;editForm&quot; :rules=&quot;editFormRules&quot; ref=&quot;editFormRef&quot; label-width=&quot;100px&quot;&gt;</span><br><span class="line">       &lt;el-form-item :label=&quot;titleText&quot; prop=&quot;attr_name&quot;&gt;</span><br><span class="line">         &lt;el-input v-model=&quot;editForm.attr_name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">       &lt;/el-form-item&gt;</span><br><span class="line">     &lt;/el-form&gt;</span><br><span class="line">     &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">       &lt;el-button @click=&quot;editDialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot; @click=&quot;editParams&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">     &lt;/span&gt;</span><br><span class="line">   &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>添加对应的<code>data</code>属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制修改对话框的显示与隐藏</span></span><br><span class="line">    <span class="attr">editDialogVisible</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 修改的表单数据对象</span></span><br><span class="line">    <span class="attr">editForm</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">// 修改表单的验证规则对象</span></span><br><span class="line">    <span class="attr">editFormRules</span>: &#123;</span><br><span class="line">      <span class="attr">attr_name</span>: [</span><br><span class="line">        &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请输入参数名称&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>给两个表格中的修改按钮，绑定对应的单击事件，弹出上面指定的窗口。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button</span><br><span class="line">                 size=&quot;mini&quot;</span><br><span class="line">                 type=&quot;primary&quot;</span><br><span class="line">                 icon=&quot;el-icon-edit&quot;</span><br><span class="line">                 @click=&quot;showEditDialog(scope.row.attr_id)&quot;</span><br><span class="line">               &gt;编辑&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p><code>showEditDialog</code>方法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，展示修改的对话框</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">showEditDialog</span>(<span class="params">attr_id</span>)</span> &#123;</span><br><span class="line">     <span class="comment">// 查询当前参数的信息</span></span><br><span class="line">     <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(</span><br><span class="line">       <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes/<span class="subst">$&#123;attr_id&#125;</span>`</span>,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">params</span>: &#123; <span class="attr">attr_sel</span>: <span class="built_in">this</span>.activeName &#125;,</span><br><span class="line">       &#125;</span><br><span class="line">     );</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取参数信息失败！&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">this</span>.editForm = res.data;</span><br><span class="line">     <span class="built_in">this</span>.editDialogVisible = <span class="literal">true</span>;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="comment">// 重置修改的表单</span></span><br><span class="line">   <span class="function"><span class="title">editDialogClosed</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.$refs.editFormRef.resetFields();</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>下面就是单击窗口中的“确定”按钮的时候，完成参数信息的更新。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;primary&quot; @click=&quot;editParams&quot;&gt;确 定&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p><code>editParams</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，修改参数信息</span></span><br><span class="line"> <span class="function"><span class="title">editParams</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="built_in">this</span>.$refs.editFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">     <span class="keyword">if</span> (!valid) <span class="keyword">return</span>;</span><br><span class="line">     <span class="keyword">const</span> &#123;</span><br><span class="line">       <span class="attr">data</span>: res,</span><br><span class="line">     &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.put(</span><br><span class="line">       <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes/<span class="subst">$&#123;<span class="built_in">this</span>.editForm.attr_id&#125;</span>`</span>,</span><br><span class="line">       &#123; <span class="attr">attr_name</span>: <span class="built_in">this</span>.editForm.attr_name, <span class="attr">attr_sel</span>: <span class="built_in">this</span>.activeName &#125;</span><br><span class="line">     );</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;修改参数失败！&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">this</span>.$message.success(<span class="string">&quot;修改参数成功！&quot;</span>);</span><br><span class="line">     <span class="built_in">this</span>.getParamsData();</span><br><span class="line">     <span class="built_in">this</span>.editDialogVisible = <span class="literal">false</span>;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="10、删除参数"><a href="#10、删除参数" class="headerlink" title="10、删除参数"></a>10、删除参数</h2><p>当单击表格中的“删除”按钮的时候，完成参数数据的删除。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据Id删除对应的参数项</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">removeParams</span>(<span class="params">attr_id</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> confirmResult = <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(</span><br><span class="line">    <span class="string">&#x27;此操作将永久删除该参数, 是否继续?&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">      <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ).catch(<span class="function"><span class="params">err</span> =&gt;</span> err)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用户取消了删除的操作</span></span><br><span class="line">  <span class="keyword">if</span> (confirmResult !== <span class="string">&#x27;confirm&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.$message.info(<span class="string">&#x27;已取消删除！&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除的业务逻辑</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.delete(</span><br><span class="line">    <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes/<span class="subst">$&#123;attr_id&#125;</span>`</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&#x27;删除参数失败！&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.$message.success(<span class="string">&#x27;删除参数成功！&#x27;</span>)</span><br><span class="line">  <span class="built_in">this</span>.getParamsData()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是完成数据删除的业务操作。</p>
<p>下面需要给两个表格中的“删除”按钮添加对应的事件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">icon</span>=<span class="string">&quot;el-icon-delete&quot;</span></span></span><br><span class="line"><span class="tag">                 @<span class="attr">click</span>=<span class="string">&quot;removeParams(scope.row.attr_id)&quot;</span></span></span><br><span class="line"><span class="tag">               &gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="11、渲染参数下的可选项"><a href="#11、渲染参数下的可选项" class="headerlink" title="11、渲染参数下的可选项"></a>11、渲染参数下的可选项</h2><p>当单击表格中第一列，展开列的时候，应该能够展示出每个类别下的对应的属性。</p>
<p>在展开列中展示的这些属性，都是保存在<code>attr_vals</code>这个属性中的，并且是以空格进行分隔，所以这里，我们可以以“空格”来作为分隔符，分隔成数组，然后通过遍历的方式，再将其渲染到页面中。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取参数的列表数据</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getParamsData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 证明选中的不是三级分类</span></span><br><span class="line">      <span class="comment">//这里只允许选择第三个类别。</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.selectedCateKeys.length !== <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.selectedCateKeys = [];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 证明选中的是三级分类</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.selectedCateKeys);</span><br><span class="line">      <span class="comment">// 根据所选分类的Id，和当前所处的面板，获取对应的参数</span></span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(</span><br><span class="line">        <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes`</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">params</span>: &#123; <span class="attr">sel</span>: <span class="built_in">this</span>.activeName &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取参数列表失败！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//对attr_vals的内容进行分隔。</span></span><br><span class="line">      res.data.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        item.attr_vals = item.attr_vals ? item.attr_vals.split(<span class="string">&quot; &quot;</span>) : [];</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">console</span>.log(res.data);</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.activeName === <span class="string">&quot;many&quot;</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.manyTableData = res.data;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.onlyTableData = res.data;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>getdParamsData</code>方法中，对服务端返回的内容进行遍历，然后获取每一项中的<code>attr_vals</code>属性，然后按照空格进行分隔。</p>
<p>分隔完后，返回的是一个数组，交给了<code>item.attr_vals</code>。</p>
<p>在前端对<code>item.attr_vals</code>进行循环遍历。</p>
<p>在两个表格中的展开列中，添加如下的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 展开行 --&gt;</span><br><span class="line">          &lt;el-table-column type=&quot;expand&quot;&gt;</span><br><span class="line">            &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">              &lt;!-- 循环渲染Tag标签 --&gt;</span><br><span class="line">              &lt;el-tag</span><br><span class="line">                v-for=&quot;(item, i) in scope.row.attr_vals&quot;</span><br><span class="line">                :key=&quot;i&quot;</span><br><span class="line">                closable</span><br><span class="line">                @close=&quot;handleClose(i, scope.row)&quot;</span><br><span class="line">              &gt;&#123;&#123;item&#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<h2 id="12、实现指定参数属性的添加"><a href="#12、实现指定参数属性的添加" class="headerlink" title="12、实现指定参数属性的添加"></a>12、实现指定参数属性的添加</h2><p>经过上面的操作，现在已经实现了，单击展开列，会展示出相应的属性。下面实现属性的添加。</p>
<p>首先先展示出添加的窗口。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 展开行 --&gt;</span><br><span class="line">          &lt;el-table-column type=&quot;expand&quot;&gt;</span><br><span class="line">            &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">              &lt;!-- 循环渲染Tag标签 --&gt;</span><br><span class="line">              &lt;el-tag</span><br><span class="line">                v-for=&quot;(item, i) in scope.row.attr_vals&quot;</span><br><span class="line">                :key=&quot;i&quot;</span><br><span class="line">                closable</span><br><span class="line">                @close=&quot;handleClose(i, scope.row)&quot;</span><br><span class="line">              &gt;&#123;&#123;item&#125;&#125;&lt;/el-tag&gt;</span><br><span class="line">              &lt;!-- 输入的文本框 --&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                class=&quot;input-new-tag&quot;</span><br><span class="line">                v-if=&quot;scope.row.inputVisible&quot;</span><br><span class="line">                v-model=&quot;scope.row.inputValue&quot;</span><br><span class="line">                ref=&quot;saveTagInput&quot;</span><br><span class="line">                size=&quot;small&quot;</span><br><span class="line">                @keyup.enter.native=&quot;handleInputConfirm(scope.row)&quot;</span><br><span class="line">                @blur=&quot;handleInputConfirm(scope.row)&quot;</span><br><span class="line">              &gt;&lt;/el-input&gt;</span><br><span class="line">              &lt;!-- 添加按钮 --&gt;</span><br><span class="line">              &lt;el-button</span><br><span class="line">                v-else</span><br><span class="line">                class=&quot;button-new-tag&quot;</span><br><span class="line">                size=&quot;small&quot;</span><br><span class="line">                @click=&quot;showInput(scope.row)&quot;</span><br><span class="line">              &gt;+ New Tag&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<p>在两个表格中的展开行中，添加输入框与按钮。</p>
<p>如果<code>scope.row.inputVisible</code>为<code>true</code>,展示输入框，否则展示添加按钮。</p>
<p>下面看一下<code>scope.row.inputVisible</code>是哪来的呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//对attr_vals的内容进行分隔。</span></span><br><span class="line">      res.data.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        item.attr_vals = item.attr_vals ? item.attr_vals.split(<span class="string">&quot; &quot;</span>) : [];</span><br><span class="line">        <span class="comment">// 控制文本框的显示与隐藏</span></span><br><span class="line">        item.inputVisible = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 文本框中输入的值</span></span><br><span class="line">        item.inputValue = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>

<p>在<code>getParamsData</code>方法中，在对返回的数据进行遍历，取出每一项后，按照空格分隔，然后在给<code>item</code>对象添加<code>inputVisible</code>属性设置了<code>false</code>,<code>inputValue</code>设置为空字符串。</p>
<p>这样做的目的就是保证了<code>scope.row.inputVisible</code>,值的唯一，也就是每行中的值都是唯一的。</p>
<p><code>handleInputConfirm</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 文本框失去焦点，或摁下了 Enter 都会触发</span></span><br><span class="line">   <span class="keyword">async</span> <span class="function"><span class="title">handleInputConfirm</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(row);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>当点击按钮的时候，会执行<code>showInput</code>方法，该方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，展示文本输入框</span></span><br><span class="line"><span class="function"><span class="title">showInput</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(row);</span></span><br><span class="line">  row.inputVisible = <span class="literal">true</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这样将<code>inputVisible</code>设置为<code>true</code>后，会展示出对应的文本框。</p>
<p>现在能够完成添加按钮与文本框的切换了<strong>，接下来要实现的就是让文本框能够自动获取到焦点。</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 点击按钮，展示文本输入框</span></span><br><span class="line">  <span class="function"><span class="title">showInput</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(row);</span></span><br><span class="line">    row.inputVisible = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// $nextTick 方法的作用，就是当页面上元素被重新渲染之后，才会执行回调函数中的代码</span></span><br><span class="line">    <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$refs.saveTagInput.$refs.input.focus();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>在<code>showInput</code>方法中，添加了<code>$nextTick</code>函数。</p>
<p>当<code>  row.inputVisible = true;</code>设置为<code>true</code>后，并不能保证立即获取到文本框，而当<code>$nextTick</code>方法执行了，说明文本框渲染完了。</p>
<p><strong>下面要实现的就是属性的添加了</strong></p>
<p>当用户在文本框中输入了值以后，按下回车键或者让文本框失去焦点，就需要将用户在文本框中输入的内容发送到服务端，来完成对应的属性信息的添加操作。</p>
<p>下面需要修改<code>handleInputConfirm</code>方法，</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 文本框失去焦点，或摁下了 Enter 都会触发</span></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">handleInputConfirm</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">   <span class="comment">// console.log(row);</span></span><br><span class="line">   <span class="keyword">if</span> (row.inputValue.trim().length === <span class="number">0</span>) &#123;</span><br><span class="line">     row.inputValue = <span class="string">&quot;&quot;</span>;</span><br><span class="line">     row.inputVisible = <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 如果没有return，则证明输入的内容，需要做后续处理</span></span><br><span class="line">   row.attr_vals.push(row.inputValue.trim());</span><br><span class="line">   row.inputValue = <span class="string">&quot;&quot;</span>;<span class="comment">//清空文本框中的内容</span></span><br><span class="line">   row.inputVisible = <span class="literal">false</span>; <span class="comment">//隐藏文本框。</span></span><br><span class="line">   <span class="comment">// 需要发起请求，保存这次操作</span></span><br><span class="line">   <span class="built_in">this</span>.saveAttrVals(row);</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="comment">// 将对 attr_vals 的操作，保存到数据库</span></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="title">saveAttrVals</span>(<span class="params">row</span>)</span> &#123;</span><br><span class="line">   <span class="comment">// 需要发起请求，保存这次操作</span></span><br><span class="line">   <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.put(</span><br><span class="line">     <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes/<span class="subst">$&#123;row.attr_id&#125;</span>`</span>,</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">attr_name</span>: row.attr_name,</span><br><span class="line">       <span class="attr">attr_sel</span>: row.attr_sel,</span><br><span class="line">         <span class="comment">//row.attr_vals是一个数组，而服务端需要的是一个以空格进行分隔的字符串。</span></span><br><span class="line">       <span class="attr">attr_vals</span>: row.attr_vals.join(<span class="string">&quot; &quot;</span>),</span><br><span class="line">     &#125;</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;修改参数项失败！&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">this</span>.$message.success(<span class="string">&quot;修改参数项成功！&quot;</span>);</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>在<code>handleInputConfirm</code>方法中，首先判断一下<code>inputValue</code>中去掉空格以后的长度是否为0，如果为零，说明用户没有输入任何内容或者是输入了很多的空格，</p>
<p>这时清空内容将，文本框隐藏。</p>
<p>如果输入了内容后，将输入的内容清除空格，然后添加到<code>attr_vals</code>数组中，该数组中存储的就是属性信息。然后将文本框中的内容清空，同时隐藏文本框。</p>
<p>下面调用<code>saveAttrVals</code>方法，将内容发送到服务端，保存到数据库中.</p>
<h2 id="13、删除参数"><a href="#13、删除参数" class="headerlink" title="13、删除参数"></a>13、删除参数</h2><p>给属性所在的<code>el-tag</code> 标签添加删除事件。</p>
<p>我们知道，给<code>el-tag</code>标签添加了<code> closable</code>属性以后，在有上角会出现，叉号，而点击<code>叉号</code>就会触发<code>close</code>事件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tag</span><br><span class="line">                  v-for=&quot;(item, i) in scope.row.attr_vals&quot;</span><br><span class="line">                  :key=&quot;i&quot;</span><br><span class="line">                  closable</span><br><span class="line">                  @close=&quot;handleClose(i, scope.row)&quot;</span><br><span class="line">                &gt;&#123;&#123;item&#125;&#125;&lt;/el-tag&gt;</span><br></pre></td></tr></table></figure>

<p>对应的<code>handleClose</code>方法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除对应的参数可选项</span></span><br><span class="line"><span class="function"><span class="title">handleClose</span>(<span class="params">i, row</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//移除指定的内容。</span></span><br><span class="line">  row.attr_vals.splice(i, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">this</span>.saveAttrVals(row);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="十一、商品列表"><a href="#十一、商品列表" class="headerlink" title="十一、商品列表"></a>十一、商品列表</h1><h2 id="1、商品数据展示"><a href="#1、商品数据展示" class="headerlink" title="1、商品数据展示"></a>1、商品数据展示</h2><p>在<code>components</code>目录下的<code>goods</code>目录下创建<code>List.vue</code>文件，实现整体的结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品列表&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 卡片视图区域 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">        &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">          &lt;el-input placeholder=&quot;请输入内容&quot; v-model=&quot;queryInfo.query&quot; clearable @clear=&quot;getGoodsList&quot;&gt;</span><br><span class="line">            &lt;el-button slot=&quot;append&quot; icon=&quot;el-icon-search&quot; @click=&quot;getGoodsList&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-input&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">        &lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;goAddpage&quot;&gt;添加商品&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- table表格区域 --&gt;</span><br><span class="line">      &lt;el-table :data=&quot;goodslist&quot; border stripe&gt;</span><br><span class="line">        &lt;el-table-column type=&quot;index&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;商品名称&quot; prop=&quot;goods_name&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;商品价格(元)&quot; prop=&quot;goods_price&quot; width=&quot;95px&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;商品重量&quot; prop=&quot;goods_weight&quot; width=&quot;70px&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;创建时间&quot; prop=&quot;add_time&quot; width=&quot;140px&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;&#123;&#123;scope.row.add_time | dateFormat&#125;&#125;&lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;操作&quot; width=&quot;130px&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">            &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; size=&quot;mini&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">              type=&quot;danger&quot;</span><br><span class="line">              icon=&quot;el-icon-delete&quot;</span><br><span class="line">              size=&quot;mini&quot;</span><br><span class="line">              @click=&quot;removeById(scope.row.goods_id)&quot;</span><br><span class="line">            &gt;&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">      &lt;!-- 分页区域 --&gt;</span><br><span class="line">      &lt;el-pagination</span><br><span class="line">        @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">        @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">        :current-page=&quot;queryInfo.pagenum&quot;</span><br><span class="line">        :page-sizes=&quot;[5, 10, 15, 20]&quot;</span><br><span class="line">        :page-size=&quot;queryInfo.pagesize&quot;</span><br><span class="line">        layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">        :total=&quot;total&quot;</span><br><span class="line">        background</span><br><span class="line">      &gt;&lt;/el-pagination&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 查询参数对象</span><br><span class="line">      queryInfo: &#123;</span><br><span class="line">        query: &quot;&quot;,</span><br><span class="line">        pagenum: 1,</span><br><span class="line">        pagesize: 10,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 商品列表</span><br><span class="line">      goodslist: [],</span><br><span class="line">      // 总数据条数</span><br><span class="line">      total: 0,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getGoodsList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 根据分页获取对应的商品列表</span><br><span class="line">    async getGoodsList() &#123;</span><br><span class="line">      const &#123; data: res &#125; = await this.$http.get(&quot;goods&quot;, &#123;</span><br><span class="line">        params: this.queryInfo,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      if (res.meta.status !== 200) &#123;</span><br><span class="line">        return this.$message.error(&quot;获取商品列表失败！&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.$message.success(&quot;获取商品列表成功！&quot;);</span><br><span class="line">      console.log(res.data);</span><br><span class="line">      this.goodslist = res.data.goods;</span><br><span class="line">      this.total = res.data.total;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(newSize) &#123;</span><br><span class="line">      this.queryInfo.pagesize = newSize;</span><br><span class="line">      this.getGoodsList();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(newPage) &#123;</span><br><span class="line">      this.queryInfo.pagenum = newPage;</span><br><span class="line">      this.getGoodsList();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>路由设置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Rights <span class="keyword">from</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Roles <span class="keyword">from</span> <span class="string">&quot;./components/power/Roles.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cate <span class="keyword">from</span> <span class="string">&quot;./components/goods/Cate.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Params <span class="keyword">from</span> <span class="string">&quot;./components/goods/Params.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> GoodsList <span class="keyword">from</span> <span class="string">&quot;./components/goods/List.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/roles&quot;</span>, <span class="attr">component</span>: Roles &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/categories&quot;</span>, <span class="attr">component</span>: Cate &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/params&quot;</span>, <span class="attr">component</span>: Params &#125;,</span><br><span class="line">          <span class="comment">//商品列表</span></span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/goods&quot;</span>, <span class="attr">component</span>: GoodsList &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="2、全局过滤器的创建"><a href="#2、全局过滤器的创建" class="headerlink" title="2、全局过滤器的创建"></a>2、全局过滤器的创建</h2><p>在<code>main.js</code>文件中创建全局的过滤器，对时间进行处理。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.filter(<span class="string">&quot;dateFormat&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">originVal</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dt = <span class="keyword">new</span> <span class="built_in">Date</span>(originVal);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> y = dt.getFullYear();</span><br><span class="line">  <span class="keyword">const</span> m = (dt.getMonth() + <span class="number">1</span> + <span class="string">&quot;&quot;</span>).padStart(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> d = (dt.getDate() + <span class="string">&quot;&quot;</span>).padStart(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> hh = (dt.getHours() + <span class="string">&quot;&quot;</span>).padStart(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> mm = (dt.getMinutes() + <span class="string">&quot;&quot;</span>).padStart(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> ss = (dt.getSeconds() + <span class="string">&quot;&quot;</span>).padStart(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;y&#125;</span>-<span class="subst">$&#123;m&#125;</span>-<span class="subst">$&#123;d&#125;</span> <span class="subst">$&#123;hh&#125;</span>:<span class="subst">$&#123;mm&#125;</span>:<span class="subst">$&#123;ss&#125;</span>`</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在表格的作用域插槽中，获取时间数据，然后使用上面的过滤器，进行时间日期的过滤。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;创建时间&quot; prop=&quot;add_time&quot; width=&quot;140px&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;&#123;&#123;scope.row.add_time | dateFormat&#125;&#125;&lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3、删除商品信息"><a href="#3、删除商品信息" class="headerlink" title="3、删除商品信息"></a>3、删除商品信息</h2><p>具体的删除操作如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">removeById</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> confirmResult = <span class="keyword">await</span> <span class="built_in">this</span>.$confirm(</span><br><span class="line">      <span class="string">&#x27;此操作将永久删除该商品, 是否继续?&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ).catch(<span class="function"><span class="params">err</span> =&gt;</span> err)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (confirmResult !== <span class="string">&#x27;confirm&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.$message.info(<span class="string">&#x27;已经取消删除！&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.delete(<span class="string">`goods/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&#x27;删除失败！&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.$message.success(<span class="string">&#x27;删除成功！&#x27;</span>)</span><br><span class="line">    <span class="built_in">this</span>.getGoodsList()</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>单击表格中的删除按钮的时候，调用上面的方法。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button type=&quot;danger&quot; icon=&quot;el-icon-delete&quot; size=&quot;mini&quot; @click=&quot;removeById(scope.row.goods_id)&quot;&gt;&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<h1 id="十二、商品添加"><a href="#十二、商品添加" class="headerlink" title="十二、商品添加"></a>十二、商品添加</h1><h2 id="1、商品添加页面构建"><a href="#1、商品添加页面构建" class="headerlink" title="1、商品添加页面构建"></a>1、商品添加页面构建</h2><p>当单击商品列表页面中的“添加商品”按钮，会跳转到商品添加页面。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-col :span=&quot;4&quot;&gt;</span><br><span class="line">       &lt;el-button type=&quot;primary&quot; @click=&quot;goAddpage&quot;&gt;添加商品&lt;/el-button&gt;</span><br><span class="line">     &lt;/el-col&gt;</span><br></pre></td></tr></table></figure>

<p><code>goAddpage</code>方法实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">goAddpage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$router.push(<span class="string">&quot;/goods/add&quot;</span>);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>路由设置如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Rights <span class="keyword">from</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Roles <span class="keyword">from</span> <span class="string">&quot;./components/power/Roles.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cate <span class="keyword">from</span> <span class="string">&quot;./components/goods/Cate.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Params <span class="keyword">from</span> <span class="string">&quot;./components/goods/Params.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> GoodsList <span class="keyword">from</span> <span class="string">&quot;./components/goods/List.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Add <span class="keyword">from</span> <span class="string">&quot;./components/goods/Add.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/roles&quot;</span>, <span class="attr">component</span>: Roles &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/categories&quot;</span>, <span class="attr">component</span>: Cate &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/params&quot;</span>, <span class="attr">component</span>: Params &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/goods&quot;</span>, <span class="attr">component</span>: GoodsList &#125;,</span><br><span class="line">          <span class="comment">//添加商品</span></span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/goods/add&quot;</span>, <span class="attr">component</span>: Add &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在<code>component</code>目录下的<code>goods</code>目录下面创建<code>Add.vue</code>这个组件，基本的布局如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;添加商品&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line">    &lt;!-- 卡片视图 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;!-- 提示区域 --&gt;</span><br><span class="line">      &lt;el-alert title=&quot;添加商品信息&quot; type=&quot;info&quot; center show-icon :closable=&quot;false&quot;&gt;&lt;/el-alert&gt;</span><br><span class="line">      &lt;!-- 步骤条区域 --&gt;</span><br><span class="line">      &lt;el-steps :space=&quot;200&quot; :active=&quot;activeIndex&quot; finish-status=&quot;success&quot; align-center&gt;</span><br><span class="line">        &lt;el-step title=&quot;基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品参数&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品属性&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品图片&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品内容&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- tab栏区域 --&gt;</span><br><span class="line">      &lt;el-tabs :tab-position=&quot;&#x27;left&#x27;&quot; style=&quot;height:200px&quot;&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;基本信息&quot;&gt;基本信息&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;商品参数&quot;&gt;商品参数&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;商品属性&quot;&gt;商品属性&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;商品图片&quot;&gt;商品图片&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;商品内容&quot;&gt;商品内容&lt;/el-tab-pane&gt;</span><br><span class="line">      &lt;/el-tabs&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      activeIndex: 0,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在<code>element.js</code>文件中完成对步骤组件的注册。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vue.use(Steps);</span><br><span class="line">Vue.use(Step);</span><br></pre></td></tr></table></figure>



<p>下面要实现的是单击<code>tab</code>栏，对应的步骤条也发生改变，也就是实现<code>tab</code>栏与步骤条之间的联动效果。</p>
<p>首先给<code>tabs</code>栏添加<code>v-model</code>属性，该属性绑定的值为<code>activeIndex</code>,这样当我们选择<code>tabs</code>中的不同的项的时候对应的<code>name</code>属性的值会赋值给<code>activeIndex</code>这个<code>data</code>属性。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- tab栏区域 --&gt;</span><br><span class="line">     &lt;el-tabs :tab-position=&quot;&#x27;left&#x27;&quot; style=&quot;height:200px&quot; v-model=&quot;activeIndex&quot;&gt;</span><br><span class="line">       &lt;el-tab-pane label=&quot;基本信息&quot; name=&quot;0&quot;&gt;基本信息&lt;/el-tab-pane&gt;</span><br><span class="line">       &lt;el-tab-pane label=&quot;商品参数&quot; name=&quot;1&quot;&gt;商品参数&lt;/el-tab-pane&gt;</span><br><span class="line">       &lt;el-tab-pane label=&quot;商品属性&quot; name=&quot;2&quot;&gt;商品属性&lt;/el-tab-pane&gt;</span><br><span class="line">       &lt;el-tab-pane label=&quot;商品图片&quot; name=&quot;3&quot;&gt;商品图片&lt;/el-tab-pane&gt;</span><br><span class="line">       &lt;el-tab-pane label=&quot;商品内容&quot; name=&quot;4&quot;&gt;商品内容&lt;/el-tab-pane&gt;</span><br><span class="line">     &lt;/el-tabs&gt;</span><br></pre></td></tr></table></figure>

<p>下面看一下步骤条的更改</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-steps :space=&quot;200&quot; :active=&quot;activeIndex-0&quot; finish-status=&quot;success&quot; align-center&gt;</span><br></pre></td></tr></table></figure>

<p>当选择步骤条中的某一项时，对应的<code>activeIndex</code>中存储的就是这一项的一个编号（从0开始计算）。</p>
<p>这时我们可以看到步骤条与导航条共享了<code>activeIndex</code>这个状态属性。</p>
<p>但是要注意的就是步骤条中需要的<code>activeIndex</code>是一个数字，所以这里可以减去0，通过这种方式来转换成数字。</p>
<p>而导航条中使用的<code>activeIndex</code>属性的值为字符串。</p>
<h2 id="2、基本表单实现"><a href="#2、基本表单实现" class="headerlink" title="2、基本表单实现"></a>2、基本表单实现</h2><p>在这里，我们将表单的内容都分发到不同的页签下面。</p>
<p>首先构建的是第一个页签“基本信息”的表单。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;商品管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;添加商品&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line">    &lt;!-- 卡片视图 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;!-- 提示区域 --&gt;</span><br><span class="line">      &lt;el-alert title=&quot;添加商品信息&quot; type=&quot;info&quot; center show-icon :closable=&quot;false&quot;&gt;&lt;/el-alert&gt;</span><br><span class="line">      &lt;!-- 步骤条区域 --&gt;</span><br><span class="line">      &lt;el-steps :space=&quot;200&quot; :active=&quot;activeIndex-0&quot; finish-status=&quot;success&quot; align-center&gt;</span><br><span class="line">        &lt;el-step title=&quot;基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品参数&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品属性&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品图片&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;商品内容&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">        &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;/el-steps&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- tab栏区域 添加了一个表单 --&gt;</span><br><span class="line">      &lt;el-form</span><br><span class="line">        :model=&quot;addForm&quot;</span><br><span class="line">        :rules=&quot;addFormRules&quot;</span><br><span class="line">        ref=&quot;addFormRef&quot;</span><br><span class="line">        label-width=&quot;100px&quot;</span><br><span class="line">        label-position=&quot;top&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-tabs :tab-position=&quot;&#x27;left&#x27;&quot; v-model=&quot;activeIndex&quot;&gt;</span><br><span class="line">          &lt;el-tab-pane label=&quot;基本信息&quot; name=&quot;0&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;商品名称&quot; prop=&quot;goods_name&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;addForm.goods_name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;商品价格&quot; prop=&quot;goods_price&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;addForm.goods_price&quot; type=&quot;number&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;商品重量&quot; prop=&quot;goods_weight&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;addForm.goods_weight&quot; type=&quot;number&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;商品数量&quot; prop=&quot;goods_number&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;addForm.goods_number&quot; type=&quot;number&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;商品分类&quot; prop=&quot;goods_cat&quot;&gt;</span><br><span class="line">              &lt;el-cascader</span><br><span class="line">                expand-trigger=&quot;hover&quot;</span><br><span class="line">                :options=&quot;catelist&quot;</span><br><span class="line">                :props=&quot;cateProps&quot;</span><br><span class="line">                v-model=&quot;addForm.goods_cat&quot;</span><br><span class="line">                @change=&quot;handleChange&quot;</span><br><span class="line">              &gt;&lt;/el-cascader&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-tab-pane&gt;</span><br><span class="line">          &lt;el-tab-pane label=&quot;商品参数&quot; name=&quot;1&quot;&gt;商品参数&lt;/el-tab-pane&gt;</span><br><span class="line">          &lt;el-tab-pane label=&quot;商品属性&quot; name=&quot;2&quot;&gt;商品属性&lt;/el-tab-pane&gt;</span><br><span class="line">          &lt;el-tab-pane label=&quot;商品图片&quot; name=&quot;3&quot;&gt;商品图片&lt;/el-tab-pane&gt;</span><br><span class="line">          &lt;el-tab-pane label=&quot;商品内容&quot; name=&quot;4&quot;&gt;商品内容&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;/el-tabs&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      activeIndex: 0,</span><br><span class="line">      // 添加商品的表单数据对象</span><br><span class="line">      addForm: &#123;</span><br><span class="line">        goods_name: &quot;&quot;,</span><br><span class="line">        goods_price: 0,</span><br><span class="line">        goods_weight: 0,</span><br><span class="line">        goods_number: 0,</span><br><span class="line">        // 商品所属的分类数组</span><br><span class="line">        goods_cat: [],</span><br><span class="line">      &#125;,</span><br><span class="line">      addFormRules: &#123;</span><br><span class="line">        goods_name: [</span><br><span class="line">          &#123; required: true, message: &quot;请输入商品名称&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">        ],</span><br><span class="line">        goods_price: [</span><br><span class="line">          &#123; required: true, message: &quot;请输入商品价格&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">        ],</span><br><span class="line">        goods_weight: [</span><br><span class="line">          &#123; required: true, message: &quot;请输入商品重量&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">        ],</span><br><span class="line">        goods_number: [</span><br><span class="line">          &#123; required: true, message: &quot;请输入商品数量&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">        ],</span><br><span class="line">        goods_cat: [</span><br><span class="line">          &#123; required: true, message: &quot;请选择商品分类&quot;, trigger: &quot;blur&quot; &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      // 商品分类列表</span><br><span class="line">      catelist: [],</span><br><span class="line">      cateProps: &#123;</span><br><span class="line">        label: &quot;cat_name&quot;,</span><br><span class="line">        value: &quot;cat_id&quot;,</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getCateList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取所有商品分类数据</span><br><span class="line">    async getCateList() &#123;</span><br><span class="line">      const &#123; data: res &#125; = await this.$http.get(&quot;categories&quot;);</span><br><span class="line"></span><br><span class="line">      if (res.meta.status !== 200) &#123;</span><br><span class="line">        return this.$message.error(&quot;获取商品分类数据失败！&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      this.catelist = res.data;</span><br><span class="line">      console.log(this.catelist);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 级联选择器选中项变化，会触发这个函数</span><br><span class="line">    handleChange() &#123;</span><br><span class="line">      console.log(this.addForm.goods_cat);</span><br><span class="line">      if (this.addForm.goods_cat.length !== 3) &#123;</span><br><span class="line">        this.addForm.goods_cat = [];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，最主要的就是使用”表单”把整个<code>tabs</code>给包裹起来了，同时在“基本信息”这一个选项中，构建了基本的表单元素。</p>
<h2 id="3、阻止标签页切换"><a href="#3、阻止标签页切换" class="headerlink" title="3、阻止标签页切换"></a>3、阻止标签页切换</h2><p>如果用户在访问“基本信息”这一个页签中的内容时候，如果没有选择下拉菜单中的商品分类，并且是没有选择三级分类，然后又去点击其它的页签内容，这时应该给出相应的提示，禁止切换。</p>
<p>这里主要是使用了<code>before-leave</code>这个事件，该事件的触发是在切换页签的时候发生。我们可以在该事件对应的处理函数中，做相应的判断，判断是否选择了下拉框中的商品类别。如果没有，则禁止浏览其它页签。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">:tab-position</span>=<span class="string">&quot;&#x27;left&#x27;&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;activeIndex&quot;</span> <span class="attr">:before-leave</span>=<span class="string">&quot;beforeTabLeave&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>beforeTabLeave</code>方法的实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">beforeTabLeave</span>(<span class="params">activeName, oldActiveName</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;即将离开的标签页名字是：&#x27; + oldActiveName)</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;即将进入的标签页名字是：&#x27; + activeName)</span></span><br><span class="line">    <span class="comment">// return false</span></span><br><span class="line">    <span class="comment">//如果现在访问的是第一个页签（基本信息），并且没有选择三级类别，禁止访问其它的内容。</span></span><br><span class="line">    <span class="keyword">if</span> (oldActiveName === <span class="string">&quot;0&quot;</span> &amp;&amp; <span class="built_in">this</span>.addForm.goods_cat.length !== <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.$message.error(<span class="string">&quot;请先选择商品分类！&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="4、获取动态参数列表数据"><a href="#4、获取动态参数列表数据" class="headerlink" title="4、获取动态参数列表数据"></a>4、获取动态参数列表数据</h2><p>当用户单击“商品参数”这个页签的时候，要获取对应的动态参数。</p>
<p>这时给<code>el-tabs</code>页签，添加<code>tab-click</code>事件，该事件是在单击页签的时候触发，在其对应的函数中，根据在“基本信息”这个页签中，选择的三级商品类别的编号来查询出对应的动态参数。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">v-model</span>=<span class="string">&quot;activeIndex&quot;</span> <span class="attr">:tab-position</span>=<span class="string">&quot;&#x27;left&#x27;&quot;</span> <span class="attr">:before-leave</span>=<span class="string">&quot;beforeTabLeave&quot;</span> @<span class="attr">tab-click</span>=<span class="string">&quot;tabClicked&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码中，给<code>el-tabs</code>组件添加<code>tab-click</code>事件。</p>
<p><code>tabClicked</code>对应的处理函数如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">tabClicked</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="comment">// console.log(this.activeIndex)</span></span><br><span class="line">     <span class="comment">// 证明访问的是动态参数面板,cateId类别编号，可以通过计算属性获取。</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.activeIndex === <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">       <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(</span><br><span class="line">         <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes`</span>,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">params</span>: &#123; <span class="attr">sel</span>: <span class="string">&quot;many&quot;</span> &#125;,</span><br><span class="line">         &#125;</span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取动态参数列表失败！&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="built_in">console</span>.log(res.data);</span><br><span class="line"></span><br><span class="line">       <span class="built_in">this</span>.manyTableData = res.data;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>计算属性如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">   <span class="function"><span class="title">cateId</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="comment">//条件成立表明选择了三级类别。</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.addForm.goods_cat.length === <span class="number">3</span>) &#123;</span><br><span class="line">       <span class="comment">//获取最后一个类别编号</span></span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">this</span>.addForm.goods_cat[<span class="number">2</span>];</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>



<p><strong>现在已经将动态数据查询出来了，下面需要将其渲染到页面中。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tab-pane label=&quot;商品参数&quot; name=&quot;1&quot;&gt;</span><br><span class="line">            &lt;!-- 渲染表单的Item项 --&gt;</span><br><span class="line">            &lt;el-form-item :label=&quot;item.attr_name&quot; v-for=&quot;item in manyTableData&quot; :key=&quot;item.attr_id&quot;&gt;</span><br><span class="line">              &lt;!-- 复选框组 --&gt;</span><br><span class="line">              &lt;el-checkbox-group v-model=&quot;item.attr_vals&quot;&gt;</span><br><span class="line">                &lt;el-checkbox :label=&quot;cb&quot; v-for=&quot;(cb, i) in item.attr_vals&quot; :key=&quot;i&quot; border&gt;&lt;/el-checkbox&gt;</span><br><span class="line">              &lt;/el-checkbox-group&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-tab-pane&gt;</span><br></pre></td></tr></table></figure>

<p>在“商品参数”这个页签中，展示出对应的动态参数，我们知道每个参数名称前面都会有一个复选框，所以这里需要构建一个表单的项<code>el-form-item</code>.</p>
<p>然后对<code>manyTableData</code>中存储的动态数据进行循环遍历，遍历的就是复选框,复选框在<code>el-checkbox-group</code>中就是一组，而且该标签需要一个<code>v-model</code>进行双向数据绑定，绑定的类型必须是一个数组。</p>
<p>对<code>el-form-item</code>循环，展示的是属性名称（例如颜色），对复选框进行换行展示的就是动态参数（例如，红色，黑色等）。</p>
<p>在什么时候将<code>attr_vals</code>转换成数组呢？</p>
<p>在<code>tabClicked</code>方法中，将<code>attr_vals</code>转换成数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">tabClicked</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(this.activeIndex)</span></span><br><span class="line">    <span class="comment">// 证明访问的是动态参数面板,cateId类别编号，可以通过计算属性获取。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.activeIndex === <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(</span><br><span class="line">        <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes`</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">params</span>: &#123; <span class="attr">sel</span>: <span class="string">&quot;many&quot;</span> &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取动态参数列表失败！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;aaaa=&quot;</span>, res.data);</span><br><span class="line">      <span class="comment">//将attr_vals内容转换成数组</span></span><br><span class="line">      res.data.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        item.attr_vals =</span><br><span class="line">          item.attr_vals.length === <span class="number">0</span> ? [] : item.attr_vals.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">this</span>.manyTableData = res.data;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="5、获取静态属性"><a href="#5、获取静态属性" class="headerlink" title="5、获取静态属性"></a>5、获取静态属性</h2><p>这里我们主要实现的就是商品属性这个页签中数据的展示操作。</p>
<p>这里是将静态属性的内容填充到表单中。</p>
<p>在第4小节的课程中，我们获取的是动态参数列表。</p>
<p>在获取动态参数的时候，在<code>tabClicked</code> 方法中我们是判断<code>this.activeIndex</code>的取值是否为1，如果为1，表示的是用户选择了“商品参数”这个页签，如果<code>this.activeIndex</code> 的取值为2，表示的是用户选择了“商品属性”这个标签。</p>
<p>这需要获取对应的静态属性数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">tabClicked</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="comment">// console.log(this.activeIndex)</span></span><br><span class="line">     <span class="comment">// 证明访问的是动态参数面板,cateId类别编号，可以通过计算属性获取。</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">this</span>.activeIndex === <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">       <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(</span><br><span class="line">         <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes`</span>,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">params</span>: &#123; <span class="attr">sel</span>: <span class="string">&quot;many&quot;</span> &#125;,</span><br><span class="line">         &#125;</span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取动态参数列表失败！&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&quot;aaaa=&quot;</span>, res.data);</span><br><span class="line">       <span class="comment">//将attr_vals内容转换成数组</span></span><br><span class="line">       res.data.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">         item.attr_vals =</span><br><span class="line">           item.attr_vals.length === <span class="number">0</span> ? [] : item.attr_vals.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="built_in">this</span>.manyTableData = res.data;</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.activeIndex === <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">         <span class="comment">//获取静态属性</span></span><br><span class="line">       <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.get(</span><br><span class="line">         <span class="string">`categories/<span class="subst">$&#123;<span class="built_in">this</span>.cateId&#125;</span>/attributes`</span>,</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">params</span>: &#123; <span class="attr">sel</span>: <span class="string">&quot;only&quot;</span> &#125;,</span><br><span class="line">         &#125;</span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (res.meta.status !== <span class="number">200</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;获取静态属性失败！&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="built_in">console</span>.log(res.data);</span><br><span class="line">       <span class="built_in">this</span>.onlyTableData = res.data;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>在上面的代码中将获取到的静态属性数据赋值给了<code>onlyTableData</code>这个状态属性。</p>
<p>下面将该属性中的内容渲染到页面中就可以了。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">label</span>=<span class="string">&quot;商品属性&quot;</span> <span class="attr">name</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">:label</span>=<span class="string">&quot;item.attr_name&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;item in onlyTableData&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.attr_id&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;item.attr_vals&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里的<code>attr_vals</code>不需要为数组。</p>
<h2 id="6、图片上传"><a href="#6、图片上传" class="headerlink" title="6、图片上传"></a>6、图片上传</h2><p>在商品图片这一个页签中，主要的就是实现图片的上传功能。</p>
<p>下面看一下具体的实现过程</p>
<p>这里使用的<code>Upload</code>组件来实现文件上传。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tab-pane label=&quot;商品图片&quot; name=&quot;3&quot;&gt;</span><br><span class="line">          &lt;!-- action 表示图片要上传到的后台API地址 --&gt;</span><br><span class="line">          &lt;el-upload</span><br><span class="line">            :action=&quot;uploadURL&quot;</span><br><span class="line">            :on-preview=&quot;handlePreview&quot;</span><br><span class="line">            :on-remove=&quot;handleRemove&quot;</span><br><span class="line">            list-type=&quot;picture&quot;</span><br><span class="line">            :headers=&quot;headerObj&quot;</span><br><span class="line">            :on-success=&quot;handleSuccess&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;el-button size=&quot;small&quot; type=&quot;primary&quot;&gt;点击上传&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-upload&gt;</span><br><span class="line">        &lt;/el-tab-pane&gt;</span><br></pre></td></tr></table></figure>

<p><code>on-preview</code>表示的是处理图片预览效果</p>
<p><code>on-remove</code>表示的是处理移除图片的操作</p>
<p><code>list-type</code>:表示的上传组件展示的效果</p>
<p><code>headers</code>: 图片上传组件的headers请求头对象,这里非常关键，完成<code>API</code>权限校验</p>
<p><code>on-success</code>:图片上传成功后的处理。</p>
<p>对应的<code>data</code>中属性的定义</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 上传图片的URL地址</span></span><br><span class="line">     <span class="attr">uploadURL</span>: <span class="string">&#x27;http://127.0.0.1:8888/api/private/v1/upload&#x27;</span>,</span><br><span class="line">     <span class="comment">// 图片上传组件的headers请求头对象</span></span><br><span class="line">     <span class="attr">headerObj</span>: &#123;</span><br><span class="line">       <span class="attr">Authorization</span>: <span class="built_in">window</span>.sessionStorage.getItem(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>

<p>对应的方法处理</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理图片预览效果</span></span><br><span class="line">  <span class="function"><span class="title">handlePreview</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">  <span class="comment">// 处理移除图片的操作</span></span><br><span class="line">  <span class="function"><span class="title">handleRemove</span>(<span class="params"></span>)</span> &#123;&#125;,</span><br><span class="line">  <span class="comment">// 监听图片上传成功的事件</span></span><br><span class="line">  <span class="function"><span class="title">handleSuccess</span>(<span class="params">response</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">    <span class="comment">// 1. 拼接得到一个图片信息对象</span></span><br><span class="line">    <span class="keyword">const</span> picInfo = &#123; <span class="attr">pic</span>: response.data.tmp_path &#125;;</span><br><span class="line">    <span class="comment">// 2. 将图片信息对象，push 到pics数组中</span></span><br><span class="line">    <span class="built_in">this</span>.addForm.pics.push(picInfo);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.addForm);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>上传成功后，我们要获取服务端返回的图片的路径，将其存储到一个数组<code>pics</code>中（存储的元素格式为对象，具体格式参考API文档），最后提交表单的时候会发送到服务端。而发送服务端的内容不仅包含了上传成功的图片路径，还有前面表单中输入的数据，表单已经与<code>addForm</code>属性绑定了，所以这里可以将<code>pics</code>数组也添加到<code>addForm</code>这个表单中，最后将<code>addForm</code>中的内容发送到服务端就可以了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加商品的表单数据对象</span></span><br><span class="line">     <span class="attr">addForm</span>: &#123;</span><br><span class="line">       <span class="attr">goods_name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">       <span class="attr">goods_price</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="attr">goods_weight</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="attr">goods_number</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="comment">// 商品所属的分类数组</span></span><br><span class="line">       <span class="attr">goods_cat</span>: [],</span><br><span class="line">       <span class="comment">// 图片的数组</span></span><br><span class="line">       <span class="attr">pics</span>: [],</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="7、图片删除"><a href="#7、图片删除" class="headerlink" title="7、图片删除"></a>7、图片删除</h2><p>可以删除图片。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理移除图片的操作</span></span><br><span class="line">    <span class="function"><span class="title">handleRemove</span>(<span class="params">file</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(file)</span></span><br><span class="line">      <span class="comment">// 1. 获取将要删除的图片的临时路径</span></span><br><span class="line">      <span class="keyword">const</span> filePath = file.response.data.tmp_path;</span><br><span class="line">      <span class="comment">// 2. 从 pics 数组中，找到这个图片对应的索引值</span></span><br><span class="line">      <span class="keyword">const</span> i = <span class="built_in">this</span>.addForm.pics.findIndex(<span class="function">(<span class="params">x</span>) =&gt;</span> x.pic === filePath);</span><br><span class="line">      <span class="comment">// 3. 调用数组的 splice 方法，把图片信息对象，从 pics 数组中移除</span></span><br><span class="line">      <span class="built_in">this</span>.addForm.pics.splice(i, <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.addForm);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="8、图片预览"><a href="#8、图片预览" class="headerlink" title="8、图片预览"></a>8、图片预览</h2><p>当单击图片的名称的时候，可以实现图片预览的效果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理图片预览效果</span></span><br><span class="line">  <span class="function"><span class="title">handlePreview</span>(<span class="params">file</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(file);</span><br><span class="line">    <span class="built_in">this</span>.previewPath = file.response.data.url;</span><br><span class="line">    <span class="built_in">this</span>.previewVisible = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>将服务端返回的绝对路径给<code>previewPath</code>属性，同时让窗口打开，把<code>previewVisible</code>属性设置为<code>true</code>.</p>
<p>属性定义</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">previewPath: &quot;&quot;,</span><br><span class="line">    previewVisible: false,</span><br></pre></td></tr></table></figure>

<p>窗口的定义</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 图片预览 --&gt;</span><br><span class="line"> &lt;el-dialog title=&quot;图片预览&quot; :visible.sync=&quot;previewVisible&quot; width=&quot;50%&quot;&gt;</span><br><span class="line">   &lt;img :src=&quot;previewPath&quot; alt class=&quot;previewImg&quot; /&gt;</span><br><span class="line"> &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<h2 id="9、富文本编辑器使用"><a href="#9、富文本编辑器使用" class="headerlink" title="9、富文本编辑器使用"></a>9、富文本编辑器使用</h2><p>首先安装富文本编辑器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install vue-quill-editor --save</span><br></pre></td></tr></table></figure>

<p>下面可以进行全局配置。</p>
<p>在<code>main.js</code>文件中注册组件，并导入相应的样式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入富文本编辑器</span></span><br><span class="line"><span class="keyword">import</span> VueQuillEditor <span class="keyword">from</span> <span class="string">&quot;vue-quill-editor&quot;</span>;</span><br><span class="line"><span class="comment">// require styles 导入富文本编辑器对应的样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;quill/dist/quill.core.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;quill/dist/quill.snow.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;quill/dist/quill.bubble.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将富文本编辑器，注册为全局可用的组件</span></span><br><span class="line">Vue.use(VueQuillEditor);</span><br></pre></td></tr></table></figure>

<p>下面具体使用富文本编辑器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-tab-pane label=&quot;商品内容&quot; name=&quot;4&quot;&gt;</span><br><span class="line">     &lt;!-- 富文本编辑器组件 --&gt;</span><br><span class="line">     &lt;quill-editor v-model=&quot;addForm.goods_introduce&quot;&gt;&lt;/quill-editor&gt;</span><br><span class="line">     &lt;!-- 添加商品的按钮 --&gt;</span><br><span class="line">     &lt;el-button type=&quot;primary&quot; class=&quot;btnAdd&quot; @click=&quot;add&quot;</span><br><span class="line">       &gt;添加商品&lt;/el-button</span><br><span class="line">     &gt;</span><br><span class="line">   &lt;/el-tab-pane&gt;</span><br></pre></td></tr></table></figure>



<p>在上面的代码中，将富文本编辑器与<code>addForm</code>中的<code>goods_introduce</code> 属性进行绑定，这样可以通过该属性获取用户在富文本编辑器中输入的内容。</p>
<p>同时在“商品内容”这个页签中添加了“添加商品”按钮，单击该按钮可以完成商品的添加。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">addForm: &#123;</span><br><span class="line">       <span class="attr">goods_name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">       <span class="attr">goods_price</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="attr">goods_weight</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="attr">goods_number</span>: <span class="number">0</span>,</span><br><span class="line">       <span class="comment">// 商品所属的分类数组</span></span><br><span class="line">       <span class="attr">goods_cat</span>: [],</span><br><span class="line">       <span class="comment">// 图片的数组</span></span><br><span class="line">       <span class="attr">pics</span>: [],</span><br><span class="line">       <span class="comment">// 商品的详情描述</span></span><br><span class="line">       <span class="attr">goods_introduce</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">     &#125;,</span><br></pre></td></tr></table></figure>

<p>在<code>global.css</code>文件中，定义样式来控制编辑器的高度。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.ql-editor &#123;</span><br><span class="line">  min-height: 300px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10、完成商品的添加"><a href="#10、完成商品的添加" class="headerlink" title="10、完成商品的添加"></a>10、完成商品的添加</h2><p>下面要处理的就是商品的添加。</p>
<p>当单击“添加商品”按钮的时候，会执行<code>add</code>方法，该方法的具体实现如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加商品</span></span><br><span class="line">    <span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.$refs.addFormRef.validate(<span class="keyword">async</span> (valid) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!valid) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;请填写必要的表单项！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 执行添加的业务逻辑</span></span><br><span class="line">        <span class="comment">// lodash   cloneDeep(obj)</span></span><br><span class="line">        <span class="keyword">const</span> form = _.cloneDeep(<span class="built_in">this</span>.addForm);</span><br><span class="line">        form.goods_cat = form.goods_cat.join(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">// 处理动态参数</span></span><br><span class="line">        <span class="built_in">this</span>.manyTableData.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> newInfo = &#123;</span><br><span class="line">            <span class="attr">attr_id</span>: item.attr_id,</span><br><span class="line">            <span class="attr">attr_value</span>: item.attr_vals.join(<span class="string">&quot; &quot;</span>),</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="built_in">this</span>.addForm.attrs.push(newInfo);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 处理静态属性</span></span><br><span class="line">        <span class="built_in">this</span>.onlyTableData.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> newInfo = &#123; <span class="attr">attr_id</span>: item.attr_id, <span class="attr">attr_value</span>: item.attr_vals &#125;;</span><br><span class="line">          <span class="built_in">this</span>.addForm.attrs.push(newInfo);</span><br><span class="line">        &#125;);</span><br><span class="line">        form.attrs = <span class="built_in">this</span>.addForm.attrs;</span><br><span class="line">        <span class="built_in">console</span>.log(form);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发起请求添加商品</span></span><br><span class="line">        <span class="comment">// 商品的名称，必须是唯一的</span></span><br><span class="line">        <span class="keyword">const</span> &#123; <span class="attr">data</span>: res &#125; = <span class="keyword">await</span> <span class="built_in">this</span>.$http.post(<span class="string">&quot;goods&quot;</span>, form);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (res.meta.status !== <span class="number">201</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">this</span>.$message.error(<span class="string">&quot;添加商品失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.$message.success(<span class="string">&quot;添加商品成功！&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.$router.push(<span class="string">&quot;/goods&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>在上面的代码中</p>
<p><strong>首先先完成表单的校验</strong></p>
<p>然后使用<code>lodash</code>中的<code>cloneDeep</code>方法对<code>addForm</code>这个对象进行了深拷贝。这里为什么会对<code>addForm</code>对象进行深拷贝呢？</p>
<p>因为在向服务端发送数据时，要求<code>goods_cat</code>中的内容必须是字符串（以逗号作为分隔），而该属性是数组。</p>
<p>那么如果采用如下的写法是否可以呢？</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">this.addForm.goods_cat=this.addForm.goods_cat.join(&#x27;,&#x27;)</span><br></pre></td></tr></table></figure>

<p>以上写法是不可以的，因为在向服务端发送的数据中，要求<code>goods_cat</code>是字符串，但是在<code>el-cascader</code>组件中使用<code>goods_cat</code> 必须为数组。</p>
<p>所以这里只能通过深拷贝重新拷贝出一个对象。最终将该对象（<code>form</code>）中的内容发送到服务端。</p>
<p><code>lodash</code>的安装如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i --save lodash</span><br></pre></td></tr></table></figure>

<p>安装好以后可以进行导入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import _ from &#x27;lodash&#x27;</span><br></pre></td></tr></table></figure>

<p>下面还需要注意的一点就是，根据文档的要求，动态参数与静态属性都要放到<code>addForm</code> 对象中的<code>attrs</code>这个数组中。</p>
<p>所以这里首先对<code>manyTableData</code>进行循环遍历，创建<code>newInfo</code>对象来组织数据，注意：<code>attr_value</code>需要的字符串，所以将<code>attr_vals</code>转换成了字符串。</p>
<p>对于静态属性处理的时候，<code>attr_vals</code>本身就是字符串，无序转换。</p>
<p>下面将处理好的<code>addForm</code>中的<code>attrs</code>中的数据赋值给拷贝对象中的<code>atrrs</code>, 最后将其发送到服务端。</p>
<p>在<code>addForm</code>中定义<code>attrs</code>数组</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加商品的表单数据对象</span></span><br><span class="line">      <span class="attr">addForm</span>: &#123;</span><br><span class="line">        <span class="attr">goods_name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">goods_price</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">goods_weight</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">goods_number</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// 商品所属的分类数组</span></span><br><span class="line">        <span class="attr">goods_cat</span>: [],</span><br><span class="line">        <span class="comment">// 图片的数组</span></span><br><span class="line">        <span class="attr">pics</span>: [],</span><br><span class="line">        <span class="comment">// 商品的详情描述</span></span><br><span class="line">        <span class="attr">goods_introduce</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">attrs</span>: []</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="十三、订单列表"><a href="#十三、订单列表" class="headerlink" title="十三、订单列表"></a>十三、订单列表</h1><h2 id="1、订单数据展示"><a href="#1、订单数据展示" class="headerlink" title="1、订单数据展示"></a>1、订单数据展示</h2><p>实现订单数据的展示，并且完成相应的分页处理。</p>
<p>列表展示的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 面包屑导航区域 --&gt;</span><br><span class="line">    &lt;el-breadcrumb separator-class=&quot;el-icon-arrow-right&quot;&gt;</span><br><span class="line">      &lt;el-breadcrumb-item :to=&quot;&#123; path: &#x27;/home&#x27; &#125;&quot;&gt;首页&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;订单管理&lt;/el-breadcrumb-item&gt;</span><br><span class="line">      &lt;el-breadcrumb-item&gt;订单列表&lt;/el-breadcrumb-item&gt;</span><br><span class="line">    &lt;/el-breadcrumb&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 卡片视图区域 --&gt;</span><br><span class="line">    &lt;el-card&gt;</span><br><span class="line">      &lt;el-row&gt;</span><br><span class="line">        &lt;el-col :span=&quot;8&quot;&gt;</span><br><span class="line">          &lt;el-input placeholder=&quot;请输入内容&quot;&gt;</span><br><span class="line">            &lt;el-button slot=&quot;append&quot; icon=&quot;el-icon-search&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-input&gt;</span><br><span class="line">        &lt;/el-col&gt;</span><br><span class="line">      &lt;/el-row&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 订单列表数据 --&gt;</span><br><span class="line">      &lt;el-table :data=&quot;orderlist&quot; border stripe&gt;</span><br><span class="line">        &lt;el-table-column type=&quot;index&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;订单编号&quot; prop=&quot;order_number&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;订单价格&quot; prop=&quot;order_price&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;是否付款&quot; prop=&quot;pay_status&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">            &lt;el-tag type=&quot;success&quot; v-if=&quot;scope.row.pay_status === &#x27;1&#x27;&quot;&gt;已付款&lt;/el-tag&gt;</span><br><span class="line">            &lt;el-tag type=&quot;danger&quot; v-else&gt;未付款&lt;/el-tag&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;是否发货&quot; prop=&quot;is_send&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">            &lt;template&gt;&#123;&#123;scope.row.is_send&#125;&#125;&lt;/template&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;下单时间&quot; prop=&quot;create_time&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;&#123;&#123;scope.row.create_time | dateFormat&#125;&#125;&lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">          &lt;template&gt;</span><br><span class="line">            &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; @click=&quot;showBox&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button size=&quot;mini&quot; type=&quot;success&quot; icon=&quot;el-icon-location&quot; @click=&quot;showProgressBox&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">      &lt;!-- 分页区域 --&gt;</span><br><span class="line">      &lt;el-pagination</span><br><span class="line">        @size-change=&quot;handleSizeChange&quot;</span><br><span class="line">        @current-change=&quot;handleCurrentChange&quot;</span><br><span class="line">        :current-page=&quot;queryInfo.pagenum&quot;</span><br><span class="line">        :page-sizes=&quot;[5, 10, 15]&quot;</span><br><span class="line">        :page-size=&quot;queryInfo.pagesize&quot;</span><br><span class="line">        layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">        :total=&quot;total&quot;</span><br><span class="line">      &gt;&lt;/el-pagination&gt;</span><br><span class="line">    &lt;/el-card&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      queryInfo: &#123;</span><br><span class="line">        query: &quot;&quot;,</span><br><span class="line">        pagenum: 1,</span><br><span class="line">        pagesize: 10,</span><br><span class="line">      &#125;,</span><br><span class="line">      total: 0,</span><br><span class="line">      orderlist: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getOrderList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    async getOrderList() &#123;</span><br><span class="line">      const &#123; data: res &#125; = await this.$http.get(&quot;orders&quot;, &#123;</span><br><span class="line">        params: this.queryInfo,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      if (res.meta.status !== 200) &#123;</span><br><span class="line">        return this.$message.error(&quot;获取订单列表失败！&quot;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      console.log(res);</span><br><span class="line">      this.total = res.data.total;</span><br><span class="line">      this.orderlist = res.data.goods;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSizeChange(newSize) &#123;</span><br><span class="line">      this.queryInfo.pagesize = newSize;</span><br><span class="line">      this.getOrderList();</span><br><span class="line">    &#125;,</span><br><span class="line">    handleCurrentChange(newPage) &#123;</span><br><span class="line">      this.queryInfo.pagenum = newPage;</span><br><span class="line">      this.getOrderList();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>基本路由设置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">&quot;./components/Login.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/Welcome.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">&quot;./components/user/Users.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Rights <span class="keyword">from</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Roles <span class="keyword">from</span> <span class="string">&quot;./components/power/Roles.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cate <span class="keyword">from</span> <span class="string">&quot;./components/goods/Cate.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Params <span class="keyword">from</span> <span class="string">&quot;./components/goods/Params.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> GoodsList <span class="keyword">from</span> <span class="string">&quot;./components/goods/List.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Add <span class="keyword">from</span> <span class="string">&quot;./components/goods/Add.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Order <span class="keyword">from</span> <span class="string">&quot;./components/order/Order.vue&quot;</span>;</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/roles&quot;</span>, <span class="attr">component</span>: Roles &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/categories&quot;</span>, <span class="attr">component</span>: Cate &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/params&quot;</span>, <span class="attr">component</span>: Params &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/goods&quot;</span>, <span class="attr">component</span>: GoodsList &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/goods/add&quot;</span>, <span class="attr">component</span>: Add &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/orders&quot;</span>, <span class="attr">component</span>: Order &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="2、地址编辑"><a href="#2、地址编辑" class="headerlink" title="2、地址编辑"></a>2、地址编辑</h2><p>这里主要是实现地址的三级联动</p>
<p>当单击表格中的编辑按钮的时候弹出如下的表格</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-button size=&quot;mini&quot; type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; @click=&quot;showBox&quot;&gt;&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 修改地址的对话框 --&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      title=&quot;修改地址&quot;</span><br><span class="line">      :visible.sync=&quot;addressVisible&quot;</span><br><span class="line">      width=&quot;50%&quot;</span><br><span class="line">      @close=&quot;addressDialogClosed&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form</span><br><span class="line">        :model=&quot;addressForm&quot;</span><br><span class="line">        :rules=&quot;addressFormRules&quot;</span><br><span class="line">        ref=&quot;addressFormRef&quot;</span><br><span class="line">        label-width=&quot;100px&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-form-item label=&quot;省市区/县&quot; prop=&quot;address1&quot;&gt;</span><br><span class="line">          &lt;el-cascader :options=&quot;cityData&quot; v-model=&quot;addressForm.address1&quot;&gt;&lt;/el-cascader&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;详细地址&quot; prop=&quot;address2&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;addressForm.address2&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;addressVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;addressVisible = false&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>关于表单相关的属性定义</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">addressVisible: <span class="literal">false</span>,</span><br><span class="line">     <span class="attr">addressForm</span>: &#123;</span><br><span class="line">       <span class="attr">address1</span>: [],<span class="comment">//用来存储在下拉框中选择的地址信息，这里需要用数组</span></span><br><span class="line">       <span class="attr">address2</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">addressFormRules</span>: &#123;</span><br><span class="line">       <span class="attr">address1</span>: [</span><br><span class="line">         &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请选择省市区县&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">       ],</span><br><span class="line">       <span class="attr">address2</span>: [</span><br><span class="line">         &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;请填写详细地址&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;,</span><br><span class="line">       ],</span><br><span class="line">     &#125;,</span><br><span class="line">     cityData,<span class="comment">//下拉框展示的地址数据源</span></span><br></pre></td></tr></table></figure>

<p><code>el-cascader</code> 组件展示的省市地区，来外部文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cityData <span class="keyword">from</span> <span class="string">&quot;./citydata.js&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>同时在<code>data</code>中定义<code>cityData</code></p>
<p><code>showBox</code>方法的实现如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 展示修改地址的对话框</span></span><br><span class="line">    <span class="function"><span class="title">showBox</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.addressVisible = <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>



<p><code>addressDialogClosed</code>方法实现如下。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">addressDialogClosed() &#123;</span><br><span class="line">     this.$refs.addressFormRef.resetFields();</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>



<h1 id="十四、项目优化"><a href="#十四、项目优化" class="headerlink" title="十四、项目优化"></a>十四、项目优化</h1><p><strong>项目优化的策略</strong></p>
<ul>
<li>生成打包报告</li>
<li>第三方库启用<code>CDN</code></li>
<li><code>Element-UI</code>组件按需加载</li>
<li>路由懒加载</li>
<li>首页内容定制</li>
</ul>
<h2 id="1、进度条使用"><a href="#1、进度条使用" class="headerlink" title="1、进度条使用"></a>1、进度条使用</h2><p>当数据加载慢的时候，可以展示出一个进度条。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save nprogress</span><br></pre></td></tr></table></figure>

<p>在<code>main.js</code>文件中导入<code>js</code>文件与<code>css</code>文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 NProgress 包对应的JS和CSS</span></span><br><span class="line"><span class="keyword">import</span> NProgress <span class="keyword">from</span> <span class="string">&quot;nprogress&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;nprogress/nprogress.css&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>在发送请求的时候开启进度条，在获取响应后关闭进度条</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在 request 拦截器中，展示进度条 NProgress.start()</span></span><br><span class="line">axios.interceptors.request.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(config)</span></span><br><span class="line">  NProgress.start();</span><br><span class="line">  config.headers.Authorization = <span class="built_in">window</span>.sessionStorage.getItem(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">  <span class="comment">//最后必须返回config</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 在 response 拦截器中，隐藏进度条 NProgress.done()</span></span><br><span class="line">axios.interceptors.response.use(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  NProgress.done();</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="2、移除console-log指令"><a href="#2、移除console-log指令" class="headerlink" title="2、移除console.log指令"></a>2、移除<code>console.log</code>指令</h2><p>在项目开发的时候，我们为了测试，写了很多的<code>console.log</code>输出打印，但是当项目发布的时候，就应该将这些内容删除掉。</p>
<p>通过 <code>babel-plugin-transform-remove-console</code> 这个包来完成。</p>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install babel-plugin-transform-remove-console --save-dev</span><br></pre></td></tr></table></figure>

<p>在项目的根目录下面找到<code>babel.config.js</code>文件，做如下的配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这是项目发布阶段需要用到的 babel 插件</span></span><br><span class="line"><span class="keyword">const</span> prodPlugins = [];</span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">  prodPlugins.push(<span class="string">&quot;transform-remove-console&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@vue/cli-plugin-babel/preset&quot;</span>],</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;component&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">libraryName</span>: <span class="string">&quot;element-ui&quot;</span>,</span><br><span class="line">        <span class="attr">styleLibraryName</span>: <span class="string">&quot;theme-chalk&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 发布产品时候的插件数组</span></span><br><span class="line">    ...prodPlugins,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上面的代码中，首先判断是否在生产阶段，如果是采用<code>babel-plugin-transform-remove-console</code>插件。</p>
<p>将其添加到<code>prodPlugins</code>数组中，然后在<code>plugins</code>中进行配置。</p>
<h2 id="3、生成打包报告"><a href="#3、生成打包报告" class="headerlink" title="3、生成打包报告"></a>3、生成打包报告</h2><p>打包时，为了直观地发现项目中存在的问题，可以在打包时生成报告。生成报告的方式有两种：</p>
<p>第一种：通过命令行参数的形式生成报告 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 通过 vue-cli 的命令选项可以生成打包报告 </span><br><span class="line">// --report 选项可以生成 report.html 以帮助分析包内容 </span><br><span class="line">vue-cli-service build --report </span><br></pre></td></tr></table></figure>

<p>第二种：通过可视化的<code>UI</code>面板直接查看报告（推荐）      </p>
<p> 在可视化的<code>UI</code>面板中，通过控制台和分析面板，可以方便地看到项目中所存在的问题。 </p>
<p>例如: 依赖的文件(<code>js</code>,<code>css</code>)比较大，页面打开速度非常慢。</p>
<h2 id="4、通过-vue-config-js-修改-webpack-的默认配置"><a href="#4、通过-vue-config-js-修改-webpack-的默认配置" class="headerlink" title="4、通过 vue.config.js 修改 webpack 的默认配置"></a>4、通过 <code>vue.config.js</code> 修改 <code>webpack</code> 的默认配置</h2><p>通过脚手架工具生成的项目，默认隐藏了所有 <code>webpack</code> 的配置项，目的是为了屏蔽项目的配置过程，让程 序员把工作的重心，放到具体功能和业务逻辑的实现上。 </p>
<p>如果程序员有修改 <code>webpack </code>默认配置的需求，可以在项目根目录中，按需创建 <code>vue.config.js </code>这个配置文件，从 而对项目的打包发布过程做自定义的配置（具体配置参考 <a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/config/#vue-config-js%EF%BC%89%E3%80%82">https://cli.vuejs.org/zh/config/#vue-config-js）。</a> </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// vue.config.js </span><br><span class="line">// 这个文件中，应该导出一个包含了自定义配置选项的对象   </span><br><span class="line">module.exports = &#123;     </span><br><span class="line">// 选项...   </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="5、为开发模式与发布模式指定不同的打包入口"><a href="#5、为开发模式与发布模式指定不同的打包入口" class="headerlink" title="5、为开发模式与发布模式指定不同的打包入口"></a>5、为开发模式与发布模式指定不同的打包入口</h2><p>默认情况下，<code>Vue</code>项目的开发模式与发布模式，共用同一个打包的入口文件（即<code> src/main.js</code>）。</p>
<p>为了将项目 的开发过程与发布过程分离，我们可以为两种模式，各自指定打包的入口文件，即： </p>
<p>① 开发模式的入口文件为<code> src/main-dev.js</code></p>
<p> ② 发布模式的入口文件为<code>src/main-prod.js</code></p>
<p> <strong><code>configureWebpack</code> 和 <code>chainWebpack</code></strong></p>
<p>在<code> vue.config.js</code> 导出的配置对象中，新增 <code>configureWebpack</code>或 <code>chainWebpack</code> 节点，来自定义<code>webpack </code>的打包配置。 </p>
<p>在这里， <code>configureWebpack</code> 和 <code>chainWebpack</code> 的作用相同，唯一的区别就是它们修改 <code>webpack </code>配置的方 式不同： </p>
<p>第一：<code>chainWebpac</code>k 通过<strong>链式编程</strong>的形式，来修改默认的 <code>webpack</code> 配置</p>
<p>第二：<code>configureWebpack </code>通过操作对象的形式，来修改默认的<code>webpack</code>配置 </p>
<p>两者具体的使用差异，可参考如下网址：<code>https://cli.vuejs.org/zh/guide/webpack.html#webpack-%E7%9B%B8%E5%85%B3</code></p>
<h2 id="6、-通过-chainWebpack-自定义打包入口"><a href="#6、-通过-chainWebpack-自定义打包入口" class="headerlink" title="6、 通过 chainWebpack 自定义打包入口"></a>6、 通过 <code>chainWebpack </code>自定义打包入口</h2><p>示例代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123; </span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123; </span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span>, <span class="function"><span class="params">config</span> =&gt;</span> &#123; </span><br><span class="line">        <span class="comment">//移除原有默认的入口，添加新的入口文件</span></span><br><span class="line">      config.entry(<span class="string">&#x27;app&#x27;</span>).clear().add(<span class="string">&#x27;./src/main-prod.js&#x27;</span>) </span><br><span class="line">    &#125;) </span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&#x27;development&#x27;</span>, <span class="function"><span class="params">config</span> =&gt;</span> &#123; </span><br><span class="line">      config.entry(<span class="string">&#x27;app&#x27;</span>).clear().add(<span class="string">&#x27;./src/main-dev.js&#x27;</span>) </span><br><span class="line">    &#125;) </span><br><span class="line">  &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>具体实现的方式如下：</p>
<p>在项目的根目录下面创建<code>vue.config.js</code>文件，并且添加如上代码。</p>
<p>同时将原有的<code>src/main.js</code>文件，重新命名为<code>main-dev.js</code>, 同时在新建一个<code>main-prod.js</code>文件，这两个文件内容是一样的。</p>
<h2 id="7、通过-externals-加载外部-CDN-资源"><a href="#7、通过-externals-加载外部-CDN-资源" class="headerlink" title="7、通过 externals 加载外部 CDN 资源"></a>7、通过 <code>externals</code> 加载外部 <code>CDN</code> 资源</h2><p>默认情况下，通过 import 语法导入的第三方依赖包，最终会被打包合并到同一个文件中，从而导致打包成功 后，单文件体积过大的问题。 </p>
<p>为了解决上述问题，可以通过 <code>webpack </code>的 <code>externals </code>节点，来配置并加载外部的<code>CDN</code>资源。凡是声明在 <code>externals</code> 中的第三方依赖包，都不会被打包。 </p>
<p>具体配置代码如下： </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">config.set(<span class="string">&#x27;externals&#x27;</span>, &#123; </span><br><span class="line">  <span class="attr">vue</span>: <span class="string">&#x27;Vue&#x27;</span>, </span><br><span class="line">  <span class="string">&#x27;vue-router&#x27;</span>: <span class="string">&#x27;VueRouter&#x27;</span>, </span><br><span class="line">  <span class="attr">axios</span>: <span class="string">&#x27;axios&#x27;</span>, </span><br><span class="line">  <span class="attr">lodash</span>: <span class="string">&#x27;_&#x27;</span>, </span><br><span class="line">  <span class="attr">echarts</span>: <span class="string">&#x27;echarts&#x27;</span>, </span><br><span class="line">  <span class="attr">nprogress</span>: <span class="string">&#x27;NProgress&#x27;</span>, </span><br><span class="line">  <span class="string">&#x27;vue-quill-editor&#x27;</span>: <span class="string">&#x27;VueQuillEditor&#x27;</span> </span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<p>以上内容在<code>vue.config.js</code>文件中的<code>发布模式</code>下进行配置，那么在打包的时候，这些内容就不会被打包。</p>
<p>如下代码所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&quot;production&quot;</span>, <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//移除原有默认的入口，添加新的入口文件</span></span><br><span class="line">      config</span><br><span class="line">        .entry(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">        .clear()</span><br><span class="line">        .add(<span class="string">&quot;./src/main-prod.js&quot;</span>);</span><br><span class="line"></span><br><span class="line">      config.set(<span class="string">&quot;externals&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">vue</span>: <span class="string">&quot;Vue&quot;</span>,</span><br><span class="line">        <span class="string">&quot;vue-router&quot;</span>: <span class="string">&quot;VueRouter&quot;</span>,</span><br><span class="line">        <span class="attr">axios</span>: <span class="string">&quot;axios&quot;</span>,</span><br><span class="line">        <span class="attr">lodash</span>: <span class="string">&quot;_&quot;</span>,</span><br><span class="line">        <span class="attr">echarts</span>: <span class="string">&quot;echarts&quot;</span>,</span><br><span class="line">        <span class="attr">nprogress</span>: <span class="string">&quot;NProgress&quot;</span>,</span><br><span class="line">        <span class="string">&quot;vue-quill-editor&quot;</span>: <span class="string">&quot;VueQuillEditor&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&quot;development&quot;</span>, <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">      config</span><br><span class="line">        .entry(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">        .clear()</span><br><span class="line">        .add(<span class="string">&quot;./src/main-dev.js&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么现在就有一个问题了，如果在发布模式下没有对这些内容进行打包，那么这些包就无法使用了，那么应该怎样进行解决呢？</p>
<p>解决的方案就是在<code> public/index.html</code> 文件的头部，添加如下的<code>CDN</code>资源引用： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- nprogress 的样式表文件 --&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css&quot; /&gt; </span><br><span class="line">&lt;!-- 富 文本编辑器</span><br><span class="line"> </span><br><span class="line">的样式表文件 --&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/quill/1.3.4/quill.core.min.css&quot; /&gt; </span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/quill/1.3.4/quill.snow.min.css&quot; /&gt; </span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/quill/1.3.4/quill.bubble.min.css&quot; /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;https://cdn.staticfile.org/vue/2.5.22/vue.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;script src=&quot;https://cdn.staticfile.org/vue-router/3.0.1/vue-router.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;script src=&quot;https://cdn.staticfile.org/axios/0.18.0/axios.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;script src=&quot;https://cdn.staticfile.org/lodash.js/4.17.11/lodash.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;script src=&quot;https://cdn.staticfile.org/echarts/4.1.0/echarts.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;script src=&quot;https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;!-- 富 文本编辑器的 js 文件 --&gt; &lt;script src=&quot;https://cdn.staticfile.org/quill/1.3.4/quill.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.4/dist/vue-quill-editor.js&quot;&gt;&lt;/script&gt; </span><br></pre></td></tr></table></figure>

<p>这样既可以使用<code>vue</code>,<code>axios</code>等，同时最终打包成功后的文件也变小了。</p>
<p>注意：需要将<code>/src/main-prod.js</code> 中的关于进度条样式与富文本编辑器的样式去掉（这些样式最终也会打包到一个文件中）。</p>
<h2 id="8、通过-CDN-优化-ElementUI-的打包"><a href="#8、通过-CDN-优化-ElementUI-的打包" class="headerlink" title="8、通过 CDN 优化 ElementUI 的打包"></a>8、通过 <code>CDN</code> 优化 <code>ElementUI</code> 的打包</h2><p>虽然在开发阶段，我们启用了<code>element-ui </code>组件的按需加载，尽可能的减少了打包的体积，但是那些被按需加 载的组件，还是占用了较大的文件体积。此时，我们可以将<code>element-ui </code>中的组件，也通过<code>CDN</code>的形式来加 载，这样能够进一步减小打包后的文件体积。 </p>
<p>具体操作流程如下： </p>
<p>① 在 <code>main-prod.js </code>中，注释掉 <code>element-ui </code>按需加载的代码 (<code>import &quot;./plugins/element.js&quot;;</code>)</p>
<p>② 在<code>index.html</code>的头部区域中，通过<code>CDN</code>加载 <code>element-ui</code> 的 <code>js </code>和<code>css</code>样式 </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- element-ui 的样式表文件 --&gt; </span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.staticfile.org/element-ui/2.8.2/theme</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="xml">chalk/index.css&quot;</span> /&gt;</span></span> </span><br><span class="line">&lt;!-- element-ui 的 js 文件 --&gt; </span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/element-ui/2.8.2/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span> </span><br></pre></td></tr></table></figure>

<h2 id="9、首页内容定制"><a href="#9、首页内容定制" class="headerlink" title="9、首页内容定制"></a>9、首页内容定制</h2><p>不同的打包环境下，首页内容可能会有所不同。我们可以通过插件的方式进行定制，插件配置如下： </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">chainWebpack: <span class="function"><span class="params">config</span> =&gt;</span> &#123;   </span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&#x27;production&#x27;</span>, <span class="function"><span class="params">config</span> =&gt;</span> &#123;     </span><br><span class="line">        config.plugin(<span class="string">&#x27;html&#x27;</span>).tap(<span class="function"><span class="params">args</span> =&gt;</span> &#123;       </span><br><span class="line">            args[<span class="number">0</span>].isProd = <span class="literal">true</span>       </span><br><span class="line">            <span class="keyword">return</span> args     </span><br><span class="line">        &#125;)   </span><br><span class="line">    &#125;) </span><br><span class="line">    </span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&#x27;development&#x27;</span>, <span class="function"><span class="params">config</span> =&gt;</span> &#123;    </span><br><span class="line">        config.plugin(<span class="string">&#x27;html&#x27;</span>).tap(<span class="function"><span class="params">args</span> =&gt;</span> &#123;      </span><br><span class="line">            args[<span class="number">0</span>].isProd = <span class="literal">false</span>     </span><br><span class="line">            <span class="keyword">return</span> args     </span><br><span class="line">        &#125;)  </span><br><span class="line">    &#125;) </span><br><span class="line">&#125; </span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>动态添加了一个参数：<code>isProd</code>,如果在发布模式中为<code>true</code>,否则为<code>false</code>.</p>
<p>在<code> public/index.html</code> 首页中，可以根据<code>isProd</code>的值，来决定如何渲染页面结构</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!– 按需渲染页面的标题 --&gt; </span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.isProd ? &#x27;&#x27; : &#x27;dev - &#x27; %&gt;电商后台管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span> </span><br><span class="line"> </span><br><span class="line">&lt;!– 按需加载外部的 CDN 资源 --&gt; </span><br><span class="line">&lt;% <span class="keyword">if</span>(htmlWebpackPlugin.options.isProd) &#123; %&gt; &lt;!—通过 externals 加载的外部 CDN 资源--&gt; &lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<p>下面来具体实现一下</p>
<p>在<code>vue.config.js</code>文件中，添加<code>html</code>插件的配置。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&quot;production&quot;</span>, <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//移除原有默认的入口，添加新的入口文件</span></span><br><span class="line">      config</span><br><span class="line">        .entry(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">        .clear()</span><br><span class="line">        .add(<span class="string">&quot;./src/main-prod.js&quot;</span>);</span><br><span class="line"></span><br><span class="line">      config.set(<span class="string">&quot;externals&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">vue</span>: <span class="string">&quot;Vue&quot;</span>,</span><br><span class="line">        <span class="string">&quot;vue-router&quot;</span>: <span class="string">&quot;VueRouter&quot;</span>,</span><br><span class="line">        <span class="attr">axios</span>: <span class="string">&quot;axios&quot;</span>,</span><br><span class="line">        <span class="attr">lodash</span>: <span class="string">&quot;_&quot;</span>,</span><br><span class="line">        <span class="attr">nprogress</span>: <span class="string">&quot;NProgress&quot;</span>,</span><br><span class="line">        <span class="string">&quot;vue-quill-editor&quot;</span>: <span class="string">&quot;VueQuillEditor&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      config.plugin(<span class="string">&quot;html&quot;</span>).tap(<span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].isProd = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> args;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    config.when(process.env.NODE_ENV === <span class="string">&quot;development&quot;</span>, <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">      config</span><br><span class="line">        .entry(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">        .clear()</span><br><span class="line">        .add(<span class="string">&quot;./src/main-dev.js&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//通过html插件动态添加isProd属性，来判断是开发模式还是发布模式</span></span><br><span class="line">      config.plugin(<span class="string">&quot;html&quot;</span>).tap(<span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">        args[<span class="number">0</span>].isProd = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> args;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置好以后，就可以修改<code>index.html</code>中的内容了。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">     &lt;%= htmlWebpackPlugin.options.isProd?&#x27;&#x27;:&#x27;dev-&#x27; %&gt;电商后台管理系统</span><br><span class="line">   <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 如果条件成立表示为发布模式，这时使用cdn模式引入外部文件 --&gt;</span></span><br><span class="line">   &lt;% if(htmlWebpackPlugin.options.isProd)&#123; %&gt;</span><br><span class="line">   <span class="comment">&lt;!-- nprogress 的样式表文件 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">     <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">href</span>=<span class="string">&quot;https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css&quot;</span></span></span><br><span class="line"><span class="tag">   /&gt;</span></span><br><span class="line">       .........</span><br><span class="line">       </span><br><span class="line">    &lt;%&#125;%&gt;  </span><br><span class="line">       </span><br></pre></td></tr></table></figure>

<h2 id="10、路由懒加载"><a href="#10、路由懒加载" class="headerlink" title="10、路由懒加载"></a>10、路由懒加载</h2><p>当打包构建项目时，JavaScript 包会变得非常大，影响页面加载。如果我们能把不同路由对应的组件分割成 不同的代码块，然后当路由被访问的时候才加载对应组件，这样就更加高效了。(默认情况下是加载所有的组件，但是实现了路由懒加载后，可以实现当路由被访问的时候才加载对应组件)</p>
<p>具体需要 3 步： </p>
<p>① 安装 <code>@babel/plugin-syntax-dynamic-import</code> 包。</p>
<p> ② 在<code> babel.config.js</code> 配置文件中声明该插件。 </p>
<p>③ 将路由改为按需加载的形式，示例代码如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;group-foo&quot; */</span> <span class="string">&#x27;./Foo.vue&#x27;</span>) </span><br><span class="line"><span class="keyword">const</span> Bar = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;group-foo&quot; */</span> <span class="string">&#x27;./Bar.vue&#x27;</span>) </span><br><span class="line"><span class="keyword">const</span> Baz = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;group-boo&quot; */</span> <span class="string">&#x27;./Baz.vue&#x27;</span>) </span><br></pre></td></tr></table></figure>

<p>以上内容语法需要安装了<code>@babel/plugin-syntax-dynamic-import</code>才能使用，<code>import</code>方法有两部分组成，后面的是组件的路径，前面部分表示的分组。</p>
<p>我们可以看到<code>Foo.vue</code> 与<code>Bar.vue</code>这两个组件是同一组，那么在打包的时候，这两个组件会打包到同一个<code>js</code>文件中。如果请求<code>Foo</code>这个组件的时候，也会加载<code>Bar</code>这个组件。当然请求<code>Bar</code>这个组件的时候，也会加载<code>Foo</code>这个组件。</p>
<p>而<code>Baz</code>组件会被单独的打包到一个<code>js</code>文件中。</p>
<p>关于路由懒加载的详细文档，可参考如下链接：<br><code>https://router.vuejs.org/zh/guide/advanced/lazy-loading.html </code></p>
<p>下面 安装 <code>@babel/plugin-syntax-dynamic-import</code> 包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev @babel/plugin-syntax-dynamic-import</span><br></pre></td></tr></table></figure>

<p>在<code>babel.config.js</code>文件中配置上面包</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这是项目发布阶段需要用到的 babel 插件</span></span><br><span class="line"><span class="keyword">const</span> prodPlugins = [];</span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">  prodPlugins.push(<span class="string">&quot;transform-remove-console&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [<span class="string">&quot;@vue/cli-plugin-babel/preset&quot;</span>],</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;component&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">libraryName</span>: <span class="string">&quot;element-ui&quot;</span>,</span><br><span class="line">        <span class="attr">styleLibraryName</span>: <span class="string">&quot;theme-chalk&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 发布产品时候的插件数组</span></span><br><span class="line">    ...prodPlugins,</span><br><span class="line">    <span class="comment">// 实现路由懒加载</span></span><br><span class="line">    <span class="string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面改造<code>src/router.js</code>文件中的内容</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="comment">// import Login from &quot;./components/Login.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Home from &quot;./components/Home.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Welcome from &quot;./components/Welcome.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Users from &quot;./components/user/Users.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Rights from &quot;./components/power/Rights.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Roles from &quot;./components/power/Roles.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Cate from &quot;./components/goods/Cate.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Params from &quot;./components/goods/Params.vue&quot;;</span></span><br><span class="line"><span class="comment">// import GoodsList from &quot;./components/goods/List.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Add from &quot;./components/goods/Add.vue&quot;;</span></span><br><span class="line"><span class="comment">// import Order from &quot;./components/order/Order.vue&quot;;</span></span><br><span class="line"><span class="comment">//下面实现路由懒加载</span></span><br><span class="line"><span class="keyword">const</span> Login = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;login_home_welcome&quot; */</span> <span class="string">&quot;./components/Login.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Home = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;login_home_welcome&quot; */</span> <span class="string">&quot;./components/Home.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Welcome = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(</span><br><span class="line">    <span class="comment">/* webpackChunkName: &quot;login_home_welcome&quot; */</span> <span class="string">&quot;./components/Welcome.vue&quot;</span></span><br><span class="line">  );</span><br><span class="line"><span class="keyword">const</span> Users = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(</span><br><span class="line">    <span class="comment">/* webpackChunkName: &quot;Users_Rights_Roles&quot; */</span> <span class="string">&quot;./components/user/Users.vue&quot;</span></span><br><span class="line">  );</span><br><span class="line"><span class="keyword">const</span> Rights = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(</span><br><span class="line">    <span class="comment">/* webpackChunkName: &quot;Users_Rights_Roles&quot; */</span> <span class="string">&quot;./components/power/Rights.vue&quot;</span></span><br><span class="line">  );</span><br><span class="line"><span class="keyword">const</span> Roles = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(</span><br><span class="line">    <span class="comment">/* webpackChunkName: &quot;Users_Rights_Roles&quot; */</span> <span class="string">&quot;./components/power/Roles.vue&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Cate = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;Cate_Params&quot; */</span> <span class="string">&quot;./components/goods/Cate.vue&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Params = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;Cate_Params&quot; */</span> <span class="string">&quot;./components/goods/Params.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> GoodsList = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;GoodsList_Add&quot; */</span> <span class="string">&quot;./components/goods/List.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Add = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;GoodsList_Add&quot; */</span> <span class="string">&quot;./components/goods/Add.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Order = <span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;Order&quot; */</span> <span class="string">&quot;./components/order/Order.vue&quot;</span>);</span><br><span class="line">Vue.use(Router);</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">redirect</span>: <span class="string">&quot;/login&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>, <span class="attr">component</span>: Login &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: Home,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&quot;/welcome&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/welcome&quot;</span>, <span class="attr">component</span>: Welcome &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/users&quot;</span>, <span class="attr">component</span>: Users &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/rights&quot;</span>, <span class="attr">component</span>: Rights &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/roles&quot;</span>, <span class="attr">component</span>: Roles &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/categories&quot;</span>, <span class="attr">component</span>: Cate &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/params&quot;</span>, <span class="attr">component</span>: Params &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/goods&quot;</span>, <span class="attr">component</span>: GoodsList &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/goods/add&quot;</span>, <span class="attr">component</span>: Add &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">&quot;/orders&quot;</span>, <span class="attr">component</span>: Order &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>实现了路由懒加载后，打包后的文件体积也会变小。</p>
<p>以上的优化配置已经完成了，下面可以上线，当然在上线之前，需要将项目进行打包</p>
<p><code>npm run build</code></p>
<p>命令完成项目的打包，打包后的项目会在<code>dist</code>目录下。下面需要进行部署上线。</p>
<h2 id="十五、项目部署上线"><a href="#十五、项目部署上线" class="headerlink" title="十五、项目部署上线"></a>十五、项目部署上线</h2><p>关于项目部署上线，主要完成以下的配置</p>
<p>第一： 通过<code> node</code> 创建 <code>web</code> 服务器。 </p>
<p>第二： 开启<code> gzip</code> 配置。 </p>
<p>第三：配置 <code>https </code>服务</p>
<p>第四：使用 <code>pm2</code> 管理应用</p>
<h2 id="1、通过-node-创建-web-服务器"><a href="#1、通过-node-创建-web-服务器" class="headerlink" title="1、通过 node 创建 web 服务器"></a>1、通过 node 创建 web 服务器</h2><p>创建 <code>node</code> 项目，并安装<code> express</code>，通过<code>express</code> 快速创建 <code>web </code>服务器，将 <code>vue</code> 打包生成的<code> dist</code> 文件夹，</p>
<p>托管为静态资源即可，关键代码如下： </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) </span><br><span class="line"><span class="comment">// 创建 web 服务器 </span></span><br><span class="line"><span class="keyword">const</span> app = express() </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 托管静态资源 </span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./dist&#x27;</span>)) </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 启动 web 服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;web server running at http://127.0.0.1&#x27;</span>) </span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>



<p>具体实现过程如下：</p>
<p>首先新建一个文件夹，例如：<code>vue_shop_server</code></p>
<p>然后在这个文件夹下面创建一个<code>node</code>项目来托管发布后的<code>Vue</code>项目。</p>
<p>在<code>vue_shop_server</code>目录下，进行项目的初始化</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>然后安装<code>express</code>,通过<code>express</code>快速启动服务。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i express -s</span><br></pre></td></tr></table></figure>

<p>把打包好的<code>Vue</code>项目中的文件夹<code>dist</code>拷贝到<code>vue_shop_server</code>目录下。</p>
<p>同时在该目录下创建<code>app.js</code>文件，在该文件中添加如下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>) </span><br><span class="line"><span class="comment">// 创建 web 服务器 </span></span><br><span class="line"><span class="keyword">const</span> app = express() </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 托管静态资源 </span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./dist&#x27;</span>)) </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 启动 web 服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;web server running at http://127.0.0.1&#x27;</span>) </span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<p>通过<code>node app.js</code>命令启动以上服务，这时就可以访问我们打包好的<code>vue</code>项目。</p>
<h2 id="2、开启-gzip-配置"><a href="#2、开启-gzip-配置" class="headerlink" title="2、开启 gzip 配置"></a>2、开启 <code>gzip</code> 配置</h2><p>使用 <code>gzip</code> 可以减小文件体积，使传输速度更快。 </p>
<p> 可以通过服务器端使用<code>Express</code>做 <code>gzip </code>压缩。其配置如下： </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装相应包   </span></span><br><span class="line">npm install compression -S  </span><br><span class="line"><span class="comment">// 导入包   </span></span><br><span class="line"><span class="keyword">const</span> compression = <span class="built_in">require</span>(<span class="string">&#x27;compression&#x27;</span>);  </span><br><span class="line"><span class="comment">// 启用中间件   </span></span><br><span class="line">app.use(compression()); </span><br></pre></td></tr></table></figure>

<p>具体实现如下所示，修改<code>app.js</code>文件中的代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 创建 web 服务器</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> compression = <span class="built_in">require</span>(<span class="string">&quot;compression&quot;</span>);</span><br><span class="line"><span class="comment">// 一定要把这一行代码，写到 静态资源托管之前(注意顺序)</span></span><br><span class="line">app.use(compression());</span><br><span class="line"><span class="comment">// 托管静态资源</span></span><br><span class="line">app.use(express.static(<span class="string">&quot;./dist&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动 web 服务器</span></span><br><span class="line">app.listen(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;web server running at http://127.0.0.1&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>重新启动服务。</p>
<h2 id="3、配置-HTTPS-服务"><a href="#3、配置-HTTPS-服务" class="headerlink" title="3、配置 HTTPS 服务"></a>3、配置 <code>HTTPS</code> 服务</h2><p><strong>为什么要启用 <code>HTTPS</code> 服务？</strong> </p>
<p>传统的<code> HTTP</code> 协议传输的数据都是明文，不安全</p>
<p> 采用<code> HTTPS</code> 协议对传输的数据进行了加密处理，可以防止数据被中间人窃取，使用更安全 </p>
<p><strong>申请 <code>SSL</code> 证书（<a target="_blank" rel="noopener" href="https://freessl.org)/">https://freessl.org）</a></strong> </p>
<p>① 进入<code> https://freessl.cn/</code> 官网，输入要申请的域名并选择品牌。 </p>
<p>② 输入自己的邮箱并选择相关选项。</p>
<p> ③ 验证 <code>DNS</code>（在域名管理后台添加 <code>TXT</code> 记录）。 </p>
<p>④ 验证通过之后，下载 <code>SSL</code> 证书（<code> full_chain.pem</code> 公钥；<code>private.key</code> 私钥）。 </p>
<p><strong>在后台项目中导入证书</strong> </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>); </span><br><span class="line"> <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>); </span><br><span class="line"> <span class="keyword">const</span> options = &#123; </span><br><span class="line">     <span class="attr">cert</span>: fs.readFileSync(<span class="string">&#x27;./full_chain.pem&#x27;</span>), </span><br><span class="line">     <span class="attr">key</span>: fs.readFileSync(<span class="string">&#x27;./private.key&#x27;</span>) </span><br><span class="line"> &#125; </span><br><span class="line"> https.createServer(options, app).listen(<span class="number">443</span>); </span><br></pre></td></tr></table></figure>

<h2 id="4、使用-pm2-管理应用"><a href="#4、使用-pm2-管理应用" class="headerlink" title="4、使用 pm2 管理应用"></a>4、使用 <code>pm2</code> 管理应用</h2><p>现在我们要启动<code>node</code>服务，需要开启一个指令窗口，如果将该窗口关闭，那么整个服务也就停止了。</p>
<p>同时，窗口的管理也很麻烦。</p>
<p>① 在服务器中安装 <code>pm2：npm i pm2 -g </code></p>
<p>② 启动项目：<code>pm2 start</code> 脚本<code> --name</code> 自定义名称   //脚本表示node项目起始文件(app.js)</p>
<p>③ 查看运行项目：<code>pm2 ls</code>  </p>
<p>④ 重启项目：<code>pm2 restart</code> 自定义名称 </p>
<p>⑤ 停止项目：<code>pm2 stop</code> 自定义名称 </p>
<p>⑥ 删除项目：<code>pm2 delete</code> 自定义名称 </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">满天鑫</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://smanman.github.io/post/1b85fbbb.html">https://smanman.github.io/post/1b85fbbb.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://smanman.github.io" target="_blank">满天鑫</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/Vue%E5%90%8E%E5%8F%B0%E7%94%B5%E5%95%86%E7%AE%A1%E7%90%86%E9%A1%B9%E7%9B%AE/">Vue后台电商管理项目</a></div><div class="post_share"><div class="social-share" data-image="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082302.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/4cb17d62.html"><img class="prev-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212104.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Next.js服务器端渲染</div></div></a></div><div class="next-post pull-right"><a href="/post/33da025f.html"><img class="next-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212050.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Nuxt.js服务器端渲染</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/7e996e60.html" title="JavaScript基础第02天笔记"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212025.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-18</div><div class="title">JavaScript基础第02天笔记</div></div></a></div><div><a href="/post/2e39ac9e.html" title="day05 - Web APIs"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082302.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-18</div><div class="title">day05 - Web APIs</div></div></a></div><div><a href="/post/facd74f4.html" title="Echarts"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082249.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-18</div><div class="title">Echarts</div></div></a></div><div><a href="/post/40cf0c06.html" title="快来地学习canvas吧"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082159.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-19</div><div class="title">快来地学习canvas吧</div></div></a></div><div><a href="/post/c5a97815.html" title="BFC"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082055.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-18</div><div class="title">BFC</div></div></a></div><div><a href="/post/3d42c651.html" title="PM2一键部署"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082159.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-19</div><div class="title">PM2一键部署</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">一、项目简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8A%9F%E8%83%BD%E5%88%92%E5%88%86"><span class="toc-number">1.1.</span> <span class="toc-text">1、后台管理系统的功能划分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%EF%BC%88%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">2、后台管理系统的开发模式（前后端分离）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%94%B5%E5%95%86%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">3、电商后台管理系统的技术选型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%99%BB%E5%BD%95-%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">2.</span> <span class="toc-text">二、登录&#x2F;退出功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">1、登录业务流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">2、登录业务的相关技术点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81token%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">2.3.</span> <span class="toc-text">3、token原理分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%B7%AF%E7%94%B1%E5%88%9B%E5%BB%BA"><span class="toc-number">2.4.</span> <span class="toc-text">4、路由创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E6%9E%84%E5%BB%BA"><span class="toc-number">2.5.</span> <span class="toc-text">5、登录页面构建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E7%99%BB%E5%BD%95%E5%89%8D%E7%9A%84%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">2.6.</span> <span class="toc-text">6、登录前的表单校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E9%85%8D%E7%BD%AEaxios%E5%8F%91%E8%B5%B7%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82"><span class="toc-number">2.7.</span> <span class="toc-text">7、配置axios发起登录请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E9%85%8D%E7%BD%AEMessage%E6%8F%90%E7%A4%BA%E6%A1%86"><span class="toc-number">2.8.</span> <span class="toc-text">8、配置Message提示框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AD%98%E5%82%A8token%E4%BF%A1%E6%81%AF"><span class="toc-number">2.9.</span> <span class="toc-text">9、客户端存储token信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E9%80%9A%E8%BF%87%E8%B7%AF%E7%94%B1%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB%E6%8E%A7%E5%88%B6%E9%A1%B5%E9%9D%A2%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="toc-number">2.10.</span> <span class="toc-text">10、通过路由导航守卫控制页面访问权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81%E5%AE%9E%E7%8E%B0%E9%80%80%E5%87%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">2.11.</span> <span class="toc-text">11、实现退出功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%B8%BB%E9%A1%B5%E5%B8%83%E5%B1%80%E5%92%8C%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.</span> <span class="toc-text">三、主页布局和功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%B8%BB%E9%A1%B5%E5%9F%BA%E6%9C%AC%E5%B8%83%E5%B1%80%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.1.</span> <span class="toc-text">1、主页基本布局实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%A4%B4%E9%83%A8%E5%8C%BA%E5%9F%9F%E5%B8%83%E5%B1%80%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.2.</span> <span class="toc-text">2、头部区域布局设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%AE%9E%E7%8E%B0%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.</span> <span class="toc-text">3、实现导航菜单的基本结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%80%9A%E8%BF%87axios-%E6%8B%A6%E6%88%AA%E5%99%A8%E6%B7%BB%E5%8A%A0token%E9%AA%8C%E8%AF%81"><span class="toc-number">3.4.</span> <span class="toc-text">4、通过axios 拦截器添加token验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E8%8E%B7%E5%8F%96%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E6%95%B0%E6%8D%AE"><span class="toc-number">3.5.</span> <span class="toc-text">5、获取左侧菜单数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%B8%B2%E6%9F%93%E8%8F%9C%E5%8D%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.6.</span> <span class="toc-text">6、渲染菜单结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E8%8F%9C%E5%8D%95%E5%9B%BE%E6%A0%87%E5%A4%84%E7%90%86"><span class="toc-number">3.7.</span> <span class="toc-text">7、菜单图标处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E7%9A%84%E6%8A%98%E5%8F%A0%E4%B8%8E%E5%B1%95%E5%BC%80%E6%95%88%E6%9E%9C"><span class="toc-number">3.8.</span> <span class="toc-text">8、左侧菜单的折叠与展开效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E5%AE%9E%E7%8E%B0%E9%A6%96%E9%A1%B5%E8%B7%AF%E7%94%B1%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">3.9.</span> <span class="toc-text">9、实现首页路由的重定向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%90%AF%E7%94%A8%E8%8F%9C%E5%8D%95%E9%93%BE%E6%8E%A5%E5%8A%9F%E8%83%BD"><span class="toc-number">3.10.</span> <span class="toc-text">10、启用菜单链接功能</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E5%B8%83%E5%B1%80%E5%92%8C%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.</span> <span class="toc-text">四、用户列表布局和功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E5%9F%BA%E6%9C%AC%E5%B1%95%E7%A4%BA"><span class="toc-number">4.1.</span> <span class="toc-text">1、用户列表基本展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BF%9D%E5%AD%98%E8%8F%9C%E5%8D%95%E7%9A%84%E6%BF%80%E6%B4%BB%E7%8A%B6%E6%80%81"><span class="toc-number">4.2.</span> <span class="toc-text">2、保存菜单的激活状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E5%9F%BA%E6%9C%AC%E5%B8%83%E5%B1%80%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.3.</span> <span class="toc-text">3、用户列表基本布局实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">4.4.</span> <span class="toc-text">4、获取用户列表数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8%E8%A1%A8%E6%A0%BC%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE"><span class="toc-number">4.5.</span> <span class="toc-text">5、使用表格展示用户数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81%E5%88%97%E7%9A%84%E6%98%BE%E7%A4%BA%E6%95%88%E6%9E%9C"><span class="toc-number">4.6.</span> <span class="toc-text">6、自定义状态列的显示效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%93%8D%E4%BD%9C%E5%88%97"><span class="toc-number">4.7.</span> <span class="toc-text">7、自定义操作列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E6%95%88%E6%9E%9C"><span class="toc-number">4.8.</span> <span class="toc-text">8、实现分页效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E7%8A%B6%E6%80%81"><span class="toc-number">4.9.</span> <span class="toc-text">9、修改用户状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E7%94%A8%E6%88%B7%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.10.</span> <span class="toc-text">10、用户搜索功能实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E3%80%81%E7%BC%96%E8%BE%91%E3%80%81%E5%88%A0%E9%99%A4%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">五、用户添加、编辑、删除功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">5.1.</span> <span class="toc-text">1、展示用户添加对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%B1%95%E7%A4%BA%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E8%A1%A8%E5%8D%95"><span class="toc-number">5.2.</span> <span class="toc-text">2、展示添加用户表单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99"><span class="toc-number">5.3.</span> <span class="toc-text">3、自定义校验规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%AE%9E%E7%8E%B0%E8%A1%A8%E5%8D%95%E9%87%8D%E7%BD%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">5.4.</span> <span class="toc-text">4、实现表单重置操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%AE%8C%E6%88%90%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0"><span class="toc-number">5.5.</span> <span class="toc-text">5、完成用户添加</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%B1%95%E7%A4%BA%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">5.6.</span> <span class="toc-text">6、展示修改用户的对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E7%BC%96%E5%8F%B7%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">5.7.</span> <span class="toc-text">7、根据用户编号查询用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%B1%95%E7%A4%BA%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E7%9A%84%E8%A1%A8%E5%8D%95"><span class="toc-number">5.8.</span> <span class="toc-text">8、展示修改用户的表单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E5%AE%8C%E6%88%90%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%BC%96%E8%BE%91%E6%93%8D%E4%BD%9C"><span class="toc-number">5.9.</span> <span class="toc-text">9、完成用户信息编辑操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE"><span class="toc-number">5.10.</span> <span class="toc-text">10、删除用户数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8"><span class="toc-number">6.</span> <span class="toc-text">六、权限列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">6.1.</span> <span class="toc-text">1、创建权限列表组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E5%85%B3%E7%B3%BB%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.2.</span> <span class="toc-text">2、用户角色权限关系介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E8%A7%92%E8%89%B2%E5%88%97%E8%A1%A8"><span class="toc-number">7.</span> <span class="toc-text">七、角色列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%B1%95%E7%A4%BA%E8%A7%92%E8%89%B2%E6%95%B0%E6%8D%AE"><span class="toc-number">7.1.</span> <span class="toc-text">1、展示角色数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%B8%B2%E6%9F%93%E4%B8%80%E7%BA%A7%E6%9D%83%E9%99%90"><span class="toc-number">7.2.</span> <span class="toc-text">2、渲染一级权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%B8%B2%E6%9F%93%E4%BA%8C%E7%BA%A7%E6%9D%83%E9%99%90"><span class="toc-number">7.3.</span> <span class="toc-text">3、渲染二级权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%B8%B2%E6%9F%93%E4%B8%89%E7%BA%A7%E6%9D%83%E9%99%90"><span class="toc-number">7.4.</span> <span class="toc-text">4、渲染三级权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E8%A7%92%E8%89%B2%E4%B8%8B%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">7.5.</span> <span class="toc-text">5、删除指定角色下的权限</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%E3%80%81%E8%A7%92%E8%89%B2"><span class="toc-number">8.</span> <span class="toc-text">八、分配权限、角色</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%E2%80%94%E5%B1%95%E7%A4%BA%E6%9D%83%E9%99%90%E4%BF%A1%E6%81%AF"><span class="toc-number">8.1.</span> <span class="toc-text">1、分配权限—展示权限信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8%E6%A0%91%E5%BD%A2%E6%96%B9%E5%BC%8F%E5%B1%95%E7%A4%BA%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE"><span class="toc-number">8.2.</span> <span class="toc-text">2、使用树形方式展示权限数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%B0%86%E6%9F%90%E4%B8%AA%E8%A7%92%E8%89%B2%E5%B7%B2%E6%9C%89%E6%9D%83%E9%99%90%E9%80%89%E4%B8%AD"><span class="toc-number">8.3.</span> <span class="toc-text">3、将某个角色已有权限选中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%AE%8C%E6%88%90%E6%9D%83%E9%99%90%E7%9A%84%E5%88%86%E9%85%8D"><span class="toc-number">8.4.</span> <span class="toc-text">4、完成权限的分配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%B8%BA%E7%94%A8%E6%88%B7%E5%88%86%E9%85%8D%E8%A7%92%E8%89%B2"><span class="toc-number">8.5.</span> <span class="toc-text">5、为用户分配角色</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB"><span class="toc-number">9.</span> <span class="toc-text">九、商品分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-number">9.1.</span> <span class="toc-text">1、商品分类功能介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E5%88%9B%E5%BB%BA"><span class="toc-number">9.2.</span> <span class="toc-text">2、商品分类组件基本创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%8E%B7%E5%8F%96%E5%95%86%E5%93%81%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">9.3.</span> <span class="toc-text">3、获取商品分类数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8vue-table-width-tree-grid%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">9.4.</span> <span class="toc-text">4、使用vue-table-width-tree-grid展示数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF%E5%88%97%E6%B8%B2%E6%9F%93%E8%A1%A8%E6%A0%BC%E6%95%B0%E6%8D%AE"><span class="toc-number">9.5.</span> <span class="toc-text">5、使用自定义模板列渲染表格数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.6.</span> <span class="toc-text">6、分页功能实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E6%9E%84%E5%BB%BA%E6%B7%BB%E5%8A%A0%E5%88%86%E7%B1%BB%E7%9A%84%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%B8%8E%E8%A1%A8%E5%8D%95"><span class="toc-number">9.7.</span> <span class="toc-text">7、构建添加分类的对话框与表单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E8%8E%B7%E5%8F%96%E7%88%B6%E7%BA%A7%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">9.8.</span> <span class="toc-text">8、获取父级分类数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E6%B8%B2%E6%9F%93%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">9.9.</span> <span class="toc-text">9、渲染级联选择器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E6%A0%B9%E6%8D%AE%E7%88%B6%E5%88%86%E7%B1%BB%E7%9A%84%E5%8F%98%E5%8C%96%E5%A4%84%E7%90%86%E8%A1%A8%E5%8D%95%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">9.10.</span> <span class="toc-text">10、根据父分类的变化处理表单中的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81%E5%AE%8C%E6%88%90%E7%B1%BB%E5%88%AB%E6%B7%BB%E5%8A%A0"><span class="toc-number">9.11.</span> <span class="toc-text">11、完成类别添加</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%88%86%E7%B1%BB%E5%8F%82%E6%95%B0"><span class="toc-number">10.</span> <span class="toc-text">十、分类参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%88%86%E7%B1%BB%E5%8F%82%E6%95%B0%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.1.</span> <span class="toc-text">1、分类参数功能介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%9E%84%E5%BB%BA%E5%88%86%E7%B1%BB%E5%8F%82%E6%95%B0%E7%BB%84%E4%BB%B6"><span class="toc-number">10.2.</span> <span class="toc-text">2、构建分类参数组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%B8%B2%E6%9F%93Tab%E9%A1%B5%E7%AD%BE%E3%80%82"><span class="toc-number">10.3.</span> <span class="toc-text">3、渲染Tab页签。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%B8%B2%E6%9F%93%E6%B7%BB%E5%8A%A0%E5%8F%82%E6%95%B0%E4%B8%8E%E5%B1%9E%E6%80%A7%E6%8C%89%E9%92%AE"><span class="toc-number">10.4.</span> <span class="toc-text">4、渲染添加参数与属性按钮</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%88%87%E6%8D%A2Tab%E9%A1%B5%E7%AD%BE%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">10.5.</span> <span class="toc-text">5、切换Tab页签获取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%B8%B2%E6%9F%93%E8%A1%A8%E6%A0%BC"><span class="toc-number">10.6.</span> <span class="toc-text">6、渲染表格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E6%B8%B2%E6%9F%93%E6%B7%BB%E5%8A%A0%E5%8F%82%E6%95%B0%E7%9A%84%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">10.7.</span> <span class="toc-text">7、渲染添加参数的对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%AE%8C%E6%88%90%E5%8F%82%E6%95%B0%E7%9A%84%E6%B7%BB%E5%8A%A0"><span class="toc-number">10.8.</span> <span class="toc-text">8、完成参数的添加</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0"><span class="toc-number">10.9.</span> <span class="toc-text">9、修改参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%88%A0%E9%99%A4%E5%8F%82%E6%95%B0"><span class="toc-number">10.10.</span> <span class="toc-text">10、删除参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81%E6%B8%B2%E6%9F%93%E5%8F%82%E6%95%B0%E4%B8%8B%E7%9A%84%E5%8F%AF%E9%80%89%E9%A1%B9"><span class="toc-number">10.11.</span> <span class="toc-text">11、渲染参数下的可选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E3%80%81%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%AE%9A%E5%8F%82%E6%95%B0%E5%B1%9E%E6%80%A7%E7%9A%84%E6%B7%BB%E5%8A%A0"><span class="toc-number">10.12.</span> <span class="toc-text">12、实现指定参数属性的添加</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13%E3%80%81%E5%88%A0%E9%99%A4%E5%8F%82%E6%95%B0"><span class="toc-number">10.13.</span> <span class="toc-text">13、删除参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%95%86%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-number">11.</span> <span class="toc-text">十一、商品列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%95%86%E5%93%81%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA"><span class="toc-number">11.1.</span> <span class="toc-text">1、商品数据展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%85%A8%E5%B1%80%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">11.2.</span> <span class="toc-text">2、全局过滤器的创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%88%A0%E9%99%A4%E5%95%86%E5%93%81%E4%BF%A1%E6%81%AF"><span class="toc-number">11.3.</span> <span class="toc-text">3、删除商品信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E5%95%86%E5%93%81%E6%B7%BB%E5%8A%A0"><span class="toc-number">12.</span> <span class="toc-text">十二、商品添加</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%95%86%E5%93%81%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E6%9E%84%E5%BB%BA"><span class="toc-number">12.1.</span> <span class="toc-text">1、商品添加页面构建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%9F%BA%E6%9C%AC%E8%A1%A8%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">12.2.</span> <span class="toc-text">2、基本表单实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%98%BB%E6%AD%A2%E6%A0%87%E7%AD%BE%E9%A1%B5%E5%88%87%E6%8D%A2"><span class="toc-number">12.3.</span> <span class="toc-text">3、阻止标签页切换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">12.4.</span> <span class="toc-text">4、获取动态参数列表数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E8%8E%B7%E5%8F%96%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">12.5.</span> <span class="toc-text">5、获取静态属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0"><span class="toc-number">12.6.</span> <span class="toc-text">6、图片上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E5%9B%BE%E7%89%87%E5%88%A0%E9%99%A4"><span class="toc-number">12.7.</span> <span class="toc-text">7、图片删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88"><span class="toc-number">12.8.</span> <span class="toc-text">8、图片预览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">12.9.</span> <span class="toc-text">9、富文本编辑器使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E5%AE%8C%E6%88%90%E5%95%86%E5%93%81%E7%9A%84%E6%B7%BB%E5%8A%A0"><span class="toc-number">12.10.</span> <span class="toc-text">10、完成商品的添加</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E8%AE%A2%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">13.</span> <span class="toc-text">十三、订单列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%AE%A2%E5%8D%95%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA"><span class="toc-number">13.1.</span> <span class="toc-text">1、订单数据展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%9C%B0%E5%9D%80%E7%BC%96%E8%BE%91"><span class="toc-number">13.2.</span> <span class="toc-text">2、地址编辑</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96"><span class="toc-number">14.</span> <span class="toc-text">十四、项目优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%BF%9B%E5%BA%A6%E6%9D%A1%E4%BD%BF%E7%94%A8"><span class="toc-number">14.1.</span> <span class="toc-text">1、进度条使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%A7%BB%E9%99%A4console-log%E6%8C%87%E4%BB%A4"><span class="toc-number">14.2.</span> <span class="toc-text">2、移除console.log指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%94%9F%E6%88%90%E6%89%93%E5%8C%85%E6%8A%A5%E5%91%8A"><span class="toc-number">14.3.</span> <span class="toc-text">3、生成打包报告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%80%9A%E8%BF%87-vue-config-js-%E4%BF%AE%E6%94%B9-webpack-%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">14.4.</span> <span class="toc-text">4、通过 vue.config.js 修改 webpack 的默认配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%B8%BA%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8F%91%E5%B8%83%E6%A8%A1%E5%BC%8F%E6%8C%87%E5%AE%9A%E4%B8%8D%E5%90%8C%E7%9A%84%E6%89%93%E5%8C%85%E5%85%A5%E5%8F%A3"><span class="toc-number">14.5.</span> <span class="toc-text">5、为开发模式与发布模式指定不同的打包入口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81-%E9%80%9A%E8%BF%87-chainWebpack-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%93%E5%8C%85%E5%85%A5%E5%8F%A3"><span class="toc-number">14.6.</span> <span class="toc-text">6、 通过 chainWebpack 自定义打包入口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E9%80%9A%E8%BF%87-externals-%E5%8A%A0%E8%BD%BD%E5%A4%96%E9%83%A8-CDN-%E8%B5%84%E6%BA%90"><span class="toc-number">14.7.</span> <span class="toc-text">7、通过 externals 加载外部 CDN 资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E9%80%9A%E8%BF%87-CDN-%E4%BC%98%E5%8C%96-ElementUI-%E7%9A%84%E6%89%93%E5%8C%85"><span class="toc-number">14.8.</span> <span class="toc-text">8、通过 CDN 优化 ElementUI 的打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81%E9%A6%96%E9%A1%B5%E5%86%85%E5%AE%B9%E5%AE%9A%E5%88%B6"><span class="toc-number">14.9.</span> <span class="toc-text">9、首页内容定制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">14.10.</span> <span class="toc-text">10、路由懒加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF"><span class="toc-number">14.11.</span> <span class="toc-text">十五、项目部署上线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E9%80%9A%E8%BF%87-node-%E5%88%9B%E5%BB%BA-web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">14.12.</span> <span class="toc-text">1、通过 node 创建 web 服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%BC%80%E5%90%AF-gzip-%E9%85%8D%E7%BD%AE"><span class="toc-number">14.13.</span> <span class="toc-text">2、开启 gzip 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AE-HTTPS-%E6%9C%8D%E5%8A%A1"><span class="toc-number">14.14.</span> <span class="toc-text">3、配置 HTTPS 服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8-pm2-%E7%AE%A1%E7%90%86%E5%BA%94%E7%94%A8"><span class="toc-number">14.15.</span> <span class="toc-text">4、使用 pm2 管理应用</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 满天鑫</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="framework-info"><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202301132049386.png"/><span> </span><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">晋ICP备2022012091号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'pinglun-9gh2lmcnd8587831',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'pinglun-9gh2lmcnd8587831',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script src="//code.tidio.co/smwivpnwumemac2wohardi3d3gpud1ag.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>