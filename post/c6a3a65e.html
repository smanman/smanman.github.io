<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Node 第 6 天笔记 | 满天鑫</title><meta name="keywords" content="前端,Node"><meta name="author" content="满天鑫"><meta name="copyright" content="满天鑫"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Node 第 6 天1.  学习目标◆ 前后端的身份认证 ◆ 能够了解 Session 的实现原理 ◆ 能够了解 JWT 的实现原理 ◆ 大事件项目初始化 ◆ 大事件注册新用户功能 2.  web 开发模式2.1  主流的两种开发模式  基于服务端渲染的传统 Web 开发模式  基于前后端分离的新型 Web 开发模式  2.2 了解服务端渲染的概念以及优缺点  服务端渲染的概念：服务器发送给客户端">
<meta property="og:type" content="article">
<meta property="og:title" content="Node 第 6 天笔记">
<meta property="og:url" content="https://smanman.github.io/post/c6a3a65e.html">
<meta property="og:site_name" content="满天鑫">
<meta property="og:description" content="Node 第 6 天1.  学习目标◆ 前后端的身份认证 ◆ 能够了解 Session 的实现原理 ◆ 能够了解 JWT 的实现原理 ◆ 大事件项目初始化 ◆ 大事件注册新用户功能 2.  web 开发模式2.1  主流的两种开发模式  基于服务端渲染的传统 Web 开发模式  基于前后端分离的新型 Web 开发模式  2.2 了解服务端渲染的概念以及优缺点  服务端渲染的概念：服务器发送给客户端">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212035.jpg">
<meta property="article:published_time" content="2021-11-19T14:42:00.000Z">
<meta property="article:modified_time" content="2022-11-27T09:16:38.946Z">
<meta property="article:author" content="满天鑫">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="Node">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212035.jpg"><link rel="shortcut icon" href="https://lvxueyangboke.oss-cn-beijing.aliyuncs.com/images/20210805191028.png"><link rel="canonical" href="https://smanman.github.io/post/c6a3a65e"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Node 第 6 天笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 17:16:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/ali_icon.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mogai.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="满天鑫" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202406071141762.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">38</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212035.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">满天鑫</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouyex"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-zuixinwenzhang_huaban"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw iconfont icon-shenghuo"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/timeline/"><i class="fa-fw iconfont icon-shijianzhou"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-gerenzhongxin"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Node 第 6 天笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-19T14:42:00.000Z" title="发表于 2021-11-19 22:42:00">2021-11-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-27T09:16:38.946Z" title="更新于 2022-11-27 17:16:38">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/Node/">Node</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>42分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Node 第 6 天笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Node-第-6-天"><a href="#Node-第-6-天" class="headerlink" title="Node 第 6 天"></a>Node 第 6 天</h2><h3 id="1-学习目标"><a href="#1-学习目标" class="headerlink" title="1.  学习目标"></a>1.  学习目标</h3><p>◆ 前后端的身份认证</p>
<p>◆ 能够了解 Session 的实现原理</p>
<p>◆ 能够了解 JWT 的实现原理</p>
<p>◆ 大事件项目初始化</p>
<p>◆ 大事件注册新用户功能</p>
<h3 id="2-web-开发模式"><a href="#2-web-开发模式" class="headerlink" title="2.  web 开发模式"></a>2.  web 开发模式</h3><h4 id="2-1-主流的两种开发模式"><a href="#2-1-主流的两种开发模式" class="headerlink" title="2.1  主流的两种开发模式"></a>2.1  主流的两种开发模式</h4><ol>
<li> 基于<strong>服务端渲染</strong>的传统 Web 开发模式</li>
<li> 基于<strong>前后端分离</strong>的新型 Web 开发模式</li>
</ol>
<h4 id="2-2-了解服务端渲染的概念以及优缺点"><a href="#2-2-了解服务端渲染的概念以及优缺点" class="headerlink" title="2.2 了解服务端渲染的概念以及优缺点"></a>2.2 了解服务端渲染的概念以及优缺点</h4><ol>
<li> 服务端渲染的概念：服务器发送给客户端的 <code>HTML</code> 页面，是在<strong>服务器通过字符串的拼接动态生成的</strong>。因此，客户端不需要使用 Ajax 这样的技术额外请求页面的数据</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200314.png" style="zoom:67%;" />

   

<ol start="2">
<li> 服务端渲染的优点</li>
</ol>
<ul>
<li><p><strong>前端耗时少</strong>。因为服务器端负责动态生成 HTML 内容，浏览器只需要直接渲染页面即可。尤其是移动端，更省电</p>
</li>
<li><p><strong>有利于SEO</strong>。因为服务器端响应的是完整的 HTML 页面内容，所以爬虫更容易爬取获得信息，更有利于SEO</p>
</li>
</ul>
<ol start="3">
<li><p>服务端渲染的缺点</p>
<ul>
<li><strong>占用服务器端资源</strong>。即服务器端完成 HTML 页面内容的拼接，如果请求较多，会对服务器造成一定的访问压力</li>
<li><strong>不利于前后端分离，开发效率低</strong>。使用服务器端渲染，则无法进行分工合作，尤其对于前端复杂度高的项目，不利于项目高效开发</li>
</ul>
</li>
</ol>
<h4 id="2-3-了解前后端分离的概念以及优缺点"><a href="#2-3-了解前后端分离的概念以及优缺点" class="headerlink" title="2.3 了解前后端分离的概念以及优缺点"></a>2.3 了解前后端分离的概念以及优缺点</h4><ol>
<li><p> 前后端分离的概念：前后端分离的开发模式，<strong>依赖于 Ajax 技术的广泛应用</strong>。简而言之，前后端分离的 Web 开发模式，就是<strong>后端只负责提供 API 接口，前端使用 Ajax 调用接口</strong>的开发模式</p>
</li>
<li><p> 前后端分离的优点</p>
</li>
</ol>
<ul>
<li><p><strong>开发体验好</strong>。前端专注于 UI 页面的开发，后端专注于api 的开发，且前端有更多的选择性</p>
</li>
<li><p><strong>用户体验好</strong>。Ajax 技术的广泛应用，极大的提高了用户的体验，可以轻松实现页面的局部刷新</p>
</li>
<li><p><strong>减轻了服务器端的渲染压力</strong>。因为页面最终是在每个用户的浏览器中生成的</p>
</li>
</ul>
<ol start="3">
<li> 前后端分离的缺点</li>
</ol>
<ul>
<li><strong>不利于 SEO</strong>。因为完整的 HTML 页面需要在客户端动态拼接完成，所以爬虫对无法爬取页面的有效信息。（解决方案：利用 Vue、React 等前端框架的 <strong>SSR</strong> 技术能够很好的解决 SEO 问题！）</li>
</ul>
<h4 id="2-4-如何选择-Web-开发模式"><a href="#2-4-如何选择-Web-开发模式" class="headerlink" title="2.4 如何选择 Web 开发模式"></a>2.4 如何选择 Web 开发模式</h4><ol>
<li>  <strong>不谈业务场景而盲目选择使用何种开发模式都是耍流氓</strong></li>
</ol>
<ul>
<li><p>比如企业级网站，主要功能是展示而没有复杂的交互，并且需要良好的 <code>SEO</code>，则这时我们就需要使用服务器端渲染</p>
</li>
<li><p>而类似后台管理项目，交互性比较强，不需要考虑 <code>SEO</code>，那么就可以使用前后端分离的开发模式</p>
</li>
</ul>
<ol start="2">
<li> 另外，具体使用何种开发模式并不是绝对的，为了<strong>同时兼顾</strong>了<strong>首页的渲染速度</strong>和<strong>前后端分离的开发效率</strong>，一些网站采用了首屏服务器端渲染 + 其他页面前后端分离的开发模式</li>
</ol>
<h3 id="3-身份认证"><a href="#3-身份认证" class="headerlink" title="3.  身份认证"></a>3.  身份认证</h3><h4 id="3-1-什么是身份认证"><a href="#3-1-什么是身份认证" class="headerlink" title="3.1  什么是身份认证"></a>3.1  什么是身份认证</h4><ol>
<li> 身份认证，又称 ”身份验证“，”鉴权“，是指通过一定的手段，完成对用户身份的确认，例如：</li>
</ol>
<ul>
<li>各大网站的手机验证码登录</li>
<li>邮箱密码登录</li>
<li>二维码登录</li>
</ul>
<h4 id="3-2-为什么需要身份认证"><a href="#3-2-为什么需要身份认证" class="headerlink" title="3.2 为什么需要身份认证"></a>3.2 为什么需要身份认证</h4><ol>
<li> 身份认证的目的，是为了<strong>确认当前所声称为某种身份的用户，确实是所声称的用户</strong></li>
</ol>
<ul>
<li>例如：你去找快递员取快递，你要怎么证明这份快递是你的</li>
</ul>
<ol start="2">
<li> 不同开发模式下的身份认证</li>
</ol>
<ul>
<li>对于<strong>服务端渲染</strong>和<strong>前后端分离</strong>这两种开发模式来说，分别有着不同的身份认证方案<ul>
<li><strong>服务端渲染</strong> 推荐使用 <strong>Session 认证机制</strong></li>
<li><strong>前后端分离</strong>推荐使用 <strong>JWT 认证机制</strong></li>
</ul>
</li>
</ul>
<h3 id="4-session"><a href="#4-session" class="headerlink" title="4.  session"></a>4.  session</h3><h4 id="4-1-了解-HTTP-协议的无状态性"><a href="#4-1-了解-HTTP-协议的无状态性" class="headerlink" title="4.1 了解 HTTP 协议的无状态性"></a>4.1 了解 HTTP 协议的无状态性</h4><ol>
<li><p>HTTP 协议的无状态性，指的是客户端的<strong>每次 HTTP 请求都是独立的</strong>，连续多个请求之间没有直接的关系，<strong>服务器不会主动保留每次 HTTP 请求的状态</strong></p>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200335.png" style="zoom:67%;" /></li>
</ol>
<h4 id="4-2-如何突破-HTTP-无状态的限制"><a href="#4-2-如何突破-HTTP-无状态的限制" class="headerlink" title="4.2 如何突破 HTTP 无状态的限制"></a>4.2 如何突破 HTTP 无状态的限制</h4><ol>
<li><p>对于超市来说，为了方便收银员在进行结算时给 <code>VIP</code> 用户打折，超市可以为每个 <code>VIP</code> 用户发放会员卡</p>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200337.png" style="zoom:67%;" /></li>
<li><p>注意：现实生活中的会员卡身份认证方式，在 <code>Web</code> 开发中的专业术语叫做 <code>Cookie</code></p>
</li>
</ol>
<h4 id="4-3-什么是-Cookie"><a href="#4-3-什么是-Cookie" class="headerlink" title="4.3 什么是 Cookie"></a>4.3 什么是 Cookie</h4><ol>
<li> <code>Cookie</code> 是<strong>存储在用户浏览器中的一段不超过 4 KB 的字符串</strong>。它由一个<strong>名称</strong>（Name）、一个<strong>值</strong>（Value）和其它几个用于控制 Cookie <strong>有效期</strong>、<strong>安全性</strong>、<strong>使用范围</strong>的<strong>可选属性</strong>组成</li>
<li> 不同域名下的 Cookie 各自独立，每当客户端发起请求时，会<strong>自动</strong>把<strong>当前域名下</strong>所有<strong>未过期的 Cookie</strong> 一同发送到服务器</li>
<li> <code>Cookie</code> 的几大特性</li>
</ol>
<ul>
<li>自动发送</li>
<li>域名独立</li>
<li>过期时限</li>
<li>4KB 限制</li>
</ul>
<h4 id="4-4-Cookie-在身份认证中的作用"><a href="#4-4-Cookie-在身份认证中的作用" class="headerlink" title="4.4 Cookie 在身份认证中的作用"></a>4.4 Cookie 在身份认证中的作用</h4><ol>
<li><p> 客户端第一次请求服务器的时候，服务器通过响应头的形式，向客户端发送一个身份认证的 <code>Cookie</code>，客户端会自动将 <code>Cookie</code> 保存在浏览器中。</p>
</li>
<li><p> 随后，当客户端浏览器每次请求服务器的时候，浏览器会自动将身份认证相关的 <code>Cookie</code>，通过请求头的形式发送给服务器，服务器即可验明客户端的身份</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200340.png" style="zoom:67%;" />



<h4 id="4-5-Cookie-不具有安全性"><a href="#4-5-Cookie-不具有安全性" class="headerlink" title="4.5  Cookie 不具有安全性"></a>4.5  Cookie 不具有安全性</h4><ol>
<li><p>由于 <code>Cookie</code> 是存储在浏览器中的，而且浏览器也提供了读写 <code>Cookie</code> 的 <code>API</code>，因此 <code>Cookie</code> 很容易被伪造，不具有安全性。因此不建议服务器将重要的隐私数据通过 <code>Cookie</code> 的形式发送给浏览器</p>
</li>
<li><p> <strong>注意：千万不要使用 Cookie 存储重要且隐私的数据！</strong> 比如用户的身份信息、密码等</p>
</li>
</ol>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200343.png" style="zoom:67%;" />



<h4 id="4-6-提高身份认证的安全性"><a href="#4-6-提高身份认证的安全性" class="headerlink" title="4.6 提高身份认证的安全性"></a>4.6 提高身份认证的安全性</h4><ol>
<li> 为了防止客户伪造会员卡，收银员在拿到客户出示的会员卡之后，可以在收银机上进行刷卡认证。只有收银机确认存在的会员卡，才能被正常使用</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200354.png" style="zoom:67%;" />

   
   
<ol start="2">
<li> 这种“会员卡 + 刷卡认证”的设计理念，就是 <code>Session</code> 认证机制的精髓</li>
</ol>
<h4 id="4-7-Session-的工作原理"><a href="#4-7-Session-的工作原理" class="headerlink" title="4.7 Session 的工作原理"></a>4.7 Session 的工作原理</h4><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200358.png" style="zoom:67%;" />

<h4 id="4-8-安装并-express-session-中间件"><a href="#4-8-安装并-express-session-中间件" class="headerlink" title="4.8 安装并 express-session 中间件"></a>4.8 安装并 express-session 中间件</h4><ol>
<li> 安装 <code>express-session</code></li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i express-session</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 配置 <code>express-session</code> 中间件</li>
</ol>
<ul>
<li><p><code>express-session</code> 中间件安装成功后，需要通过 <code>app.use()</code> 来注册 <code>session</code> 中间件</p>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200408.png" style="zoom:67%;" /></li>
</ul>
<ol start="3">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：请配置 Session 中间件</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;itheima&#x27;</span>,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的 API 接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户姓名的接口</span></span><br><span class="line">app.get(<span class="string">&#x27;/api/username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出登录的接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-9-向-session-中存数据"><a href="#4-9-向-session-中存数据" class="headerlink" title="4.9  向 session 中存数据"></a>4.9  向 session 中存数据</h4><ol>
<li><p> 当 <code>express-session</code> 中间件配置成功后，即可通过 <code>req.session</code> 来访问和使用 <code>session</code> 对象，从而存储用户的关键信息</p>
</li>
<li><p> 示例</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200413.png" style="zoom: 80%;" />

   
   
<ol start="3">
<li><p>案例代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：请配置 Session 中间件</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;itheima&#x27;</span>,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的 API 接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断用户提交的登录信息是否正确</span></span><br><span class="line">  <span class="keyword">if</span> (req.body.username !== <span class="string">&#x27;admin&#x27;</span> || req.body.password !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录失败&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO_02：请将登录成功后的用户信息，保存到 Session 中</span></span><br><span class="line">  <span class="comment">// 注意：只有成功配置了 express-session 这个中间件之后，才能够通过 req 点出来 session 这个属性</span></span><br><span class="line">  req.session.user = req.body <span class="comment">// 用户的信息</span></span><br><span class="line">  req.session.islogin = <span class="literal">true</span> <span class="comment">// 用户的登录状态</span></span><br><span class="line"></span><br><span class="line">  res.send(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录成功&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户姓名的接口</span></span><br><span class="line">app.get(<span class="string">&#x27;/api/username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出登录的接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="4-10-从-session-中取数据"><a href="#4-10-从-session-中取数据" class="headerlink" title="4.10 从 session 中取数据"></a>4.10 从 session 中取数据</h4><ol>
<li><p> 可以直接从 <code>req.session</code> 对象上获取之前存储的数据</p>
</li>
<li><p> 示例</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200421.png" style="zoom:80%;" />

   
   
<ol start="3">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：请配置 Session 中间件</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;itheima&#x27;</span>,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的 API 接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断用户提交的登录信息是否正确</span></span><br><span class="line">  <span class="keyword">if</span> (req.body.username !== <span class="string">&#x27;admin&#x27;</span> || req.body.password !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录失败&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO_02：请将登录成功后的用户信息，保存到 Session 中</span></span><br><span class="line">  <span class="comment">// 注意：只有成功配置了 express-session 这个中间件之后，才能够通过 req 点出来 session 这个属性</span></span><br><span class="line">  req.session.user = req.body <span class="comment">// 用户的信息</span></span><br><span class="line">  req.session.islogin = <span class="literal">true</span> <span class="comment">// 用户的登录状态</span></span><br><span class="line"></span><br><span class="line">  res.send(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录成功&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户姓名的接口</span></span><br><span class="line">app.get(<span class="string">&#x27;/api/username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// TODO_03：请从 Session 中获取用户的名称，响应给客户端</span></span><br><span class="line">  <span class="keyword">if</span> (!req.session.islogin) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;fail&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: req.session.user.username,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出登录的接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-11-清空-session"><a href="#4-11-清空-session" class="headerlink" title="4.11 清空 session"></a>4.11 清空 session</h4><ol>
<li><p> 调用 <code>req.session.destroy()</code> 函数，即可清空服务器保存的 <code>session</code> 信息</p>
</li>
<li><p> 实例</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119201011.png" style="zoom:80%;" />

   
   
<ol start="3">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：请配置 Session 中间件</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>)</span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;itheima&#x27;</span>,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的 API 接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 判断用户提交的登录信息是否正确</span></span><br><span class="line">  <span class="keyword">if</span> (req.body.username !== <span class="string">&#x27;admin&#x27;</span> || req.body.password !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录失败&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO_02：请将登录成功后的用户信息，保存到 Session 中</span></span><br><span class="line">  <span class="comment">// 注意：只有成功配置了 express-session 这个中间件之后，才能够通过 req 点出来 session 这个属性</span></span><br><span class="line">  req.session.user = req.body <span class="comment">// 用户的信息</span></span><br><span class="line">  req.session.islogin = <span class="literal">true</span> <span class="comment">// 用户的登录状态</span></span><br><span class="line"></span><br><span class="line">  res.send(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;登录成功&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户姓名的接口</span></span><br><span class="line">app.get(<span class="string">&#x27;/api/username&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// TODO_03：请从 Session 中获取用户的名称，响应给客户端</span></span><br><span class="line">  <span class="keyword">if</span> (!req.session.islogin) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;fail&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: req.session.user.username,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出登录的接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// TODO_04：清空 Session 信息</span></span><br><span class="line">  req.session.destroy()</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;退出登录成功&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="4-12-演示-session-案例效果"><a href="#4-12-演示-session-案例效果" class="headerlink" title="4.12 演示 session 案例效果"></a>4.12 演示 session 案例效果</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html 页面 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>后台主页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btnLogin&quot;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化方法</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">url</span>: <span class="string">&#x27;/api/username&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">type</span>: <span class="string">&#x27;get&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// console.log(data)</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!data.status) &#123;</span></span><br><span class="line"><span class="javascript">              alert(<span class="string">&#x27;欢迎登录：&#x27;</span> + data.username)</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              alert(<span class="string">&#x27;您尚未登录，请登录后在执行此操作！&#x27;</span>)</span></span><br><span class="line"><span class="javascript">              <span class="built_in">window</span>.location.href = <span class="string">&#x27;/login.html&#x27;</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      init()</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 退出登录</span></span></span><br><span class="line"><span class="javascript">      $(<span class="string">&#x27;#btnLogin&#x27;</span>).click(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">url</span>: <span class="string">&#x27;/api/logout&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">type</span>: <span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!data.status) &#123;</span></span><br><span class="line"><span class="javascript">              alert(data.msg)</span></span><br><span class="line"><span class="javascript">              <span class="built_in">window</span>.location.href = <span class="string">&#x27;/login.html&#x27;</span></span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">      &#125;)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- login.html 页面 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 登录表单 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>账号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">&#x27;button&#x27;</span>).click(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 阻止默认行为</span></span></span><br><span class="line"><span class="javascript">        e.preventDefault()</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 获取需要传递的参数</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> params = $(<span class="string">&#x27;#form1&#x27;</span>).serialize()</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 发送 ajax </span></span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">url</span>: <span class="string">&#x27;/api/login&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">type</span>: <span class="string">&#x27;post&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="attr">data</span>: params,</span></span><br><span class="line"><span class="javascript">          <span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.location.href = <span class="string">&#x27;/index.html&#x27;</span></span></span><br><span class="line"><span class="javascript">          &#125;</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">      &#125;)</span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-jwt"><a href="#5-jwt" class="headerlink" title="5.  jwt"></a>5.  jwt</h3><h4 id="5-1-了解-Session-认证的局限性"><a href="#5-1-了解-Session-认证的局限性" class="headerlink" title="5.1  了解 Session 认证的局限性"></a>5.1  了解 Session 认证的局限性</h4><ol>
<li> <code>Session</code> 认证机制需要配合 <code>Cookie</code> 才能实现。由于 <code>Cookie</code> 默认不支持跨域访问，所以，当涉及到前端跨域请求后端接口的时候，需要做很多额外的配置，才能实现跨域 <code>Session</code> 认证</li>
<li> 注意：</li>
</ol>
<ul>
<li>当前端请求后端接口<strong>不存在跨域问题</strong>的时候，<strong>推荐使用 Session</strong> 身份认证机制</li>
<li>前端<strong>需要跨域请求后端接口</strong>的时候，不推荐使用 Session 身份认证机制，<strong>推荐使用 JWT 认证机制</strong></li>
</ul>
<ol start="3">
<li> 什么是 JWT</li>
</ol>
<ul>
<li><code>JWT</code>（英文全称：<code>JSON Web Token</code>）是目前最流行的跨域认证解决方案</li>
</ul>
<h4 id="5-2-JWT-的工作原理"><a href="#5-2-JWT-的工作原理" class="headerlink" title="5.2  JWT 的工作原理"></a>5.2  JWT 的工作原理</h4><ol>
<li> 用户的信息通过 <code>Token</code> 字符串的形式，保存在客户端浏览器中</li>
<li> 服务器通过还原 <code>Token</code> 字符串的形式来认证用户的身份</li>
</ol>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200525.png" style="zoom:80%;" />

<h4 id="5-3-JWT-的组成部分"><a href="#5-3-JWT-的组成部分" class="headerlink" title="5.3  JWT 的组成部分"></a>5.3  JWT 的组成部分</h4><ol>
<li><p> <code>JWT</code> 通常由三部分组成，分别是 <code>Header</code>（头部）、<code>Payload</code>（有效荷载）、<code>Signature</code>（签名）</p>
</li>
<li><p> 三者之间使用英文的“.”分隔，格式如下</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200958.png" style="zoom:67%;" />

<ol start="3">
<li> 下面是 <code>JWT</code> 字符串的示例</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200630.png" style="zoom: 67%;" />



<ol start="4">
<li> <code>JWT</code> 的三个组成部分，从前到后分别是 <code>Header</code>、<code>Payload</code>、<code>Signature</code></li>
</ol>
<ul>
<li><p><code>Payload</code> 部分才是真正的用户信息，它是用户信息经过加密之后生成的字符串</p>
</li>
<li><p><code>Header</code> 和 <code>Signature</code> 是安全性相关的部分，只是为了保证 <code>Token</code> 的安全性</p>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200521.png" style="zoom:80%;" /></li>
</ul>
<h4 id="5-4-JWT-的使用方式"><a href="#5-4-JWT-的使用方式" class="headerlink" title="5.4  JWT 的使用方式"></a>5.4  JWT 的使用方式</h4><ol>
<li><p> 客户端收到服务器返回的 <code>JWT</code> 之后，通常会将它储存在 <code>localStorage</code> 或 <code>sessionStorage</code> 中</p>
</li>
<li><p> 此后，客户端每次与服务器通信，都要带上这个 <code>JWT</code> 的字符串，从而进行身份认证。推荐的做法是把<code> JWT</code> 放在 <code>HTTP</code> 请求头的 <code>Authorization</code> 字段中</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200519.png" style="zoom:67%;" />

<h4 id="5-5-安装并导入-JWT-相关的包"><a href="#5-5-安装并导入-JWT-相关的包" class="headerlink" title="5.5 安装并导入 JWT 相关的包"></a>5.5 安装并导入 JWT 相关的包</h4><h5 id="5-5-1-安装-JWT-相关的包"><a href="#5-5-1-安装-JWT-相关的包" class="headerlink" title="5.5.1 安装 JWT 相关的包"></a>5.5.1 安装 JWT 相关的包</h5><ol>
<li> 运行如下命令，安装如下两个 JWT 相关的包</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i jsonwebtoken express-jwt</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 其中</li>
</ol>
<ul>
<li><code>jsonwebtoken</code> 用于生成 <code>JWT</code> 字符串</li>
<li><code>express-jwt</code> 用于将 <code>JWT</code> 字符串解析还原成 <code>JSON</code> 对象</li>
</ul>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200949.png" style="zoom:67%;" />

<h5 id="5-5-2-导入-JWT-相关的包"><a href="#5-5-2-导入-JWT-相关的包" class="headerlink" title="5.5.2  导入 JWT 相关的包"></a>5.5.2  导入 JWT 相关的包</h5><ol>
<li><p>使用 <code>require()</code> 函数，分别导入 <code>JWT</code> 相关的两个包</p>
</li>
<li><p>实例</p>
<img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200947.png" style="zoom:67%;" /></li>
<li><p> 案例代码</p>
</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：安装并导入 JWT 相关的两个包，分别是 jsonwebtoken 和 express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域资源共享</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="5-6-定义-secret-密钥"><a href="#5-6-定义-secret-密钥" class="headerlink" title="5.6  定义 secret 密钥"></a>5.6  定义 secret 密钥</h4><ol>
<li> 为了保证 <code>JWT</code>字符串的安全性，防止 JWT 字符串在网络传输过程中被别人破解，我们需要专门定义一个用于加密和解密的 <code>secret</code> 密钥</li>
</ol>
<ul>
<li><p>当生成 <code>JWT</code> 字符串的时候，需要使用 <code>secret</code> 密钥对用户信息进行加密，最终得到加密好的 JWT 字符串</p>
</li>
<li><p>当把 <code>JWT</code> 字符串解析还原成 <code>JSON</code> 对象的时候，需要使用 <code>secret</code> 密钥进行解密</p>
</li>
</ul>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200928.png" style="zoom:67%;" />
   
<ol start="2">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：安装并导入 JWT 相关的两个包，分别是 jsonwebtoken 和 express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域资源共享</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_02：定义 secret 密钥，建议将密钥命名为 secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;itheima No1 ^_^&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-7-在登录成功后生成-JWT-字符串"><a href="#5-7-在登录成功后生成-JWT-字符串" class="headerlink" title="5.7  在登录成功后生成 JWT 字符串"></a>5.7  在登录成功后生成 JWT 字符串</h4><ol>
<li><p> 调用 <code>jsonwebtoken</code> 包提供的 <code>sign()</code> 方法，将用户的信息加密成 <code>JWT</code> 字符串，响应给客户端</p>
</li>
<li><p> 示例</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200934.png" style="zoom:67%;" />

<ol start="3">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：安装并导入 JWT 相关的两个包，分别是 jsonwebtoken 和 express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域资源共享</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_02：定义 secret 密钥，建议将密钥命名为 secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;itheima No1 ^_^&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将 req.body 请求体中的数据，转存为 userinfo 常量</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.body</span><br><span class="line">  <span class="comment">// 登录失败</span></span><br><span class="line">  <span class="keyword">if</span> (userinfo.username !== <span class="string">&#x27;admin&#x27;</span> || userinfo.password !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;登录失败！&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 登录成功</span></span><br><span class="line">  <span class="comment">// TODO_03：在登录成功之后，调用 jwt.sign() 方法生成 JWT 字符串。并通过 token 属性发送给客户端</span></span><br><span class="line">  <span class="comment">// 参数1：用户的信息对象</span></span><br><span class="line">  <span class="comment">// 参数2：加密的秘钥</span></span><br><span class="line">  <span class="comment">// 参数3：配置对象，可以配置当前 token 的有效期</span></span><br><span class="line">  <span class="comment">// 记住：千万不要把密码加密到 token 字符中</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = jwt.sign(&#123; <span class="attr">username</span>: userinfo.username &#125;, secretKey, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;30s&#x27;</span> &#125;)</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: tokenStr, <span class="comment">// 要发送给客户端的 token 字符串</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="5-8-将-JWT-字符串还原为-JSON-对象"><a href="#5-8-将-JWT-字符串还原为-JSON-对象" class="headerlink" title="5.8  将 JWT 字符串还原为 JSON 对象"></a>5.8  将 JWT 字符串还原为 JSON 对象</h4><ol>
<li><p> 客户端每次在访问那些有权限接口的时候，都需要主动通过请求头中的 <code>Authorization</code> 字段，将 <code>Token</code> 字符串发送到服务器进行身份认证</p>
</li>
<li><p> 此时，服务器可以通过 <code>express-jwt</code> 这个中间件，自动将客户端发送过来的  <code>Token</code> 解析还原成 <code>JSON</code> 对象</p>
</li>
<li><p> 示例</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200909.png" style="zoom:67%;" />

<ol start="4">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：安装并导入 JWT 相关的两个包，分别是 jsonwebtoken 和 express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域资源共享</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_02：定义 secret 密钥，建议将密钥命名为 secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;itheima No1 ^_^&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_04：注册将 JWT 字符串解析还原成 JSON 对象的中间件</span></span><br><span class="line"><span class="comment">// 注意：只要配置成功了 express-jwt 这个中间件，就可以把解析出来的用户信息，挂载到 req.user 属性上</span></span><br><span class="line">app.use(expressJWT(&#123; <span class="attr">secret</span>: secretKey &#125;).unless(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将 req.body 请求体中的数据，转存为 userinfo 常量</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.body</span><br><span class="line">  <span class="comment">// 登录失败</span></span><br><span class="line">  <span class="keyword">if</span> (userinfo.username !== <span class="string">&#x27;admin&#x27;</span> || userinfo.password !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;登录失败！&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 登录成功</span></span><br><span class="line">  <span class="comment">// TODO_03：在登录成功之后，调用 jwt.sign() 方法生成 JWT 字符串。并通过 token 属性发送给客户端</span></span><br><span class="line">  <span class="comment">// 参数1：用户的信息对象</span></span><br><span class="line">  <span class="comment">// 参数2：加密的秘钥</span></span><br><span class="line">  <span class="comment">// 参数3：配置对象，可以配置当前 token 的有效期</span></span><br><span class="line">  <span class="comment">// 记住：千万不要把密码加密到 token 字符中</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = jwt.sign(&#123; <span class="attr">username</span>: userinfo.username &#125;, secretKey, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;30s&#x27;</span> &#125;)</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: tokenStr, <span class="comment">// 要发送给客户端的 token 字符串</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="5-9-使用-req-user-获取用户信息"><a href="#5-9-使用-req-user-获取用户信息" class="headerlink" title="5.9  使用 req.user 获取用户信息"></a>5.9  使用 req.user 获取用户信息</h4><ol>
<li><p> 当 <code>express-jwt</code> 这个中间件配置成功之后，即可在那些有权限的接口中，使用 <code>req.user</code> 对象，来访问从 <code>JWT</code> 字符串中解析出来的用户信息了</p>
</li>
<li><p> 实例</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200900.png" style="zoom:67%;" />

<ol start="3">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：安装并导入 JWT 相关的两个包，分别是 jsonwebtoken 和 express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域资源共享</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_02：定义 secret 密钥，建议将密钥命名为 secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;itheima No1 ^_^&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_04：注册将 JWT 字符串解析还原成 JSON 对象的中间件</span></span><br><span class="line"><span class="comment">// 注意：只要配置成功了 express-jwt 这个中间件，就可以把解析出来的用户信息，挂载到 req.user 属性上</span></span><br><span class="line">app.use(expressJWT(&#123; <span class="attr">secret</span>: secretKey &#125;).unless(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将 req.body 请求体中的数据，转存为 userinfo 常量</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.body</span><br><span class="line">  <span class="comment">// 登录失败</span></span><br><span class="line">  <span class="keyword">if</span> (userinfo.username !== <span class="string">&#x27;admin&#x27;</span> || userinfo.password !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;登录失败！&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 登录成功</span></span><br><span class="line">  <span class="comment">// TODO_03：在登录成功之后，调用 jwt.sign() 方法生成 JWT 字符串。并通过 token 属性发送给客户端</span></span><br><span class="line">  <span class="comment">// 参数1：用户的信息对象</span></span><br><span class="line">  <span class="comment">// 参数2：加密的秘钥</span></span><br><span class="line">  <span class="comment">// 参数3：配置对象，可以配置当前 token 的有效期</span></span><br><span class="line">  <span class="comment">// 记住：千万不要把密码加密到 token 字符中</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = jwt.sign(&#123; <span class="attr">username</span>: userinfo.username &#125;, secretKey, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;30s&#x27;</span> &#125;)</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: tokenStr, <span class="comment">// 要发送给客户端的 token 字符串</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个有权限的 API 接口</span></span><br><span class="line">app.get(<span class="string">&#x27;/admin/getinfo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// TODO_05：使用 req.user 获取用户信息，并使用 data 属性将用户信息发送给客户端</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.user)</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取用户信息成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: req.user, <span class="comment">// 要发送给客户端的用户信息</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-10-捕获解析-JWT-失败后产生的错误"><a href="#5-10-捕获解析-JWT-失败后产生的错误" class="headerlink" title="5.10 捕获解析 JWT 失败后产生的错误"></a>5.10 捕获解析 JWT 失败后产生的错误</h4><ol>
<li><p> 当使用 <code>express-jwt</code> 解析 <code>Token</code> 字符串时，如果客户端发送过来的 <code>Token</code> 字符串过期或不合法，会产生一个解析失败的错误，影响项目的正常运行</p>
</li>
<li><p> 可以通过 <code>Express</code> 的错误中间件，捕获这个错误并进行相关的处理</p>
</li>
<li><p> 示例</p>
</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200848.png" style="zoom: 80%;" />

<ol start="4">
<li> 案例代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_01：安装并导入 JWT 相关的两个包，分别是 jsonwebtoken 和 express-jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> expressJWT = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许跨域资源共享</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管静态页面</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./pages&#x27;</span>))</span><br><span class="line"><span class="comment">// 解析 POST 提交过来的表单数据</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_02：定义 secret 密钥，建议将密钥命名为 secretKey</span></span><br><span class="line"><span class="keyword">const</span> secretKey = <span class="string">&#x27;itheima No1 ^_^&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_04：注册将 JWT 字符串解析还原成 JSON 对象的中间件</span></span><br><span class="line"><span class="comment">// 注意：只要配置成功了 express-jwt 这个中间件，就可以把解析出来的用户信息，挂载到 req.user 属性上</span></span><br><span class="line">app.use(expressJWT(&#123; <span class="attr">secret</span>: secretKey &#125;).unless(&#123; <span class="attr">path</span>: [<span class="regexp">/^\/api\//</span>] &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line">app.post(<span class="string">&#x27;/api/login&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 将 req.body 请求体中的数据，转存为 userinfo 常量</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.body</span><br><span class="line">  <span class="comment">// 登录失败</span></span><br><span class="line">  <span class="keyword">if</span> (userinfo.username !== <span class="string">&#x27;admin&#x27;</span> || userinfo.password !== <span class="string">&#x27;000000&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;登录失败！&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 登录成功</span></span><br><span class="line">  <span class="comment">// TODO_03：在登录成功之后，调用 jwt.sign() 方法生成 JWT 字符串。并通过 token 属性发送给客户端</span></span><br><span class="line">  <span class="comment">// 参数1：用户的信息对象</span></span><br><span class="line">  <span class="comment">// 参数2：加密的秘钥</span></span><br><span class="line">  <span class="comment">// 参数3：配置对象，可以配置当前 token 的有效期</span></span><br><span class="line">  <span class="comment">// 记住：千万不要把密码加密到 token 字符中</span></span><br><span class="line">  <span class="keyword">const</span> tokenStr = jwt.sign(&#123; <span class="attr">username</span>: userinfo.username &#125;, secretKey, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;30s&#x27;</span> &#125;)</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>: tokenStr, <span class="comment">// 要发送给客户端的 token 字符串</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个有权限的 API 接口</span></span><br><span class="line">app.get(<span class="string">&#x27;/admin/getinfo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// TODO_05：使用 req.user 获取用户信息，并使用 data 属性将用户信息发送给客户端</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.user)</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;获取用户信息成功！&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: req.user, <span class="comment">// 要发送给客户端的用户信息</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO_06：使用全局错误处理中间件，捕获解析 JWT 失败后产生的错误</span></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这次错误是由 token 解析失败导致的</span></span><br><span class="line">  <span class="keyword">if</span> (err.name === <span class="string">&#x27;UnauthorizedError&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123;</span><br><span class="line">      <span class="attr">status</span>: <span class="number">401</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;无效的token&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.send(&#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;未知的错误&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.listen(<span class="number">80</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Express server running at http://127.0.0.1:80&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="6-项目初始化"><a href="#6-项目初始化" class="headerlink" title="6. 项目初始化"></a>6. 项目初始化</h3><h4 id="6-1-项目概述"><a href="#6-1-项目概述" class="headerlink" title="6.1  项目概述"></a>6.1  项目概述</h4><ol>
<li> <a target="_blank" rel="noopener" href="http://www.escook.cn:8088/#/">在线笔记与文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.showdoc.cc/escook?page_id=3707158761215217">需要完成的大事件功能</a></li>
<li>本地笔记与文档，在 <code>ppt</code> 文件夹中，<code>ev_api_server.pdf</code></li>
</ol>
<h4 id="6-2-创建项目"><a href="#6-2-创建项目" class="headerlink" title="6.2 创建项目"></a>6.2 创建项目</h4><ol>
<li> 新建  <code>api_server</code> 文件夹作为项目根目录，并在项目根目录中运行如下的命令，初始化包管理配置文件</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 运行如下的命令，安装特定版本的  <code>express</code></li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i express@<span class="number">4.17</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 在项目根目录中新建  <code>app.js</code> 作为整个项目的入口文件，并初始化如下的代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在此处进行功能开发</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定端口并启动 web 服务器</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;api server running at http://127.0.0.1:8000&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="6-3-配置-cors-跨域和解析表单数据的中间件"><a href="#6-3-配置-cors-跨域和解析表单数据的中间件" class="headerlink" title="6.3 配置 cors 跨域和解析表单数据的中间件"></a>6.3 配置 cors 跨域和解析表单数据的中间件</h4><h5 id="6-3-1-配置-cors-跨域"><a href="#6-3-1-配置-cors-跨域" class="headerlink" title="6.3.1 配置 cors 跨域"></a>6.3.1 配置 cors 跨域</h5><ol>
<li> 运行如下的命令，安装  <code>cors</code> 中间件</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cnpm i cors@<span class="number">2.8</span><span class="number">.5</span> --save</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 在  <code>app.js</code> 中导入并配置  <code>cors</code> 中间件</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 cors 中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line"><span class="comment">// 将 cors 注册为全局中间件</span></span><br><span class="line">app.use(cors)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定端口并启动 web 服务器</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;api server running at http://127.0.0.1:8000&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h5 id="6-3-2-配置解析表单数据的中间件"><a href="#6-3-2-配置解析表单数据的中间件" class="headerlink" title="6.3.2 配置解析表单数据的中间件"></a>6.3.2 配置解析表单数据的中间件</h5><ol>
<li> 配置解析 <code>application/x-www-form-urlencoded</code> 格式的表单数据的中间件</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 完整代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 cors 中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line"><span class="comment">// 将 cors 注册为全局中间件</span></span><br><span class="line">app.use(cors)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置解析 application/x-www-form-urlencoded 格式的表单数据的中间件</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定端口并启动 web 服务器</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;api server running at http://127.0.0.1:8000&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="6-4-初始化路由相关的文件夹"><a href="#6-4-初始化路由相关的文件夹" class="headerlink" title="6.4 初始化路由相关的文件夹"></a>6.4 初始化路由相关的文件夹</h4><ol>
<li> 在项目根目录中，新建  <code>router</code> 文件夹，用来存放所有的 路由 模块</li>
</ol>
<ul>
<li>路由模块中，只存放客户端的请求与处理函数之间的映射关系</li>
</ul>
<ol start="2">
<li> 在项目根目录中，新建  <code>router_handler</code> 文件夹，用来存放所有的  路由处理函数模块</li>
</ol>
<ul>
<li>路由处理函数模块中，专门负责存放每个路由对应的处理函数</li>
</ul>
<h4 id="6-5-初始化用户路由模块"><a href="#6-5-初始化用户路由模块" class="headerlink" title="6.5 初始化用户路由模块"></a>6.5 初始化用户路由模块</h4><ol>
<li> 在 <code>router</code> 文件夹中，新建 <code>user.js</code> 文件，作为用户的路由模块</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router --&gt; user.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.post(<span class="string">&#x27;/reguser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;reguser Ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Login Ok&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将路由对象共享出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>
<ol start="2">
<li> 在  <code>app.js</code> 中，导入并使用  用户路由模块</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 cors 中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line"><span class="comment">// 将 cors 注册为全局中间件</span></span><br><span class="line">app.use(cors)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置解析 application/x-www-form-urlencoded 格式的表单数据的中间件</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入并注册用户路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/user&#x27;</span>)</span><br><span class="line">app.use(<span class="string">&#x27;/api&#x27;</span>, userRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定端口并启动 web 服务器</span></span><br><span class="line">app.listen(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;api server running at http://127.0.0.1:8000&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h4 id="6-6-抽离用户路由模块中的处理函数"><a href="#6-6-抽离用户路由模块中的处理函数" class="headerlink" title="6.6  抽离用户路由模块中的处理函数"></a>6.6  抽离用户路由模块中的处理函数</h4><blockquote>
<p> 目的：为了保证  <strong>路由模块</strong> 的纯粹性，所有的  <strong>路由处理函数</strong> ，必须抽离到对应的  <strong>路由处理函数模块</strong> 中</p>
</blockquote>
<ol>
<li> 在  <code>/router_handler/user.js</code> 中，使用  <code>exports</code> 对象，分别向外共享如下两个路由处理函数</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义和用户相关的路由处理函数，功 /router/user.js 模块尽心调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.regUser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;reguser Ok&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.login = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;login Ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li> 将  <code>/router/user.js</code> 中的代码修改为如下结构</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userHandle = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.post(<span class="string">&#x27;/reguser&#x27;</span>, userHandle.regUser)</span><br><span class="line"><span class="comment">// 登录功能</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, userHandle.login)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将路由对象共享出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>

<h3 id="7-注册新用户"><a href="#7-注册新用户" class="headerlink" title="7.  注册新用户"></a>7.  注册新用户</h3><h4 id="7-1-创建用户表"><a href="#7-1-创建用户表" class="headerlink" title="7.1 创建用户表"></a>7.1 创建用户表</h4><ol>
<li> 在  <code>my_db_01</code> 数据库中，新建  <code>ev_users</code> 表</li>
</ol>
   <img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211119200811.png" style="zoom:80%;" />

   

<h4 id="7-2-安装配置-mysql-模块"><a href="#7-2-安装配置-mysql-模块" class="headerlink" title="7.2 安装配置 mysql 模块"></a>7.2 安装配置 mysql 模块</h4><blockquote>
<p>在 API 接口项目中，需要安装并配置  mysql 这个第三方模块，来连接和操作 MySQL 数据库</p>
</blockquote>
<ol>
<li> 安装 <code>mysql</code> 模块</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i mysql@<span class="number">2.18</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 在项目根目录中新建  <code>/db/index.js</code> 文件，在此自定义模块中创建数据库的连接对象</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 mysql 模块</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建数据库连接对象</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.createPool(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;my_db_01&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享 db 数据库连接对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = db</span><br></pre></td></tr></table></figure>


<h4 id="7-3-检测表单数据是否合法"><a href="#7-3-检测表单数据是否合法" class="headerlink" title="7.3 检测表单数据是否合法"></a>7.3 检测表单数据是否合法</h4><h5 id="7-3-1-注册功能实现步骤"><a href="#7-3-1-注册功能实现步骤" class="headerlink" title="7.3.1 注册功能实现步骤"></a>7.3.1 注册功能实现步骤</h5><ol>
<li> 检测表单数据是否合法</li>
<li> 检测用户名是否被占用</li>
<li> 对密码进行加密处理</li>
<li> 插入新用户</li>
</ol>
<h5 id="7-3-2-检测表单数据是否合法"><a href="#7-3-2-检测表单数据是否合法" class="headerlink" title="7.3.2 检测表单数据是否合法"></a>7.3.2 检测表单数据是否合法</h5><ol>
<li> 判断用户名和密码是否为空</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.regUser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取到客户端提高到服务器的用户信息</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.body</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对表单中的数据进行合法性校验</span></span><br><span class="line">  <span class="keyword">if</span> (!userinfo.username || !userinfo.password) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名和密码不正确&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  res.send(<span class="string">&#x27;reguser Ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="7-4-检测用户名是否合法"><a href="#7-4-检测用户名是否合法" class="headerlink" title="7.4 检测用户名是否合法"></a>7.4 检测用户名是否合法</h4><ol>
<li> 导入数据库操作模块</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 定义 SQL 语句</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义 sql 语句</span></span><br><span class="line"><span class="keyword">const</span> sql = <span class="string">`select * from ev_users where username=?`</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 执行 SQL 语句并根据结果判断用户名是否被占用</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">db.query(sql, userinfo.username, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行 sql 语句失败</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.message &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名被占用</span></span><br><span class="line">    <span class="keyword">if</span> (results.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名被占用，请更换其他用户名&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名可用，继续后续流程</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li> 完整代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.regUser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取到客户端提高到服务器的用户信息</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.body</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对表单中的数据进行合法性校验</span></span><br><span class="line">  <span class="keyword">if</span> (!userinfo.username || !userinfo.password) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名和密码不正确&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义 sql 语句</span></span><br><span class="line">  <span class="keyword">const</span> sql = <span class="string">`select * from ev_users where username=?`</span></span><br><span class="line">  <span class="comment">// 执行 sql 语句并根据结果判断用户名是否被占用</span></span><br><span class="line">  db.query(sql, userinfo.username, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行 sql 语句失败</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.message &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 用户名被占用</span></span><br><span class="line">    <span class="keyword">if</span> (results.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名被占用，请更换其他用户名&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名可用，继续后续流程</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  res.send(<span class="string">&#x27;reguser Ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="7-5-对密码进行加密处理"><a href="#7-5-对密码进行加密处理" class="headerlink" title="7.5 对密码进行加密处理"></a>7.5 对密码进行加密处理</h4><h5 id="7-5-1-什么需要对密码进行加密以及-bcryptjs-的优点"><a href="#7-5-1-什么需要对密码进行加密以及-bcryptjs-的优点" class="headerlink" title="7.5.1 什么需要对密码进行加密以及 bcryptjs 的优点"></a>7.5.1 什么需要对密码进行加密以及 bcryptjs 的优点</h5><ol>
<li> 为了保证密码的安全性，不建议在数据库以  <strong>明文</strong> 的形式保存用户密码，推荐对密码进行 <strong>加密存储</strong></li>
<li> 在当前项目中，使用  <code>bcryptjs</code> 对用户密码进行加密，优点：</li>
</ol>
<ul>
<li>加密之后的密码，无法被逆向破解</li>
<li>同一明文密码多次加密，得到的加密结果各不相同，保证了安全性</li>
</ul>
<h5 id="7-5-2-使用-bcryptjs-对密码进行加密"><a href="#7-5-2-使用-bcryptjs-对密码进行加密" class="headerlink" title="7.5.2 使用 bcryptjs 对密码进行加密"></a>7.5.2 使用 bcryptjs 对密码进行加密</h5><ol>
<li> 安装指定版本的  <code>bcryptjs </code></li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i bcryptjs@<span class="number">2.4</span><span class="number">.3</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 在  <code>/router_handler/user.js</code> 中，导入  <code>bcryptjs</code></li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 在注册用户的处理函数中，确认用户名可用之后，调用 <code>bcrypt.hashSync</code> (明文密码, 随机盐的长度) 方法，对用户的密码进行加密处理</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.regUser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// coding……</span></span><br><span class="line">    </span><br><span class="line">  db.query(sqlStr, userinfo.username, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行 sql 语句失败</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.message &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名被占用</span></span><br><span class="line">    <span class="keyword">if</span> (results.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名被占用，请更换其他用户名&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名可用，继续后续流程</span></span><br><span class="line">    <span class="built_in">console</span>.log(userinfo)</span><br><span class="line">    <span class="comment">// 对用户的密码，进行 bcrype 加密，返回值是加密以后的密码字符串</span></span><br><span class="line">    userinfo.password = bcrypt.hashSync(userinfo.password, <span class="number">10</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(userinfo)</span><br><span class="line">    res.send(<span class="string">&#x27;reguser Ok&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="7-6-插入新用户"><a href="#7-6-插入新用户" class="headerlink" title="7.6 插入新用户"></a>7.6 插入新用户</h4><ol>
<li> 定义插入用户的 <code>SQL</code> 语句</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sql = <span class="string">&#x27;insert into ev_users set ?&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 调用 <code>db.query()</code> 执行 <code>SQL</code> 语句，插入新用户</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.regUser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// coding…… </span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 执行 sql 语句并根据结果判断用户名是否被占用</span></span><br><span class="line">  db.query(sqlStr, userinfo.username, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行 sql 语句失败</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.message &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名被占用</span></span><br><span class="line">    <span class="keyword">if</span> (results.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名被占用，请更换其他用户名&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名可用，继续后续流程</span></span><br><span class="line">    <span class="comment">// 对用户的密码，进行 bcrype 加密，返回值是加密以后的密码字符串</span></span><br><span class="line">    userinfo.password = bcrypt.hashSync(userinfo.password, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义插入用户的 SQL 语句 </span></span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;insert into ev_users set ?&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 db.query() 执行 SQL 语句</span></span><br><span class="line">    db.query(sql, &#123; <span class="attr">username</span>: userinfo.username, <span class="attr">password</span>: userinfo.password &#125;, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断 sql 语句是否执行成功</span></span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: err.message &#125;)</span><br><span class="line">      <span class="comment">// 判断影响行数是否为 1</span></span><br><span class="line">      <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">&#x27;注册用户失败，请稍后再试！&#x27;</span> &#125;)</span><br><span class="line">      <span class="comment">// 注册成功</span></span><br><span class="line">      res.send(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">&#x27;注册成功&#x27;</span> &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="8-优化"><a href="#8-优化" class="headerlink" title="8.  优化"></a>8.  优化</h3><h4 id="8-1-优化-res-send-代码"><a href="#8-1-优化-res-send-代码" class="headerlink" title="8.1  优化 res.send() 代码"></a>8.1  优化 res.send() 代码</h4><blockquote>
<p>在处理函数中，需要多次调用 <strong>res.send()</strong> 向客户端响应  <strong>处理失败</strong> 的结果，为了简化代码，可以手动封装一个 res.cc() 函数</p>
</blockquote>
<ol>
<li>  在 <code>app.js</code>  中，所有路由之前，声明一个全局中间件，为 <code>res</code> 对象挂载一个 <code>res.cc()</code> 函数</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// coding……</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置解析 application/x-www-form-urlencoded 格式的表单数据的中间件</span></span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在所有路由之前，封装 res.cc 函数</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// status 的默认值为 1，表示失败的情况</span></span><br><span class="line">  <span class="comment">// err 的值，可能是一个错误对象，也可能是一个错误的描述字符串</span></span><br><span class="line">  res.cc = <span class="function">(<span class="params">err, status = <span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(&#123;</span><br><span class="line">      status,</span><br><span class="line">      <span class="attr">message</span>: err <span class="keyword">instanceof</span> <span class="built_in">Error</span> ? err.message : err</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入并注册用户路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/user&#x27;</span>)</span><br><span class="line">app.use(<span class="string">&#x27;/api&#x27;</span>, userRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// coding……</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 将 <code>router_handle/user.js</code> 中的文件修改成 <code>res.cc</code> 的方式</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义和用户相关的路由处理函数，功 /router/user.js 模块尽心调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.regUser = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取到客户端提高到服务器的用户信息</span></span><br><span class="line">  <span class="keyword">const</span> userinfo = req.body</span><br><span class="line">  <span class="built_in">console</span>.log(userinfo.username)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对表单中的数据进行合法性校验</span></span><br><span class="line">  <span class="keyword">if</span> (!userinfo.username || !userinfo.password) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.cc(<span class="string">&#x27;用户名和密码不正确&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义 sql 语句</span></span><br><span class="line">  <span class="keyword">const</span> sqlStr = <span class="string">&#x27;select * from ev_users where username=?&#x27;</span></span><br><span class="line">  <span class="comment">// 执行 sql 语句并根据结果判断用户名是否被占用</span></span><br><span class="line">  db.query(sqlStr, userinfo.username, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行 sql 语句失败</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.cc(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名被占用</span></span><br><span class="line">    <span class="keyword">if</span> (results.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.cc(<span class="string">&#x27;用户名被占用，请更换其他用户名&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名可用，继续后续流程</span></span><br><span class="line">    <span class="comment">// 对用户的密码，进行 bcrype 加密，返回值是加密以后的密码字符串</span></span><br><span class="line">    userinfo.password = bcrypt.hashSync(userinfo.password, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义插入用户的 SQL 语句 </span></span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;insert into ev_users set ?&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用 db.query() 执行 SQL 语句</span></span><br><span class="line">    db.query(sql, &#123; <span class="attr">username</span>: userinfo.username, <span class="attr">password</span>: userinfo.password &#125;, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断 sql 语句是否执行成功</span></span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> res.cc(err)</span><br><span class="line">      <span class="comment">// 判断影响行数是否为 1</span></span><br><span class="line">      <span class="keyword">if</span> (results.affectedRows !== <span class="number">1</span>) <span class="keyword">return</span> res.cc(<span class="string">&#x27;注册用户失败，请稍后再试！&#x27;</span>)</span><br><span class="line">      <span class="comment">// 注册成功</span></span><br><span class="line">      res.send(&#123; <span class="attr">status</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">&#x27;注册成功&#x27;</span> &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.login = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;login Ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-2-了解数据验证的原则"><a href="#8-2-了解数据验证的原则" class="headerlink" title="8.2  了解数据验证的原则"></a>8.2  了解数据验证的原则</h4><blockquote>
<p>表单验证的原则：前端验证为辅，后端验证为主，后端永远不要相信前端提交过来的任何内容</p>
</blockquote>
<ol>
<li> 在实际开发中，前后端都需要对表单的数据进行合法性的验证，而且，<strong>后端做为数据合法性校验的最后一个关口</strong>，在拦截非法数据方面，起到了至关重要的作用</li>
<li>单纯的使用  <code>if...else...</code> 的形式对数据合法性进行验证，效率低下、出错率高、维护性差。因此，<br>推荐使用第三方数据验证模块，来降低出错率、提高验证的效率与可维护性，让后端程序员把更多的精<br>力放在核心业务逻辑的处理上</li>
</ol>
<h4 id="8-3-介绍如何定义验证规则对象"><a href="#8-3-介绍如何定义验证规则对象" class="headerlink" title="8.3 介绍如何定义验证规则对象"></a>8.3 介绍如何定义验证规则对象</h4><ol>
<li> 安装 <code>@hapi/joi</code> 包，为表单中携带的每个数据项，定义验证规则</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install @hapi/joi@<span class="number">17.1</span><span class="number">.0</span> -S</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 安装 <code>@escook/express-joi</code> 中间件，来实现自动对表单数据进行验证的功能</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i @escook/express-joi -S</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 相关验证规则的含义</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* string() 值必须是字符串</span></span><br><span class="line"><span class="comment">* alphanum() 值只能是包含 a-zA-Z0-9 的字符串</span></span><br><span class="line"><span class="comment">* min(length) 最小长度</span></span><br><span class="line"><span class="comment">* max(length) 最大长度</span></span><br><span class="line"><span class="comment">* required() 值是必填项，不能为 undefined</span></span><br><span class="line"><span class="comment">* pattern(正则表达式) 值必须符合正则表达式的规则</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getUsersSchema = &#123;</span><br><span class="line">  <span class="attr">limit</span>: expressJoi.Joi.types.Number().integer().min(<span class="number">1</span>).max(<span class="number">25</span>),</span><br><span class="line">  <span class="attr">offset</span>: expressJoi.Joi.types.Number().integer().min(<span class="number">0</span>).max(<span class="number">25</span>),</span><br><span class="line">  <span class="attr">name</span>: expressJoi.Joi.types.String().alphanum().min(<span class="number">2</span>).max(<span class="number">25</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="8-4-了解如何使用数验证的中间件"><a href="#8-4-了解如何使用数验证的中间件" class="headerlink" title="8.4 了解如何使用数验证的中间件"></a>8.4 了解如何使用数验证的中间件</h4><ol>
<li> 在路由中使用局部中间件</li>
<li> 在局部中间件中通过 <code>expressJoi(userSchema)</code>  的方式调用中间件进行参数验证</li>
<li> 验证通过以后，将结果转交给后面的回调函数</li>
<li>验证失败以后，就会报一个全局的错误，只需要在错误级别中间件捕获错误，然后做下一步处理</li>
</ol>
<h4 id="8-5-定义验证规则模块"><a href="#8-5-定义验证规则模块" class="headerlink" title="8.5 定义验证规则模块"></a>8.5 定义验证规则模块</h4><ol>
<li> 新建  <code>/schema/user.js</code> 用户信息验证规则模块，并初始化代码</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> joi = <span class="built_in">require</span>(<span class="string">&#x27;@hapi/joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* string() 值必须是字符串</span></span><br><span class="line"><span class="comment">* alphanum() 值只能是包含 a-zA-Z0-9 的字符串</span></span><br><span class="line"><span class="comment">* min(length) 最小长度</span></span><br><span class="line"><span class="comment">* max(length) 最大长度</span></span><br><span class="line"><span class="comment">* required() 值是必填项，不能为 undefined</span></span><br><span class="line"><span class="comment">* pattern(正则表达式) 值必须符合正则表达式的规则</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证用户名、密码的规则</span></span><br><span class="line"><span class="keyword">const</span> username = joi.string().alphanum().min(<span class="number">10</span>).max(<span class="number">10</span>).required()</span><br><span class="line"><span class="keyword">const</span> passoword = joi.string().pattern(<span class="regexp">/^[\S]&#123;6, 12&#125;$/</span>).required()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录和注册表单的验证规则对象</span></span><br><span class="line"><span class="built_in">exports</span>.reg_login_schema = &#123;</span><br><span class="line">  <span class="comment">// 表示需要对 req.body 中的数据进行验证</span></span><br><span class="line">  <span class="attr">body</span>: &#123;</span><br><span class="line">    username,</span><br><span class="line">    passoword</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-6-实现对表单数据验证方式的改造"><a href="#8-6-实现对表单数据验证方式的改造" class="headerlink" title="8.6 实现对表单数据验证方式的改造"></a>8.6 实现对表单数据验证方式的改造</h4><ol>
<li> 将原始的 <code>if</code> 验证方式注释</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对表单中的数据进行合法性校验</span></span><br><span class="line"><span class="comment">// if (!userinfo.username || !userinfo.password) &#123;</span></span><br><span class="line"><span class="comment">//   // return res.send(&#123; status: 1, message: &#x27;用户名和密码不正确&#x27; &#125;)</span></span><br><span class="line"><span class="comment">//   return res.cc(&#x27;用户名和密码不正确&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 在 <code>router.js</code> 中导入验证数据的中间件以及验证规则对象，在需要验证的路由中使用局部中间件添加校验规则</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入用户路由处理函数模块</span></span><br><span class="line"><span class="keyword">const</span> userHandle = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 导入验证表单数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"><span class="comment">// 2. 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; reg_login_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册新用户</span></span><br><span class="line">router.post(<span class="string">&#x27;/reguser&#x27;</span>, expressJoi(reg_login_schema), userHandle.regUser)</span><br><span class="line"><span class="comment">// 登录功能</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, userHandle.login)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将路由对象共享出去</span></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>
<ol start="3">
<li> 验证可能会失败，所以在全局进行捕获</li>
</ol>
   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 错误中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 数据验证失败</span></span><br><span class="line">  <span class="keyword">if</span> (err <span class="keyword">instanceof</span> joi.ValidationError) <span class="keyword">return</span> res.cc(err)</span><br><span class="line">  <span class="comment">// 未知错误</span></span><br><span class="line">  res.cc(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">满天鑫</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://smanman.github.io/post/c6a3a65e.html">https://smanman.github.io/post/c6a3a65e.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://smanman.github.io" target="_blank">满天鑫</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/Node/">Node</a></div><div class="post_share"><div class="social-share" data-image="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212035.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/mm_facetoface_collect_qrcode_1628169825807.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/LVXUEYANGTiger/blog@main/1628169797.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/94d58d58.html"><img class="prev-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212025.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Node 第 8 天笔记</div></div></a></div><div class="next-post pull-right"><a href="/post/5f41c05f.html"><img class="next-cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082110.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Node 第 5 天笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/7e996e60.html" title="JavaScript基础第02天笔记"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212025.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-18</div><div class="title">JavaScript基础第02天笔记</div></div></a></div><div><a href="/post/2e39ac9e.html" title="day05 - Web APIs"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082302.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-18</div><div class="title">day05 - Web APIs</div></div></a></div><div><a href="/post/ef98b3dd.html" title="Node 第 1 天笔记"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212035.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-19</div><div class="title">Node 第 1 天笔记</div></div></a></div><div><a href="/post/b7f40a1c.html" title="Node 第 3 天笔记"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212104.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-19</div><div class="title">Node 第 3 天笔记</div></div></a></div><div><a href="/post/9ecf1f9f.html" title="Node 第 4 天笔记"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211004082121.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-19</div><div class="title">Node 第 4 天笔记</div></div></a></div><div><a href="/post/767ad5dc.html" title="Node 第 2 天笔记"><img class="cover" src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/20211108212104.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-19</div><div class="title">Node 第 2 天笔记</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-%E7%AC%AC-6-%E5%A4%A9"><span class="toc-number">1.</span> <span class="toc-text">Node 第 6 天</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="toc-number">1.1.</span> <span class="toc-text">1.  学习目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-web-%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">2.  web 开发模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E4%B8%BB%E6%B5%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1  主流的两种开发模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E4%BA%86%E8%A7%A3%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%A5%E5%8F%8A%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 了解服务端渲染的概念以及优缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E4%BA%86%E8%A7%A3%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%9A%84%E6%A6%82%E5%BF%B5%E4%BB%A5%E5%8F%8A%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 了解前后端分离的概念以及优缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9-Web-%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 如何选择 Web 开发模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-number">1.3.</span> <span class="toc-text">3.  身份认证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1  什么是身份认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 为什么需要身份认证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-session"><span class="toc-number">1.4.</span> <span class="toc-text">4.  session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E4%BA%86%E8%A7%A3-HTTP-%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%97%A0%E7%8A%B6%E6%80%81%E6%80%A7"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 了解 HTTP 协议的无状态性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%A6%82%E4%BD%95%E7%AA%81%E7%A0%B4-HTTP-%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 如何突破 HTTP 无状态的限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E4%BB%80%E4%B9%88%E6%98%AF-Cookie"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 什么是 Cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-Cookie-%E5%9C%A8%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 Cookie 在身份认证中的作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-Cookie-%E4%B8%8D%E5%85%B7%E6%9C%89%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5  Cookie 不具有安全性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-%E6%8F%90%E9%AB%98%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 提高身份认证的安全性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-Session-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.7.</span> <span class="toc-text">4.7 Session 的工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-%E5%AE%89%E8%A3%85%E5%B9%B6-express-session-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.4.8.</span> <span class="toc-text">4.8 安装并 express-session 中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-9-%E5%90%91-session-%E4%B8%AD%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.9.</span> <span class="toc-text">4.9  向 session 中存数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-%E4%BB%8E-session-%E4%B8%AD%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.10.</span> <span class="toc-text">4.10 从 session 中取数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-11-%E6%B8%85%E7%A9%BA-session"><span class="toc-number">1.4.11.</span> <span class="toc-text">4.11 清空 session</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-12-%E6%BC%94%E7%A4%BA-session-%E6%A1%88%E4%BE%8B%E6%95%88%E6%9E%9C"><span class="toc-number">1.4.12.</span> <span class="toc-text">4.12 演示 session 案例效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-jwt"><span class="toc-number">1.5.</span> <span class="toc-text">5.  jwt</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E4%BA%86%E8%A7%A3-Session-%E8%AE%A4%E8%AF%81%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1  了解 Session 认证的局限性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-JWT-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2  JWT 的工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-JWT-%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3  JWT 的组成部分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-JWT-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4  JWT 的使用方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-%E5%AE%89%E8%A3%85%E5%B9%B6%E5%AF%BC%E5%85%A5-JWT-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8C%85"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.5 安装并导入 JWT 相关的包</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-5-1-%E5%AE%89%E8%A3%85-JWT-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8C%85"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">5.5.1 安装 JWT 相关的包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-5-2-%E5%AF%BC%E5%85%A5-JWT-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8C%85"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">5.5.2  导入 JWT 相关的包</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-%E5%AE%9A%E4%B9%89-secret-%E5%AF%86%E9%92%A5"><span class="toc-number">1.5.6.</span> <span class="toc-text">5.6  定义 secret 密钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-7-%E5%9C%A8%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F%E5%90%8E%E7%94%9F%E6%88%90-JWT-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.5.7.</span> <span class="toc-text">5.7  在登录成功后生成 JWT 字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-%E5%B0%86-JWT-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%98%E5%8E%9F%E4%B8%BA-JSON-%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.5.8.</span> <span class="toc-text">5.8  将 JWT 字符串还原为 JSON 对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-9-%E4%BD%BF%E7%94%A8-req-user-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.9.</span> <span class="toc-text">5.9  使用 req.user 获取用户信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-10-%E6%8D%95%E8%8E%B7%E8%A7%A3%E6%9E%90-JWT-%E5%A4%B1%E8%B4%A5%E5%90%8E%E4%BA%A7%E7%94%9F%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-number">1.5.10.</span> <span class="toc-text">5.10 捕获解析 JWT 失败后产生的错误</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text">6. 项目初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1  项目概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 创建项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E9%85%8D%E7%BD%AE-cors-%E8%B7%A8%E5%9F%9F%E5%92%8C%E8%A7%A3%E6%9E%90%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 配置 cors 跨域和解析表单数据的中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-1-%E9%85%8D%E7%BD%AE-cors-%E8%B7%A8%E5%9F%9F"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">6.3.1 配置 cors 跨域</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-2-%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">6.3.2 配置解析表单数据的中间件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E5%88%9D%E5%A7%8B%E5%8C%96%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E7%9A%84%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 初始化路由相关的文件夹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%94%A8%E6%88%B7%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97"><span class="toc-number">1.6.5.</span> <span class="toc-text">6.5 初始化用户路由模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-%E6%8A%BD%E7%A6%BB%E7%94%A8%E6%88%B7%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.6.</span> <span class="toc-text">6.6  抽离用户路由模块中的处理函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%B3%A8%E5%86%8C%E6%96%B0%E7%94%A8%E6%88%B7"><span class="toc-number">1.7.</span> <span class="toc-text">7.  注册新用户</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%A1%A8"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 创建用户表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-mysql-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 安装配置 mysql 模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E6%A3%80%E6%B5%8B%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 检测表单数据是否合法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-1-%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">7.3.1 注册功能实现步骤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-2-%E6%A3%80%E6%B5%8B%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">7.3.2 检测表单数据是否合法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-%E6%A3%80%E6%B5%8B%E7%94%A8%E6%88%B7%E5%90%8D%E6%98%AF%E5%90%A6%E5%90%88%E6%B3%95"><span class="toc-number">1.7.4.</span> <span class="toc-text">7.4 检测用户名是否合法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%E5%A4%84%E7%90%86"><span class="toc-number">1.7.5.</span> <span class="toc-text">7.5 对密码进行加密处理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-5-1-%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%E4%BB%A5%E5%8F%8A-bcryptjs-%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.7.5.1.</span> <span class="toc-text">7.5.1 什么需要对密码进行加密以及 bcryptjs 的优点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-5-2-%E4%BD%BF%E7%94%A8-bcryptjs-%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86"><span class="toc-number">1.7.5.2.</span> <span class="toc-text">7.5.2 使用 bcryptjs 对密码进行加密</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-6-%E6%8F%92%E5%85%A5%E6%96%B0%E7%94%A8%E6%88%B7"><span class="toc-number">1.7.6.</span> <span class="toc-text">7.6 插入新用户</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E4%BC%98%E5%8C%96"><span class="toc-number">1.8.</span> <span class="toc-text">8.  优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E4%BC%98%E5%8C%96-res-send-%E4%BB%A3%E7%A0%81"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1  优化 res.send() 代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E4%BA%86%E8%A7%A3%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2  了解数据验证的原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E4%BB%8B%E7%BB%8D%E5%A6%82%E4%BD%95%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3 介绍如何定义验证规则对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-%E4%BA%86%E8%A7%A3%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%95%B0%E9%AA%8C%E8%AF%81%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.8.4.</span> <span class="toc-text">8.4 了解如何使用数验证的中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E8%A7%84%E5%88%99%E6%A8%A1%E5%9D%97"><span class="toc-number">1.8.5.</span> <span class="toc-text">8.5 定义验证规则模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-6-%E5%AE%9E%E7%8E%B0%E5%AF%B9%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E6%96%B9%E5%BC%8F%E7%9A%84%E6%94%B9%E9%80%A0"><span class="toc-number">1.8.6.</span> <span class="toc-text">8.6 实现对表单数据验证方式的改造</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 满天鑫</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="framework-info"><img src="https://note-1259153703.cos.ap-nanjing.myqcloud.com/images/202301132049386.png"/><span> </span><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">晋ICP备2022012091号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'pinglun-9gh2lmcnd8587831',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'pinglun-9gh2lmcnd8587831',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><script src="//code.tidio.co/smwivpnwumemac2wohardi3d3gpud1ag.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>